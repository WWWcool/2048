window.__require=function e(t,o,r){function n(i,s){if(!o[i]){if(!t[i]){var l=i.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!s&&c)return c(l,!0);if(a)return a(l,!0);throw new Error("Cannot find module '"+i+"'")}}var p=o[i]={exports:{}};t[i][0].call(p.exports,function(e){return n(t[i][1][e]||e)},p,p.exports,e,t,o,r)}return o[i].exports}for(var a="function"==typeof __require&&__require,i=0;i<r.length;i++)n(r[i]);return n}({ArrayUtil:[function(e,t,o){"use strict";cc._RF.push(t,"ab147e5tnRPA7ob43Tv5Cjr","ArrayUtil"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function e(){}return e.getOrNull=function(e,t){return e?t<0&&e.length<=t?null:e[t]:null},e.getOrLast=function(e,t){if(!e)return null;var o=cc.misc.clampf(t,0,e.length-1);return 0<=o&&o<e.length?e[o]:null},e.checkedGet=function(e,t,o){return!e||t<0&&e.length<=t?(cc.error(o+" index is out of range: "+t+" (len="+t+")"),null):e[t]},e.checkedRemoveAt=function(e,t,o){if(!e||t<0&&e.length<=t)return cc.error(o+" index is out of range: "+t+" (len="+t+")"),null;var r=e[t];return e.splice(t,1),r},e.getFirstOrNull=function(e){return e&&e.length>0?e[0]:null},e.getLastOrNull=function(e){return e&&e.length>0?e[e.length-1]:null},e.pickByWeight=function(t){for(var o=0,r=0,n=t;r<n.length;r++){o+=(p=n[r]).weight}for(var a=Math.random()*o,i=0,s=0,l=0,c=t;l<c.length;l++){var p;if(s=i,i+=(p=c[l]).weight,s<=a&&a<i)return p}return e.pickRandom(t)},e.pickRandom=function(e){return e&&e.length>0?e[Math.floor(Math.random()*e.length)]:null},e.removeAt=function(e,t){return 0<=t&&t<e.length&&(e.splice(t,1),!0)},e.remove=function(e,t){var o=e.findIndex(function(e){return e===t});return this.removeAt(e,o)},e.swapEraseAt=function(e,t){return 0<=t&&t<e.length&&(e[t]=e[e.length-1],e.length-=1,!0)},e.swapErase=function(e,t){var o=e.findIndex(function(e){return e===t});return-1!==o&&(this.swapEraseAt(e,o),!0)},e.addIfNotExists=function(e,t){return-1===e.findIndex(function(e){return e===t})&&(e.push(t),!0)},e.exists=function(e,t){return-1!==e.findIndex(function(e){return e===t})},e.shuffle=function(t){for(var o=t.length-1;o>0;o--){var r=Math.random()*(o+1);e.swap(t,o,r)}},e.fill=function(e,t){for(var o=0;o<e.length;++o)e[o]=t;return e},e.swap=function(e,t,o){var r=e[t];e[t]=e[o],e[o]=r},e.count=function(e,t){for(var o=0,r=0,n=e;r<n.length;r++){t(n[r])&&++o}return o},e.batchInsertSorted=function(e,t,o,r){for(var n=0,a=n<t.length?t[n]:null,i=0;i<e.length;){for(var s=e[i];a&&o(a,s)<0;)e.splice(i,0,a),r.onInserted(a,i),a=++n<t.length?t[n]:null,++i;r.onExisting(s,i),++i}for(;a;)e.push(a),r.onInserted(a,i),a=++n<t.length?t[n]:null,++i},e.batchRemove=function(e,t,o){for(var r=0;r<e.length;){var n=e[r];-1!==t.indexOf(n)?(e.splice(r,1),o.onRemoved(n)):(o.onSurvived(n,r),++r)}},e.nonEmptyAndNullFree=function(t){return t.length>0&&!e.exists(t,null)&&!e.exists(t,void 0)},e.checkNonEmptyAndNullFree=function(e,t){if(0===e.length)return cc.error(t+" should be non empty"),null;for(var o=0,r=e;o<r.length;o++){if(!r[o])return cc.error(t+" should not contain nulls"),null}return e},e.checkNullFree=function(e,t){for(var o=0,r=e;o<r.length;o++){if(!r[o])return cc.error(t+" should not contain nulls"),null}return e},e.insertSorted=function(e,t,o){for(var r=0;r<e.length&&0<o(t,e[r]);)++r;return e.splice(r,0,t),r},e}();o.ArrayUtil=r,cc._RF.pop()},{}],AudioConfig:[function(e,t,o){"use strict";cc._RF.push(t,"d5889BMfk1BNLxmGanQFetf","AudioConfig"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(){return function(e,t){this.crossfadeDuration=e,this.effectRepeatCooldown=t}}();o.AudioConfig=i;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.crossfadeDuration=2,t.effectRepeatCooldown=.1,t}return __extends(t,e),t.prototype.build=function(){return new i(this.crossfadeDuration,this.effectRepeatCooldown)},__decorate([a],t.prototype,"crossfadeDuration",void 0),__decorate([a],t.prototype,"effectRepeatCooldown",void 0),t=__decorate([n],t)}(cc.Component);o.AudioConfigProps=s,cc._RF.pop()},{}],AudioEffect:[function(e,t,o){"use strict";cc._RF.push(t,"2b9cepwRQ9M+q5+r08TnPmb","AudioEffect"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(){return function(e){this.clips=e}}();o.AudioEffect=i;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clips=[],t}return __extends(t,e),t.prototype.build=function(){return new i(this.clips)},__decorate([a({type:cc.AudioClip})],t.prototype,"clips",void 0),t=__decorate([n],t)}(cc.Component);o.AudioEffectProps=s,cc._RF.pop()},{}],AudioEmitter:[function(e,t,o){"use strict";cc._RF.push(t,"c274bZtcc5GQZ/Qnlrp2LAv","AudioEmitter"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("AudioTheme"),n=e("AudioEffect"),a=e("AudioManager"),i=cc._decorator,s=i.ccclass,l=i.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clipPrefab=null,t}return __extends(t,e),t.prototype.start=function(){if(null!==this.clipPrefab){var e=cc.instantiate(this.clipPrefab),t=e.getComponent(r.AudioThemeProps);null!==t&&cc.systemEvent.emit(a.AudioManager.EventPlayTheme.eventName,new a.AudioManager.EventPlayTheme(t.build()));var o=e.getComponent(n.AudioEffectProps);null!==o&&cc.systemEvent.emit(a.AudioManager.EventPlaySfx.eventName,new a.AudioManager.EventPlaySfx(o.build()))}},__decorate([l(cc.Prefab)],t.prototype,"clipPrefab",void 0),t=__decorate([s],t)}(cc.Component);o.AudioEmitter=c,cc._RF.pop()},{AudioEffect:"AudioEffect",AudioManager:"AudioManager",AudioTheme:"AudioTheme"}],AudioManager:[function(e,t,o){"use strict";cc._RF.push(t,"9c44aQy8VJPeoVQX2BVzra1","AudioManager"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("ArrayUtil"),a=e("./AudioUtil");(function(e){e[e.EnableThemes=0]="EnableThemes",e[e.EnableEffects=1]="EnableEffects"})(r=o.AudioSettingFlag||(o.AudioSettingFlag={}));var i=2,s=.1,l=1<<r.EnableThemes|1<<r.EnableEffects,c=function(){function e(){this.crossFadeDuration=i,this.effectRepeatCooldown=s,this.settings=l,this.numMutes=0,this.themeFadingIn=!1,this.themeFadingOut=!1,this.activeThemeAudioClip=null,this.activeThemeAudio=null,this.activeThemeAudioID=NaN,this.activeThemeVolume=1,this.fadingThemesAudioIDs=[],this.activeEffectsAudioIDs=new Set,this.activeEffectsTimestamps=new Map}return e.prototype.dispose=function(){this.cutTheme(),this.cutEffects()},e.prototype.configure=function(e){if(!e)return this.crossFadeDuration=i,void(this.effectRepeatCooldown=s);this.crossFadeDuration=e.crossfadeDuration,this.effectRepeatCooldown=e.effectRepeatCooldown},e.prototype.loadSettings=function(){var e=cc.sys.localStorage.getItem("AudioSettings");this.settings=e?parseInt(e,void 0):l},e.prototype.saveSettings=function(){cc.sys.localStorage.setItem("AudioSettings",this.settings.toString(16))},e.prototype.getSettingFlag=function(e){return 0!=(this.settings&1<<e)},e.prototype.setSettingFlag=function(e,t){if(t!==this.getSettingFlag(e))switch(t?this.settings|=1<<e:this.settings&=~(1<<e),e){case r.EnableThemes:0===this.numMutes&&(t?this.resumeTheme():this.cutTheme());break;case r.EnableEffects:t||0!==this.numMutes||this.cutEffects()}},e.prototype.playTheme=function(e,t){if(void 0===t&&(t=1),e){var o=n.ArrayUtil.pickRandom(e.clips);if(o!==this.activeThemeAudioClip){if(this.activeThemeAudioClip){this.themeFadingIn=!1,this.activeThemeAudioClip=null;var a=this.activeThemeAudioID;isNaN(a)||(this.themeFadingOut=!0,this.activeThemeAudioID=NaN,this.fadingThemesAudioIDs.push(a))}this.numMutes>0||!this.getSettingFlag(r.EnableThemes)?this.activeThemeAudioClip=o:(this.themeFadingIn=!0,this.activeThemeAudioClip=o,this.activeThemeAudioID=cc.audioEngine.play(o,!0,0),this.activeThemeAudio=e),this.activeThemeVolume=t}}},e.prototype.playEffect=function(e,t){if(void 0===t&&(t=1),!(this.numMutes>0)&&this.getSettingFlag(r.EnableEffects)){var o=n.ArrayUtil.pickRandom(e.clips);if(o){var a=o.toString(),i=this.activeEffectsAudioIDs,s=this.activeEffectsTimestamps,l=cc.sys.now()/1e3,c=s.get(a);if(!(void 0!==c&&l-c<this.effectRepeatCooldown)){var p=cc.audioEngine.play(o,!1,t);isNaN(p)||(i.add(p),s.set(a,l),cc.audioEngine.setFinishCallback(p,function(e){i.delete(p)}))}}}},e.prototype.mute=function(){1===++this.numMutes&&(this.cutTheme(),this.cutEffects())},e.prototype.unmute=function(){0===--this.numMutes&&this.resumeTheme()},e.prototype.update=function(e){if(this.themeFadingOut){for(var t=0,o=this.fadingThemesAudioIDs.length-1;o>=0;--o){var r=this.fadingThemesAudioIDs[o];a.AudioUtil.fadeOutAndStopAudio(r,e,1/this.crossFadeDuration)?t++:n.ArrayUtil.swapErase(this.fadingThemesAudioIDs,o)}this.themeFadingOut=t>0}this.themeFadingIn&&(this.themeFadingIn=a.AudioUtil.fadeInAudio(this.activeThemeAudioID,e,1/this.crossFadeDuration,this.activeThemeVolume))},e.prototype.cutTheme=function(){this.themeFadingIn=!1,this.themeFadingOut=!1;var e=this.activeThemeAudioID;isNaN(e)||(this.activeThemeAudioID=NaN,cc.audioEngine.stop(e));for(var t=0,o=this.fadingThemesAudioIDs;t<o.length;t++){var r=o[t];cc.audioEngine.stop(r)}this.fadingThemesAudioIDs.length=0},e.prototype.cutEffects=function(){this.activeEffectsAudioIDs.forEach(function(e){cc.audioEngine.setFinishCallback(e,function(e){}),cc.audioEngine.stop(e)}),this.activeEffectsAudioIDs.clear()},e.prototype.resumeTheme=function(){this.activeThemeAudioClip&&(this.activeThemeAudioID=cc.audioEngine.play(this.activeThemeAudioClip,!0,this.activeThemeVolume))},e}();o.AudioManager=c,function(e){var t=function(){function e(e){this.sfx=e}return e.eventName="EventPlaySfx",e}();e.EventPlaySfx=t;var o=function(){function e(e){this.theme=e}return e.eventName="EventPlayTheme",e}();e.EventPlayTheme=o}(c=o.AudioManager||(o.AudioManager={})),o.AudioManager=c,o.default=c,cc._RF.pop()},{"./AudioUtil":"AudioUtil",ArrayUtil:"ArrayUtil"}],AudioTheme:[function(e,t,o){"use strict";cc._RF.push(t,"75ec3OPeKhFN6x+PcSlhmTq","AudioTheme"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(){return function(e){this.clips=e}}();o.AudioTheme=i;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clips=[],t}return __extends(t,e),t.prototype.build=function(){return new i(this.clips)},__decorate([a({type:cc.AudioClip})],t.prototype,"clips",void 0),t=__decorate([n],t)}(cc.Component);o.AudioThemeProps=s,cc._RF.pop()},{}],AudioUtil:[function(e,t,o){"use strict";cc._RF.push(t,"892d5DFosRK5Y95MHjU0xcA","AudioUtil"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function e(){}return e.fadeOutAndStopAudio=function(e,t,o){var r=cc.audioEngine.getVolume(e),n=t*o;return r>n?(cc.audioEngine.setVolume(e,r-n),!0):(cc.audioEngine.stop(e),!1)},e.fadeInAudio=function(e,t,o,r){var n=cc.audioEngine.getVolume(e),a=t*o;return n+a<r?(cc.audioEngine.setVolume(e,n+a),!0):(cc.audioEngine.setVolume(e,r),!1)},e}();o.AudioUtil=r,cc._RF.pop()},{}],BackToLevelMap:[function(e,t,o){"use strict";cc._RF.push(t,"a3bf7euuWZLcrmnv4HiLVs/","BackToLevelMap"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("GameComponentsLocator"),n=e("GlobalHandler"),a=e("SceneTransition"),i=cc._decorator,s=i.ccclass,l=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.buttonCallback=function(){var e=r.GameComponentsLocator.get(n.GlobalHandler);if(null!=e){var t=e.getComponent(a.SceneTransition);if(null!=t){var o=e.data;t.gotoScene(o.transitionData.getScene())}}},t=__decorate([s],t)}(cc.Component));o.default=l,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",GlobalHandler:"GlobalHandler",SceneTransition:"SceneTransition"}],BattleController:[function(e,t,o){"use strict";cc._RF.push(t,"118bdbHELhCZon1ejf9J8yI","BattleController"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CharacterAvatarCreator"),n=e("CharacterSlot"),a=e("CoreMover"),i=e("Health"),s=e("Damage"),l=e("SkillsController"),c=e("GameComponentsLocator"),p=e("CharacterLoader"),u=e("BattleViewController"),h=e("CoreInputController"),d=e("SkillEvent"),v=e("CharacterAvatar"),f=e("CharacterData"),m=e("TransitionDataMapper"),y=e("HeroDataMapper"),g=e("BattleProgression"),C=cc._decorator,S=C.ccclass,_=C.property,k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unitSlots=[],t.unitPrefab=null,t.avatarCreator=null,t.viewController=null,t.battleProgression=null,t.unitSlotTypes=[],t.levelUnits=[],t.levelUnitIndex=0,t.characterLoader=null,t.firstSpawn=!0,t.killCount=0,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){this.characterLoader=this.node.getComponent(p.CharacterLoader),this.viewController.conroller=this,cc.systemEvent.on(a.default.EventMovePerformed.eventName,this.onMovePerformed,this),cc.systemEvent.on(o.EventReadyToNewWave.eventName,this.OnReadyToNewWave,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(a.default.EventMovePerformed.eventName,this.onMovePerformed,this),cc.systemEvent.off(o.EventReadyToNewWave.eventName,this.OnReadyToNewWave,this)},t.prototype.start=function(){this.levelUnits=this.battleProgression.getLevelUnits(this.killCount),this.spawnHero(this.getHeroSlot())},t.prototype.spawnHero=function(e){var t="Warrior",o=(y.RareType.Common,y.BaseStatType.Strength,30);this.spawnNewUnit(e,this.characterLoader.getCharacterData(t),function(e){e.character.getComponent(i.default).setHealth(o)}),e.addAppearListener(this.onHeroAppeared,this)},t.prototype.OnReadyToNewWave=function(){this.levelUnits=this.battleProgression.getLevelUnits(this.killCount),this.levelUnitIndex=0,cc.systemEvent.emit(h.CoreInputController.EventBlockingFinished.eventName,new h.CoreInputController.EventBlockingFinished(!1)),this.onNeedNewEnemy(this.getEnemySlot())},t.prototype.onHeroAppeared=function(){cc.systemEvent.emit(u.BattleViewController.EventGameStarted.eventName),cc.systemEvent.emit(h.CoreInputController.EventBlockingStarted.eventName,new h.CoreInputController.EventBlockingStarted(!0)),this.onNeedNewEnemy(this.getEnemySlot())},t.prototype.spawnEnemy=function(e){var t=this;if(this.levelUnitIndex>=this.levelUnits.length)return this.viewController.spawnUnitAnim(e,function(){cc.systemEvent.emit(o.EventWaveEnded.eventName,new o.EventWaveEnded(t.getHeroSlot()))},!1),!0;var r=this.levelUnits[this.levelUnitIndex++];this.firstSpawn||cc.systemEvent.emit(h.CoreInputController.EventBlockingStarted.eventName,new h.CoreInputController.EventBlockingStarted(!0)),this.firstSpawn=!1;return this.spawnNewUnit(e,this.characterLoader.getCharacterData(r.type),function(e){e.character.getComponent(i.default).setHealth(r.health),e.character.getComponent(s.Damage).setDamage(r.damage)}),!1},t.prototype.spawnNewUnit=function(e,t,o){var r=this;this.viewController.spawnUnitAnim(e,function(){var n=cc.instantiate(r.unitPrefab),a=r.avatarCreator.createAvatar(e.slotType,n,t);r.characterLoader.loadAvatarDataExt(t,a.avatar),e.attachCharacter(n,a),void 0!=o&&o(e)})},t.prototype.onNeedNewEnemy=function(e){var t=this.spawnEnemy(e);return cc.systemEvent.emit(u.BattleViewController.EventUnitDeath.eventName,new u.BattleViewController.EventUnitDeath(e,this.levelUnitIndex)),t},t.prototype.onMovePerformed=function(e){var t;if(!(this.unitSlots.length<2)){var o=this.sortSlots(),r=o[0],n=o[1],a=this.getCharacters(n),i=this.getCharacters(r),s=null;if(e.merged()){if(a=(t=[i,a])[0],i=t[1],s=e.value,!e.options.playerCanDealDamage)return}else if(!e.options.enemyCanDealDamage)return;for(var l=0,c=a;l<c.length;l++){var p=c[l];(p=this.prepareDamage(s,p)).damage&&this.dealDamage(p,i,!0)}}},t.prototype.getEnemySlot=function(){for(var e=null,t=0,o=this.unitSlots;t<o.length;t++){var r=o[t];if(r.slotType==n.SlotType.Enemy){e=r;break}}return e},t.prototype.prepareDamage=function(e,t){return t.damage=e||t.damage,t},t.prototype.dealDamage=function(e,t,o,r){for(var n=e.damage,a=0,s=t;a<s.length;a++){var l=s[a];if(null!=l.character.getComponent(i.default)){cc.systemEvent.emit(d.SkillEvent.BaseEvent.eventName,new d.SkillEvent.BaseEvent("onHitDamageCalc",e.character)),n=o?e.character.getComponent(f.CharacterData).calcHitDamage(n):e.character.getComponent(f.CharacterData).calcSkillDamage(n),cc.systemEvent.emit(d.SkillEvent.BaseEvent.eventName,new d.SkillEvent.BaseEvent("onHitDamageCalcFinished",e.character,n)),n=o?l.character.getComponent(f.CharacterData).calcHitDefence(n):l.character.getComponent(f.CharacterData).calcSkillDefence(n);var c=this.dealFixedDamage(n,e,l,r);if(!c){var p=l.avatar.parent.getComponent(v.CharacterAvatar);null!=p?p.isAlive=!1:cc.warn("BattleController | char avatar not found")}if(n>0&&c){var u=l.character.getComponent(f.CharacterData).calcReturnDamage(n);u>0&&this.dealFixedDamage(u,l,e)}}}},t.prototype.dealFixedDamage=function(e,t,r,s){var p=this,u=r.character.getComponent(i.default),v=!0;if(e>0)u.takeDamage(e),cc.systemEvent.emit(d.SkillEvent.BaseEvent.eventName,new d.SkillEvent.BaseEvent("onDamaged",t.character,e)),cc.systemEvent.emit(o.EventHitEfx.eventName,new o.EventHitEfx(e,r.avatar)),void 0==s&&(s=function(e){if(e.type===n.SlotType.Enemy)cc.systemEvent.emit(l.SkillsController.EventSkillUnload.eventName,new l.SkillsController.EventSkillUnload(e.character.getComponent(l.SkillsController))),p.killCount++,p.onNeedNewEnemy(e.slot)&&cc.systemEvent.emit(h.CoreInputController.EventBlockingStarted.eventName,new h.CoreInputController.EventBlockingStarted(!0));else if(e.type===n.SlotType.Player){c.GameComponentsLocator.get(m.TransitionDataMapper).setLevelAction(m.LevelAction.Lose),cc.systemEvent.emit(a.default.EventGameEnded.eventName,new a.default.EventGameEnded(!1))}}),u.isAlive()||(v=!1,s(r));else{switch(e){case f.CharacterDefenceType.Dodge:case f.CharacterDefenceType.Block:}cc.systemEvent.emit(o.EventHitEfx.eventName,new o.EventHitEfx(e,r.avatar))}return v},t.prototype.sortSlots=function(){for(var e=[],t=[],o=0,r=this.unitSlots;o<r.length;o++){var a=r[o];a.slotType==n.SlotType.Player?e.push(a):t.push(a)}return[e,t]},t.prototype.getCharacters=function(e){for(var t=[],o=0,r=e;o<r.length;o++){var n=r[o],a=this.getCharacter(n);null!=a&&t.push(a)}return t},t.prototype.getCharacter=function(e){var t=e.character,o=null;if(t){var r=t.getComponent(s.Damage)?t.getComponent(s.Damage).damage:null;o={slot:e,character:t,avatar:e.avatar.avatar,damage:r,type:e.slotType}}return o},t.prototype.getEnemies=function(e){for(var t=[],o=0,r=this.unitSlots;o<r.length;o++){var n=r[o];n.slotType!=e&&t.push(n)}return t},t.prototype.findSlot=function(e){for(var t=null,o=0,r=this.unitSlots;o<r.length;o++){var n=r[o];n.character===e&&(t=n)}return t},t.prototype.dealDamageFrom=function(e,t){var o=this.findSlot(t),r=this.getCharacter(o),n=this.getEnemies(o.slotType),a=this.getCharacters(n);r.damage=e,this.dealDamage(r,a,!1)},t.prototype.dealDamageSelf=function(e,t){var o=this.findSlot(t),r=this.getCharacter(o);r.damage=e,this.dealFixedDamage(e,r,r)},t.prototype.getHeroSlot=function(){return this.unitSlots.find(function(e){return e.slotType==n.SlotType.Player})},__decorate([_([n.CharacterSlot])],t.prototype,"unitSlots",void 0),__decorate([_(cc.Prefab)],t.prototype,"unitPrefab",void 0),__decorate([_(r.default)],t.prototype,"avatarCreator",void 0),__decorate([_(u.BattleViewController)],t.prototype,"viewController",void 0),__decorate([_(g.BattleProgression)],t.prototype,"battleProgression",void 0),t=o=__decorate([S],t)}(cc.Component);o.BattleController=k,function(e){var t=function(){function e(e,t){this.damage=e,this.owner=t}return e.eventName="EventHitEfx",e}();e.EventHitEfx=t;var o=function(){function e(e){this.slot=e}return e.eventName="EventWaveEnded",e}();e.EventWaveEnded=o;var r=function(){function e(){}return e.eventName="EventReadyToNewWave",e}();e.EventReadyToNewWave=r}(k=o.BattleController||(o.BattleController={})),o.BattleController=k,o.default=k,cc._RF.pop()},{BattleProgression:"BattleProgression",BattleViewController:"BattleViewController",CharacterAvatar:"CharacterAvatar",CharacterAvatarCreator:"CharacterAvatarCreator",CharacterData:"CharacterData",CharacterLoader:"CharacterLoader",CharacterSlot:"CharacterSlot",CoreInputController:"CoreInputController",CoreMover:"CoreMover",Damage:"Damage",GameComponentsLocator:"GameComponentsLocator",Health:"Health",HeroDataMapper:"HeroDataMapper",SkillEvent:"SkillEvent",SkillsController:"SkillsController",TransitionDataMapper:"TransitionDataMapper"}],BattleLoader:[function(e,t,o){"use strict";var r,n,a,i;cc._RF.push(t,"1a396exF7lIR5+xOgBWYXUE","BattleLoader"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.Resource=0]="Resource",e[e.Items=1]="Items",e[e.Hero=2]="Hero"}(r=o.DropType||(o.DropType={})),function(e){e[e.Gold=0]="Gold",e[e.Stone=1]="Stone",e[e.Wood=2]="Wood"}(n=o.DropResourceType||(o.DropResourceType={})),function(e){e[e.Random=0]="Random"}(a=o.DropHeroType||(o.DropHeroType={})),function(e){e[e.None=0]="None",e[e.Add=1]="Add",e[e.Replace=2]="Replace"}(i=o.UnitDropType||(o.UnitDropType={}));var s=cc._decorator,l=s.ccclass,c=s.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentLevelData=null,t}return __extends(t,e),t.prototype.tryReadLevelData=function(){var e=null;return null!=this.currentLevelData&&(e=this.currentLevelData),e},t.prototype.getLevelUnits=function(){for(var e=[],t=0,o=this.tryReadLevelData().json.units;t<o.length;t++){var r=o[t];e.push({type:r.type,health:r.health,damage:r.damage,drop:this.parseUnitDrop(r.drop),skills:this.parseSkills(r.buildInSkills)})}return e},t.prototype.getLevelDrop=function(){var e=this.tryReadLevelData(),t=[];return void 0!=e.json.defaultDrop&&(t=this.parseDrops(e.json.defaultDrop)),t},t.prototype.parseSkills=function(e){for(var t=[],o=0,r=e;o<r.length;o++){var n=r[o];t.push({type:n.type,cooldown:n.cooldown,cooldownInit:n.cooldownInit})}return t},t.prototype.parseUnitDrop=function(e){return void 0===e?{type:i.None,drops:[]}:{type:this.parseUnitDropType(e.type),drops:this.parseDrops(e.drop)}},t.prototype.parseUnitDropType=function(e){var t=i.None;switch(e){case"add":t=i.Add;break;case"replace":t=i.Replace}return t},t.prototype.parseDrops=function(e){for(var t=[],o=0,r=e;o<r.length;o++){var n=r[o];t.push(this.parseDrop(n))}return t},t.prototype.parseDrop=function(e){var t=null;switch(e.type){case"resource":var o={type:this.parseDropResourceType(e.resourceType),amount:this.parseDropRange(e.amount),chance:e.chance};t={type:r.Resource,resource:o};break;case"items":var n={amount:this.parseDropRange(e.amount),magicChance:e.magicChance,rareChance:e.rareChance,legendaryChance:e.legendaryChance};t={type:r.Items,items:n};break;case"hero":var a={type:this.parseDropHeroType(e.heroType),chance:e.chance};t={type:r.Hero,hero:a}}return t},t.prototype.parseDropRange=function(e){return{min:e.min,max:e.max}},t.prototype.parseDropResourceType=function(e){var t=null;switch(e){case"gold":t=n.Gold;break;case"wood":t=n.Wood;break;case"stone":t=n.Stone}return t},t.prototype.parseDropHeroType=function(e){var t=null;switch(e){case"random":t=a.Random}return t},__decorate([c(cc.JsonAsset)],t.prototype,"currentLevelData",void 0),t=__decorate([l],t)}(cc.Component);o.BattleLoader=p,cc._RF.pop()},{}],BattleProgression:[function(e,t,o){"use strict";cc._RF.push(t,"76ba3df/2JLToaJoAL4ggSF","BattleProgression"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("MathHelper"),n=cc._decorator,a=n.ccclass,i=n.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.logShift=3,t.logBaseHealth=10,t.baseHealth=1e3,t.logBaseDamage=10,t.baseDamage=10,t.bossChance=.05,t.waveCountMin=3,t.waveCountMax=10,t.unitTypes=[],t.bossTypes=[],t.waveCount=1,t}return __extends(t,e),t.prototype.getLevelUnits=function(e){var t=this.waveCountMin+r.getRandomInt(this.waveCountMax-this.waveCountMin);cc.log("BattleProgression | getLevelUnits count - "+t.toString());for(var o=[],n=0;n<t;n++)Math.random()<this.bossChance?o.push({type:this.bossTypes[r.getRandomInt(this.bossTypes.length-1)],health:4*this.getHealth(e+n+this.logShift),damage:3*this.getDamage(e+n+this.logShift),isBoss:!0}):o.push({type:this.unitTypes[r.getRandomInt(this.unitTypes.length-1)],health:this.getHealth(e+n+this.logShift),damage:this.getDamage(e+n+this.logShift),isBoss:!1});return this.waveCount++,o},t.prototype.getDamage=function(e){return Math.round(r.getBaseLog(e,this.logBaseDamage)*this.baseDamage*this.waveCount)+1},t.prototype.getHealth=function(e){return Math.round(r.getBaseLog(e,this.logBaseHealth)*this.baseHealth*this.waveCount)},__decorate([i],t.prototype,"logShift",void 0),__decorate([i],t.prototype,"logBaseHealth",void 0),__decorate([i],t.prototype,"baseHealth",void 0),__decorate([i],t.prototype,"logBaseDamage",void 0),__decorate([i],t.prototype,"baseDamage",void 0),__decorate([i],t.prototype,"bossChance",void 0),__decorate([i],t.prototype,"waveCountMin",void 0),__decorate([i],t.prototype,"waveCountMax",void 0),__decorate([i([cc.String])],t.prototype,"unitTypes",void 0),__decorate([i([cc.String])],t.prototype,"bossTypes",void 0),t=__decorate([a],t)}(cc.Component);o.BattleProgression=s,cc._RF.pop()},{MathHelper:"MathHelper"}],BattleViewController:[function(e,t,o){"use strict";cc._RF.push(t,"a0e14N09cJEQ6efJd57MIC2","BattleViewController");var r,n=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const a=e("BattleController"),i=e("CoreInputController"),s=e("CharacterSlot"),l=e("ParallaxBackground"),c=e("FilterController");var p,u;(function(e){e[e.None=0]="None",e[e.Start=1]="Start",e[e.Moving=2]="Moving",e[e.Stop=3]="Stop"})(p=o.SceneStep||(o.SceneStep={})),function(e){e[e.None=0]="None",e[e.Hero=1]="Hero",e[e.Enemy=2]="Enemy"}(u=o.SceneAttackSide||(o.SceneAttackSide={}));const{ccclass:h,property:d}=cc._decorator;let v=r=class extends cc.Component{constructor(){super(...arguments),this.parallaxBG=null,this.filter=null,this.conroller=null,this.runningActions=[],this.sceneStep=p.None,this.sceneData=null,this.testSceneSide=u.Hero,this.testDefenders=[]}onLoad(){this.testDefenders[0]=this.conroller.unitSlots[1].node,cc.systemEvent.on(r.EventUnitDeath.eventName,this.onUnitDeath,this)}onDestroy(){cc.systemEvent.off(r.EventUnitDeath.eventName,this.onUnitDeath,this)}onUnitDeath(e){for(let e of this.conroller.unitSlots)if(e.slotType===s.SlotType.Player){let t=e.avatar.getMoveSpeed();this.setSlotsMoveSpeed(t),e.moveAnimated(()=>{}),this.parallaxBG.startMove(t)}}spawnUnitAnim(e,t,o){o=void 0==o||o,e&&e.disappearAnimated(()=>{t(),o?e.appearAnimated(()=>{this.resetSlotsAnim(),e.slotType===s.SlotType.Enemy&&cc.systemEvent.emit(i.CoreInputController.EventBlockingFinished.eventName,new i.CoreInputController.EventBlockingFinished(!0))}):this.resetSlotsAnim()})}setSlotsMoveSpeed(e){this.eachSlot(t=>{t.calculateDuration(e)})}resetSlotsAnim(){this.parallaxBG.stopMove(),this.eachSlot(e=>{e.resetAnim()})}eachSlot(e){for(let t of this.conroller.unitSlots)e(t)}testScene(){this.startScene({side:this.testSceneSide,defenders:this.testDefenders,damage:10}),this.testNextSide()}testNextSide(){switch(this.testDefenders=[],this.testSceneSide){case u.Hero:this.testSceneSide=u.Enemy,this.testDefenders.push(this.conroller.unitSlots[0].node);break;case u.Enemy:this.testSceneSide=u.None,this.testDefenders.push(this.conroller.unitSlots[0].node),this.testDefenders.push(this.conroller.unitSlots[1].node);break;default:this.testSceneSide=u.Hero,this.testDefenders.push(this.conroller.unitSlots[1].node)}}startScene(e){if(this.sceneStep!=p.None)return;this.sceneData=e;let t=this.getSceneAngle(e.side);this.runningActions.push(this.filter.fadeIn(.2)),this.runningActions.push(this.parallaxBG.node.runAction(cc.scaleBy(.2,1.5))),this.runningActions.push(this.parallaxBG.node.runAction(cc.moveTo(.2,cc.v2(0,35)))),this.runningActions.push(this.parallaxBG.node.runAction(cc.rotateBy(.2,t))),this.unitsStartSceneAnim(e.side),this.sceneStep=p.Start}stopScene(){let e=this.sceneData.side,t=-1*this.getSceneAngle(e);this.runningActions.push(this.filter.fadeOut(.2)),this.runningActions.push(this.parallaxBG.node.runAction(cc.scaleBy(.2,1/1.5))),this.runningActions.push(this.parallaxBG.node.runAction(cc.moveTo(.2,cc.v2(0,0)))),this.runningActions.push(this.parallaxBG.node.runAction(cc.rotateBy(.2,t))),this.eachSlot(e=>{e.resetAnim(),e.avatar.resetPosition()}),this.sceneStep=p.Stop}update(e){if(!this.runningActions.length&&this.sceneStep!=p.None)return;let t=!0;for(let e of this.runningActions)if(!e.isDone()){t=!1;break}if(t)switch(this.sceneStep){case p.Start:this.runningActions.push(this.node.runAction(cc.delayTime(2)));for(let e of this.sceneData.defenders){let t=e.getComponent(s.CharacterSlot).avatar.avatar;cc.systemEvent.emit(a.BattleController.EventHitEfx.eventName,new a.BattleController.EventHitEfx(this.sceneData.damage,t))}this.sceneStep=p.Moving;break;case p.Moving:this.stopScene();break;case p.Stop:this.sceneStep=p.None}}unitsStartSceneAnim(e){let t=this.conroller.sortSlots(),o=t[0],r=t[1];switch(e){case u.Hero:o.forEach(e=>{e.avatar.attack()}),r.forEach(e=>{e.avatar.damaged()});break;case u.Enemy:o.forEach(e=>{e.avatar.damaged()}),r.forEach(e=>{e.avatar.attack()});break;default:o.forEach(e=>{e.avatar.damaged()}),r.forEach(e=>{e.avatar.damaged()})}}getSceneAngle(e){let t=0;switch(e){case u.Hero:t=2;break;case u.Enemy:t=-2}return t}};n([d(l.ParallaxBackground)],v.prototype,"parallaxBG",void 0),n([d(c.FilterController)],v.prototype,"filter",void 0),v=r=n([h],v),o.BattleViewController=v,function(e){class t{constructor(e,t){this.slot=null,this.index=0,this.slot=e,this.index=t}}t.eventName="EventUnitDeath",e.EventUnitDeath=t;class o{}o.eventName="GameStarted",e.EventGameStarted=o}(v=o.BattleViewController||(o.BattleViewController={})),o.BattleViewController=v,o.default=v,cc._RF.pop()},{BattleController:"BattleController",CharacterSlot:"CharacterSlot",CoreInputController:"CoreInputController",FilterController:"FilterController",ParallaxBackground:"ParallaxBackground"}],CashDisplay:[function(e,t,o){"use strict";cc._RF.push(t,"5ebaf808/5NvrXE+fr0igKF","CashDisplay");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("GlobalHandler"),a=e("GameComponentsLocator"),{ccclass:i,property:s}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.cashLabel=null}onLoad(){cc.systemEvent.on(n.GlobalHandler.EventNeedUpdate.eventName,this.readGlobalData,this)}start(){this.readGlobalData()}readGlobalData(){let e=a.GameComponentsLocator.get(n.GlobalHandler).data.getCash(0);null!=e&&(cc.log("cash = "+e),null!=this.cashLabel&&(this.cashLabel.string=e.toFixed(0)))}};r([s(cc.Label)],l.prototype,"cashLabel",void 0),l=r([i],l),o.default=l,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",GlobalHandler:"GlobalHandler"}],CharacterAvatarCreator:[function(e,t,o){"use strict";cc._RF.push(t,"23b3fTy9y5H/62Kx57vHAP9","CharacterAvatarCreator"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=(r.requireComponent,r.disallowMultiple,r.menu,e("Health")),s=e("CharacterAvatar"),l=e("SkillsController"),c=e("SkillAIController"),p=e("CharacterSlot"),u=e("CharacterAvatarTypeCreator"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.avatarPrefab=null,t.typeCreator=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.typeCreator=new u.CharacterAvatarTypeCreator},t.prototype.createAvatar=function(e,t,o){if(!this.avatarPrefab)return null;var r=cc.instantiate(this.avatarPrefab).getComponent(s.CharacterAvatar);if(r){r.slotType=e,r.loadedData=o,this.typeCreator.create(o.avatarType,r);var n=t.getComponent(l.SkillsController);if(n){n.owner=r;var a=t.getComponent(c.SkillAIController);a&&e==p.SlotType.Enemy&&(a.controller=n,a.init())}}var u=t.getComponent(i.default);return u&&(u.ownerType=e),r},__decorate([a(cc.Prefab)],t.prototype,"avatarPrefab",void 0),t=__decorate([n],t)}(cc.Component);o.default=h,cc._RF.pop()},{CharacterAvatar:"CharacterAvatar",CharacterAvatarTypeCreator:"CharacterAvatarTypeCreator",CharacterSlot:"CharacterSlot",Health:"Health",SkillAIController:"SkillAIController",SkillsController:"SkillsController"}],CharacterAvatarTypeCreator:[function(e,t,o){"use strict";cc._RF.push(t,"11d1eHjECRBu6UNgwiCo6Db","CharacterAvatarTypeCreator"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("CharacterAvatarTypeHero");(function(e){e[e.None=0]="None",e[e.Hero=1]="Hero"})(r=o.AvatarType||(o.AvatarType={}));var a=function(){function e(){}return e.prototype.create=function(e,t){e!=r.None&&(t.avatarType=this.getType(e,t))},e.prototype.getType=function(e,t){var o=null;switch(e){case r.Hero:o=new n.CharacterAvatarTypeHero(t)}return o},e}();o.CharacterAvatarTypeCreator=a,cc._RF.pop()},{CharacterAvatarTypeHero:"CharacterAvatarTypeHero"}],CharacterAvatarTypeHero:[function(e,t,o){"use strict";cc._RF.push(t,"b0c4b+qrhlIBoahziI1+kmn","CharacterAvatarTypeHero"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CharacterAvatarType"),n=e("CharacterLoader"),a=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.appearAnimated=function(e,t){return this.avatar.forceAnim(n.AnimType.Walk),this.avatar.animatePosition(e,0,t)},t.prototype.disappearAnimated=function(e,t){return[]},t}(r.CharacterAvatarType);o.CharacterAvatarTypeHero=a,cc._RF.pop()},{CharacterAvatarType:"CharacterAvatarType",CharacterLoader:"CharacterLoader"}],CharacterAvatarType:[function(e,t,o){"use strict";cc._RF.push(t,"4af2ajTs8xNUbZoKXiS8SWn","CharacterAvatarType"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){return function(e){this.avatar=null,this.avatar=e}}();o.CharacterAvatarType=r,cc._RF.pop()},{}],CharacterAvatar:[function(e,t,o){"use strict";cc._RF.push(t,"1027en8iCFH3ppTxXGZgLcZ","CharacterAvatar"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CharacterSlot"),n=e("CharacterLoader"),a=cc._decorator,i=a.ccclass,s=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.avatar=null,t.slotType=r.SlotType.Player,t.scaleInitfun=null,t.dbLoaded=!1,t.dbDisplay=null,t.loadedData=null,t.avatarType=null,t.isAlive=!0,t.animQueue=[],t.forceAnimType=n.AnimType.None,t}return __extends(t,e),t.prototype.init=function(){this.dbLoaded=!0,this.resetAnim()},t.prototype.onLoad=function(){this.scaleInitfun=this.lazyScaleInit,this.dbDisplay=this.avatar.getComponent(dragonBones.ArmatureDisplay),this.dbDisplay||cc.log("cant find db display"),this.dbDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onAnimComplete,this),this.dbDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this.onAnimComplete,this)},t.prototype.update=function(e){this.dbLoaded&&this.forceAnimType!=n.AnimType.None&&(this.tryStartAnim(this.forceAnimType),this.forceAnimType=n.AnimType.None)},t.prototype.onAnimComplete=function(e){if(this.animQueue.length>0){var t=this.animQueue.shift();this.dbDisplay.armature().animation.fadeIn(t,.2,0)}},t.prototype.addAnimToQueue=function(e,t){this.animQueue.push({name:e,type:t})},t.prototype.forceAnim=function(e){this.forceAnimType=e},t.prototype.animatePosition=function(e,t,o){return this.scaleInitfun(),this.node.setPosition(cc.v2(e,0)),[this.node.runAction(cc.moveTo(o,cc.v2(t,0)))]},t.prototype.animateOpacity=function(e,t){var o=[];return o.push(this.node.runAction(cc.moveTo(t,cc.v2(-1*e),0))),o.push(this.node.runAction(cc.fadeOut(t))),o},t.prototype.appearAnimated=function(e,t){return null!=this.avatarType?this.avatarType.appearAnimated(e,t):this.animatePosition(e,0,t)},t.prototype.disappearAnimated=function(e,t){return null!=this.avatarType?this.avatarType.disappearAnimated(e,t):this.animateOpacity(e,t)},t.prototype.resetAnim=function(){this.tryStartAnim(n.AnimType.Idle)},t.prototype.moveAnimated=function(e,t){0!=e&&this.animatePosition(e,0,t),this.tryStartAnim(n.AnimType.Walk)},t.prototype.tryStartAnimQueue=function(e){if(null!=this.dbDisplay){var t=this.getAnimName(e);t.length>0&&this.addAnimToQueue(t,e)}},t.prototype.tryStartAnim=function(e){if(null!=this.dbDisplay){var t=this.getAnimName(e);t.length>0&&this.dbDisplay.armature().animation.fadeIn(t,.2,0)}},t.prototype.getAnimName=function(e){var t="",o=this.findAnim(e);return null!=o&&(t=o.name),t},t.prototype.findAnim=function(e){var t=null;if(void 0!=this.loadedData)for(var o=0,r=this.loadedData.anims;o<r.length;o++){var n=r[o];if(n.type===e){t=n;break}}return t},t.prototype.lazyScaleInit=function(){var e=this.node.parent;e&&(this.node.scaleX*=Math.sign(e.scaleX),this.avatar.scaleX*=Math.sign(e.scaleX),this.scaleInitfun=function(){})},t.prototype.getMoveSpeed=function(){var e=0,t=this.findAnim(n.AnimType.Walk);return null!=t&&(e=t.optional),e},t.prototype.attack=function(){this.tryStartAnim(n.AnimType.Attack),this.animatePosition(70,100,2)},t.prototype.damaged=function(){this.tryStartAnim(n.AnimType.Damaged),this.animatePosition(60,40,2)},t.prototype.resetPosition=function(){this.animatePosition(this.node.x,0,.2)},__decorate([s(cc.Node)],t.prototype,"avatar",void 0),t=__decorate([i],t)}(cc.Component);o.CharacterAvatar=l,cc._RF.pop()},{CharacterLoader:"CharacterLoader",CharacterSlot:"CharacterSlot"}],CharacterData:[function(e,t,o){"use strict";cc._RF.push(t,"3cbc3mZvxZEWL5Ny7LfRP3a","CharacterData"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("Health"),i=e("Damage");(function(e){e[e.Health=0]="Health",e[e.Damage=1]="Damage",e[e.BaseTile=2]="BaseTile",e[e.HitDamage=3]="HitDamage",e[e.SkillDamage=4]="SkillDamage",e[e.GoldFind=5]="GoldFind",e[e.MineFind=6]="MineFind",e[e.DamageDemons=7]="DamageDemons",e[e.WoodFind=8]="WoodFind",e[e.HitDefence=9]="HitDefence",e[e.SkillDefence=10]="SkillDefence",e[e.Blocked=11]="Blocked",e[e.Dodged=12]="Dodged",e[e.ReturnDamage=13]="ReturnDamage",e[e.Length=14]="Length"})(r=o.CharacterParamType||(o.CharacterParamType={})),function(e){e[e.Dodge=-1]="Dodge",e[e.Block=-2]="Block"}(n=o.CharacterDefenceType||(o.CharacterDefenceType={}));var s=cc._decorator,l=s.ccclass,c=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.paramList=[],t}return __extends(t,e),t.prototype.onLoad=function(){for(var e=[],t=0;t<r.Length;t++){var o={type:t,access:!0,value:1,default:1};switch(t){case r.HitDefence:case r.SkillDefence:case r.Blocked:case r.Dodged:case r.ReturnDamage:o.default=0,o.value=0}e.push(o)}this.paramList=e},t.prototype.getParams=function(){return this.paramList},t.prototype.setParams=function(e){this.paramList=e},t.prototype.resetStats=function(){for(var e=0,t=this.paramList;e<t.length;e++){var o=t[e];o.value=o.default}},t.prototype.updateStats=function(){var e=this.getComponent(a.Health);if(null!=e){var t=e.baseHealth;this.paramList[r.Health].value;e.setNewHealth(t*this.paramList[r.Health].value)}var o=this.getComponent(i.Damage);if(null!=o){t=o.baseDamage,this.paramList[r.HitDamage].value;o.updateDamage(t*this.paramList[r.HitDamage].value)}},t.prototype.calcHitDamage=function(e){return e*(this.paramList[r.HitDamage].value*this.paramList[r.Damage].value)},t.prototype.calcSkillDamage=function(e){return e*(this.paramList[r.SkillDamage].value*this.paramList[r.Damage].value)},t.prototype.calcReturnDamage=function(e){return e*this.paramList[r.ReturnDamage].value},t.prototype.calcHitDefence=function(e){var t=0;return t=e*(1-this.paramList[r.HitDefence].value),1==this.paramList[r.Dodged].value&&(this.paramList[r.Dodged].value=this.paramList[r.Dodged].default,t=n.Dodge),1==this.paramList[r.Blocked].value&&(t=n.Block),t},t.prototype.calcSkillDefence=function(e){var t=0;return t=e*(1-this.paramList[r.SkillDefence].value),1==this.paramList[r.Blocked].value&&(t=n.Block),t},t=__decorate([l],t)}(cc.Component));o.CharacterData=c,cc._RF.pop()},{Damage:"Damage",Health:"Health"}],CharacterLoader:[function(e,t,o){"use strict";cc._RF.push(t,"08738cF+4JCQ4eLAXwbfnyV","CharacterLoader"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("CharacterAvatarTypeCreator"),a=e("CharacterAvatar");(function(e){e[e.None=0]="None",e[e.Idle=1]="Idle",e[e.Walk=2]="Walk",e[e.Attack=3]="Attack",e[e.Damaged=4]="Damaged",e[e.Death=5]="Death"})(r=o.AnimType||(o.AnimType={}));var i=cc._decorator,s=i.ccclass,l=i.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unitDescription=null,t.heroDescription=null,t.units=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.units=this.unitDescription.json.units,this.units=this.units.concat(this.heroDescription.json.units)},t.prototype.getCharacterData=function(e){for(var t=null,o=0,r=this.units;o<r.length;o++){var n=r[o];n.id==e&&(t={id:e,ske:n.skeName,tex:n.texName,buildInSkill:n.buildInSkill,baseStat:n.baseStat,avatarType:this.convertLoadedAvatarType(n.avatarType),anims:this.convertLoadedAnims(n.anims)})}return t},t.prototype.convertLoadedAnims=function(e){for(var t=[],o=0,r=e;o<r.length;o++){var n=r[o],a=this.convertLoadedAnimType(n.type);t.push({type:a,name:n.name,optional:this.getLoadedAnimOptional(a,n)})}return t},t.prototype.convertLoadedAnimType=function(e){var t=r.None;switch(e){case"Idle":t=r.Idle;break;case"Walk":t=r.Walk;break;case"Attack":t=r.Attack;break;case"Damaged":t=r.Damaged}return t},t.prototype.getLoadedAnimOptional=function(e,t){var o=null;switch(e){case r.Walk:o=t.speed}return o},t.prototype.convertLoadedAvatarType=function(e){var t=n.AvatarType.None;switch(e){case"Hero":t=n.AvatarType.Hero}return t},t.prototype.loadAvatarData=function(e,t){var o=this.getCharacterData(e);this.loadAvatarDataExt(o,t)},t.prototype.loadAvatarDataExt=function(e,t){var o=t.getComponent(dragonBones.ArmatureDisplay),r=this;null!=e&&null!=t&&null!=o?cc.loader.loadRes("DB/"+e.id+"/"+e.ske,dragonBones.DragonBonesAsset,function(n,i){cc.loader.loadRes("DB/"+e.id+"/"+e.tex,dragonBones.DragonBonesAtlasAsset,function(n,s){null==n?(o.dragonAsset=i,o.dragonAtlasAsset=s,r.initArmature(o),r.initDBTransform(o,t),t.parent.getComponent(a.CharacterAvatar).init()):cc.warn("CharacterLoader | can't load data "+e.id+" error "+n)})}):cc.warn("CharacterLoader | fail to load avatar - db - "+o+" - data - "+e+" - avatar - "+t)},t.prototype.initArmature=function(e){var t=e.getArmatureNames();if(t.length){var o=t[0];e.armatureName=o}},t.prototype.initDBTransform=function(e,t){e.armature().flipX=t.getParent().scaleX<0,t.width=e.dragonAtlasAsset.texture.width*t.scaleX,t.height=e.dragonAtlasAsset.texture.height*t.scaleY},t.prototype.getAnimName=function(e,t){return"idle"},__decorate([l(cc.JsonAsset)],t.prototype,"unitDescription",void 0),__decorate([l(cc.JsonAsset)],t.prototype,"heroDescription",void 0),t=__decorate([s],t)}(cc.Component);o.CharacterLoader=c,cc._RF.pop()},{CharacterAvatar:"CharacterAvatar",CharacterAvatarTypeCreator:"CharacterAvatarTypeCreator"}],CharacterSlot:[function(e,t,o){"use strict";cc._RF.push(t,"7b14cqWR0xJQK2cxOUyUZam","CharacterSlot"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=cc._decorator,i=a.ccclass,s=a.property,l=(a.requireComponent,a.disallowMultiple,a.menu,e("CharacterAvatarCreator")),c=e("CharacterLoader"),p=e("GameComponentsLocator"),u=e("Health"),h=e("TransitionDataMapper"),d=e("HeroDataMapper");(function(e){e[e.Player=0]="Player",e[e.Enemy=1]="Enemy",e[e.Stamina=2]="Stamina"})(r=o.SlotType||(o.SlotType={})),function(e){e[e.None=0]="None",e[e.Appear=1]="Appear",e[e.Disappear=2]="Disappear",e[e.Move=3]="Move"}(n=o.ActionType||(o.ActionType={}));var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slotType=r.Player,t.character=null,t.avatar=null,t.runningActions={type:n.None,actions:[]},t.animationDuration=3,t}var o;return __extends(t,e),o=t,t.prototype.update=function(e){if(this.runningActions.type!=n.None&&this.runningActions.actions.length>0){for(var t=!0,r=0,a=this.runningActions.actions;r<a.length;r++){if(!a[r].isDone()){t=!1;break}}if(t){switch(this.runningActions.type){case n.Appear:this.node.emit(o.EventAppear.eventName,new cc.SystemEvent,this)}this.runningActions.actions=[],this.runningActions.type=n.None}}},t.prototype.attachCharacter=function(e,t){this.clear(),this.character=e,this.character.setParent(this.node),this.avatar=t,this.avatar.node.setParent(this.node)},t.prototype.appearAnimated=function(e){this.character?(this.runningActions.type=n.Appear,this.runningActions.actions=this.avatar.appearAnimated(o.CHARACTER_ANIMATION_OFFSET,this.animationDuration),e&&this.scheduleOnce(e,this.animationDuration)):e&&e()},t.prototype.disappearAnimated=function(e){this.character?(this.avatar.disappearAnimated(o.CHARACTER_ANIMATION_OFFSET,this.animationDuration),e&&this.scheduleOnce(e,this.animationDuration)):e&&e()},t.prototype.moveAnimated=function(e){this.character?(this.avatar.moveAnimated(0,this.animationDuration),e&&this.scheduleOnce(e,this.animationDuration)):e&&e()},t.prototype.resetAnim=function(){this.character&&this.avatar.resetAnim()},t.prototype.addAppearListener=function(e,t){this.node.on(o.EventAppear.eventName,e,t)},t.prototype.removeAppearListener=function(e){this.node.off(o.EventAppear.eventName,e)},t.prototype.calculateDuration=function(e){this.animationDuration=Math.abs(o.CHARACTER_ANIMATION_OFFSET/e)},t.prototype.simpleHeroCreate=function(e){var t=this;this.disappearAnimated(function(){var o=p.GameComponentsLocator.get(h.TransitionDataMapper),r=(p.GameComponentsLocator.get(d.HeroDataMapper),p.GameComponentsLocator.get(l.default)),n=p.GameComponentsLocator.get(c.CharacterLoader),a=o.getHero(),i=cc.instantiate(e),s=n.getCharacterData(a.name),v=r.createAvatar(t.slotType,i,s);n.loadAvatarDataExt(s,v.avatar),t.attachCharacter(i,v),t.character.getComponent(u.default).setHealth(a.baseHealth)})},t.prototype.clear=function(){this.character&&(this.character.destroy(),this.character=null),this.avatar&&(this.avatar.node.destroy(),this.avatar=null)},t.CHARACTER_ANIMATION_OFFSET=-300,__decorate([s({type:cc.Enum(r)})],t.prototype,"slotType",void 0),t=o=__decorate([i],t)}(cc.Component);o.CharacterSlot=v,function(e){var t=function(){function e(){}return e.eventName="EventAppear",e}();e.EventAppear=t}(v=o.CharacterSlot||(o.CharacterSlot={})),o.CharacterSlot=v,o.default=v,cc._RF.pop()},{CharacterAvatarCreator:"CharacterAvatarCreator",CharacterLoader:"CharacterLoader",GameComponentsLocator:"GameComponentsLocator",Health:"Health",HeroDataMapper:"HeroDataMapper",TransitionDataMapper:"TransitionDataMapper"}],ChooseOverlayController:[function(e,t,o){"use strict";cc._RF.push(t,"0c8f7tdHXNIQ7TkmrDfa/AF","ChooseOverlayController"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.text="Test Text",t.duration=.5,t.waitFade=!1,t}return __extends(t,e),t.prototype.onEnable=function(){this.setText(this.text),this.waitFade=!1,this.node.runAction(cc.fadeIn(this.duration))},t.prototype.setText=function(e){null!=this.label&&(this.label.string=e)},t.prototype.update=function(e){this.waitFade&&0==this.node.opacity?this.node.active=!1:this.waitFade=255==this.node.opacity||this.waitFade},__decorate([a(cc.Label)],t.prototype,"label",void 0),__decorate([a],t.prototype,"text",void 0),__decorate([a],t.prototype,"duration",void 0),t=__decorate([n],t)}(cc.Component);o.ChooseOverlayController=i,cc._RF.pop()},{}],ClearOnAnimEnd:[function(e,t,o){"use strict";cc._RF.push(t,"fb29bCDC85Po66WpmFJPUmZ","ClearOnAnimEnd"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){var e=this,t=this.getComponent(cc.Animation);if(t){var o=t.currentClip;o?this.scheduleOnce(function(){e.node.destroy()},o.duration):cc.log("No clip found")}else cc.error("No cc.Animation component found")},t=__decorate([n],t)}(cc.Component));o.default=a,cc._RF.pop()},{}],CoreGameplay:[function(e,t,o){"use strict";cc._RF.push(t,"620cdJjhpxMXb9SSe9T79Tl","CoreGameplay"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CoreGrid"),n=e("TileGridDisplay"),a=e("CoreTileCreator"),i=e("CoreMover"),s=e("CoreHistory"),l=e("CoreTileDestroyer"),c=e("CoreTileUpdater"),p=e("CoreTileMover"),u=e("BattleViewController"),h=e("CoreInputController"),d=cc._decorator,v=d.ccclass,f=d.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gridSize=4,t.gridBackground=null,t.creator=null,t.mover=null,t.history=null,t.destroyer=null,t.updater=null,t.tileMover=null,t.gameEnd=!1,t.tileSpawnCount=2,t.defaultTileSpawnCount=2,t}return __extends(t,e),t.prototype.onLoad=function(){cc.systemEvent.on(i.CoreMover.EventGameEnded.eventName,this.onGameEnded,this),this.initGameGrid(this.gridSize),this.creator.core=this,this.mover.core=this,this.mover.creator=this.creator,this.grid.createTile=this.creator.getCreateTile(),this.grid.freeTileData=this.creator.destroyTileDisplay,this.history.core=this,this.destroyer.core=this,this.updater.core=this,this.updater.coreDestroyer=this.destroyer,this.tileMover.core=this,this.tileMover.creator=this.creator,this.resetTileSpawnCount()},t.prototype.start=function(){var e=this;cc.systemEvent.on(u.BattleViewController.EventGameStarted.eventName,function(){e.creator.addStartTiles(),e.history.initState(e.grid)},this)},t.prototype.onGameEnded=function(e){this.gameEnd=!0,cc.systemEvent.emit(h.CoreInputController.EventBlockingStarted.eventName,new h.CoreInputController.EventBlockingStarted(!0)),cc.log("Game won - "+this.gameEnd)},t.prototype.initGameGrid=function(e){this.grid=new r.CoreGrid(e);var t=cc.instantiate(this.gridBackground);t.setParent(this.node),this.gridDisplay=t.getComponent(n.TileGridDisplay),this.gridDisplay.size=e},t.prototype.resetTileSpawnCount=function(){this.tileSpawnCount=this.defaultTileSpawnCount},__decorate([f],t.prototype,"gridSize",void 0),__decorate([f(cc.Prefab)],t.prototype,"gridBackground",void 0),__decorate([f(a.CoreTileCreator)],t.prototype,"creator",void 0),__decorate([f(i.CoreMover)],t.prototype,"mover",void 0),__decorate([f(s.CoreHistory)],t.prototype,"history",void 0),__decorate([f(l.CoreTileDestroyer)],t.prototype,"destroyer",void 0),__decorate([f(c.CoreTileUpdater)],t.prototype,"updater",void 0),__decorate([f(p.CoreTileMover)],t.prototype,"tileMover",void 0),t=__decorate([v],t)}(cc.Component);o.CoreGameplay=m,cc._RF.pop()},{BattleViewController:"BattleViewController",CoreGrid:"CoreGrid",CoreHistory:"CoreHistory",CoreInputController:"CoreInputController",CoreMover:"CoreMover",CoreTileCreator:"CoreTileCreator",CoreTileDestroyer:"CoreTileDestroyer",CoreTileMover:"CoreTileMover",CoreTileUpdater:"CoreTileUpdater",TileGridDisplay:"TileGridDisplay"}],CoreGrid:[function(e,t,o){"use strict";cc._RF.push(t,"77344xLK9ZC45iuiiBc3Ajp","CoreGrid"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function e(e,t){this.history=[],this.size=e,this.cells=this.empty()}return e.prototype.empty=function(){for(var e=[],t=0;t<this.size;t++)for(var o=e[t]=[],r=0;r<this.size;r++)o.push(null);return e},e.prototype.fromState=function(e){for(var t=[],o=0;o<this.size;o++)for(var r=t[o]=[],n=0;n<this.size;n++){var a=e[o][n];r.push(a?this.createTile(a.position,a.value):null)}return t},e.prototype.clearState=function(e){for(var t=[],o=0;o<this.size;o++)for(var r=t[o]=[],n=0;n<this.size;n++){var a=e[o][n];a&&this.freeTileData(a),r.push(null)}return t},e.prototype.isEmpty=function(){var e=!0;return this.eachCell(function(t,o,r){r&&(e=!1)}),e},e.prototype.getTileCount=function(){return this.occupiedCells().length},e.prototype.randomCellValue=function(){var e=this.occupiedCells();if(e.length){var t=e[Math.floor(Math.random()*e.length)];return this.cells[t.x][t.y].value}return cc.warn("CoreGrid | randomCellValue cant find any value"),2},e.prototype.minCellValue=function(){var e=this.occupiedCells();if(e.length){for(var t=null,o=0,r=e;o<r.length;o++){var n=r[o];null==t&&(t=this.cells[n.x][n.y].value),t>this.cells[n.x][n.y].value&&(t=this.cells[n.x][n.y].value)}return t}return 0},e.prototype.maxCellValue=function(){var e=this.occupiedCells();if(e.length){for(var t=null,o=0,r=e;o<r.length;o++){var n=r[o];null==t&&(t=this.cells[n.x][n.y].value),t<this.cells[n.x][n.y].value&&(t=this.cells[n.x][n.y].value)}return t}return 0},e.prototype.hasCellValue=function(e){var t=this.occupiedCells(),o=!1;if(t.length)for(var r=0,n=t;r<n.length;r++){var a=n[r];if(this.cells[a.x][a.y].value==e){o=!0;break}}return o},e.prototype.randomOccupiedCell=function(){var e=this.occupiedCells();return e.length?e[Math.floor(Math.random()*e.length)]:null},e.prototype.randomAvailableCell=function(){var e=this.availableCells();return e.length?e[Math.floor(Math.random()*e.length)]:null},e.prototype.randomPrettyCell=function(e,t){var o=null;if(Math.random()<e){var r=this.prettyCells(t);r.length&&(o=r[Math.floor(Math.random()*r.length)])}return o||(o=this.randomAvailableCell()),o},e.prototype.prettyCells=function(e){for(var t=[],o=0,r=this.availableCells();o<r.length;o++){var n=r[o];this.isPrettyCell(n,e)&&t.push(n)}return t},e.prototype.isPrettyCell=function(e,t){var o=!1;return o=(o=(o=(o=o||this.checkCell(e,!0,1,t))||this.checkCell(e,!0,-1,t))||this.checkCell(e,!1,1,t))||this.checkCell(e,!1,-1,t)},e.prototype.checkCell=function(e,t,o,r){for(var n=!1,a=t?e.x:e.y;a>=0&&a<this.size;){var i=t?this.cells[a][e.y]:this.cells[e.x][a];if(i){if(r!==i.value)break;n=!0}a+=o}return n},e.prototype.availableCells=function(){var e=[];return this.eachCell(function(t,o,r){r||e.push({x:t,y:o})}),e},e.prototype.occupiedCells=function(){var e=[];return this.eachCell(function(t,o,r){r&&e.push({x:t,y:o})}),e},e.prototype.occupiedCellsContent=function(){var e=[];return this.eachCell(function(t,o,r){r&&e.push(r)}),e},e.prototype.eachCell=function(e){for(var t=0;t<this.size;t++)for(var o=0;o<this.size;o++)e(t,o,this.cells[t][o])},e.prototype.cellsAvailable=function(){return!!this.availableCells().length},e.prototype.cellAvailable=function(e){return!this.cellOccupied(e)},e.prototype.cellOccupied=function(e){return!!this.cellContent(e)},e.prototype.cellContent=function(e){return null!=e&&this.withinBounds(e)?this.cells[e.x][e.y]:null},e.prototype.insertTile=function(e){this.cells[e.position.x][e.position.y]=e},e.prototype.removeTile=function(e){this.cells[e.position.x][e.position.y]=null},e.prototype.withinBounds=function(e){return e.x>=0&&e.x<this.size&&e.y>=0&&e.y<this.size},e.prototype.getCellData=function(){for(var e=[],t=0;t<this.size;t++)for(var o=e[t]=[],r=0;r<this.size;r++){var n=this.cells[t][r];o.push(n?n.getData():null)}return e},e.prototype.show=function(){for(var e="",t=0;t<this.size;t++){e+="\n";for(var o=0;o<this.size;o++){var r=this.cells[t][o];e+=r?"\t"+r.value+"\t":"\t0\t"}}e+="\n",cc.log("****************"),cc.log(e),cc.log("****************")},e}();o.CoreGrid=r,cc._RF.pop()},{}],CoreHistory:[function(e,t,o){"use strict";cc._RF.push(t,"269db9DE1pJuIRmlS83YfQ1","CoreHistory"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CoreInputController"),n=cc._decorator,a=n.ccclass,i=(n.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.core=null,t.gridHistory=[],t.historyIndex=0,t}return __extends(t,e),t.prototype.onLoad=function(){cc.systemEvent.on(r.CoreInputController.EventMoveBack.eventName,this.onMovaBack,this)},t.prototype.onMovaBack=function(){this.backState(this.core.grid)},t.prototype.initState=function(e){this.saveState_(0,e)},t.prototype.saveState=function(e){this.historyIndex++,this.saveState_(this.historyIndex,e)},t.prototype.saveState_=function(e,t){var o=t.getCellData();this.gridHistory[e]=o},t.prototype.backState=function(e){this.historyIndex--;e.cells;if(this.historyIndex>=0){e.cells=this.core.grid.clearState(e.cells);var t=this.gridHistory[this.historyIndex];e.cells=this.core.grid.fromState(t)}else this.historyIndex=0},t=__decorate([a],t)}(cc.Component));o.CoreHistory=i,cc._RF.pop()},{CoreInputController:"CoreInputController"}],CoreInputController:[function(e,t,o){"use strict";cc._RF.push(t,"5bac8SUs91CPbjBXxtAvwuP","CoreInputController"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("InputController"),a=e("SwipeController");(function(e){e[e.None=0]="None",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Left=3]="Left",e[e.Down=4]="Down"})(r=o.DirType||(o.DirType={}));var i=cc._decorator,s=i.ccclass,l=(i.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blocks=0,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){cc.systemEvent.on(n.InputController.EVENT_KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(a.SwipeController.EVENT_SWIPE,this.onSwipe,this),cc.systemEvent.on(o.EventBlockingStarted.eventName,this.onBlockingStarted,this),cc.systemEvent.on(o.EventBlockingFinished.eventName,this.onBlockingFinishedd,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(n.InputController.EVENT_KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(a.SwipeController.EVENT_SWIPE,this.onSwipe,this),cc.systemEvent.off(o.EventBlockingStarted.eventName,this.onBlockingStarted,this),cc.systemEvent.off(o.EventBlockingFinished.eventName,this.onBlockingFinishedd,this)},t.prototype.onBlockingStarted=function(){this.blocks++},t.prototype.onBlockingFinishedd=function(){this.blocks--},t.prototype.getActionDir=function(e){var t=r.None;switch(e){case cc.macro.KEY.d:t=r.Right;break;case cc.macro.KEY.w:t=r.Up;break;case cc.macro.KEY.a:t=r.Left;break;case cc.macro.KEY.s:t=r.Down}return t},t.prototype.onKeyDown=function(e){this.blocks>0||cc.systemEvent.emit(o.EventGotDir.eventName,new o.EventGotDir(this.getActionDir(e.keyCode)))},t.prototype.onSwipe=function(e){this.blocks>0||cc.systemEvent.emit(o.EventGotDir.eventName,new o.EventGotDir(e.swipe+1))},t.prototype.moveBackCallback=function(){cc.systemEvent.emit(o.EventMoveBack.eventName,new o.EventMoveBack)},t.prototype.addTileCallback=function(){cc.systemEvent.emit(o.EventAddTile.eventName,new o.EventAddTile)},t=o=__decorate([s],t)}(cc.Component));o.CoreInputController=l,function(e){var t=function(){function e(e){this.direction=r.None,this.direction=e}return e.eventName="EventGotDir",e}();e.EventGotDir=t;var o=function(){function e(){}return e.eventName="EventMoveBack",e}();e.EventMoveBack=o;var n=function(){function e(){}return e.eventName="EventAddTile",e}();e.EventAddTile=n;var a=function(){function e(e){void 0===e&&(e=!1),this.needLockAnim=!1,this.needLockAnim=e}return e.eventName="EventBlockingStarted",e}();e.EventBlockingStarted=a;var i=function(){function e(e){void 0===e&&(e=!1),this.needUnlockAnim=!1,this.needUnlockAnim=e}return e.eventName="EventBlockingFinished",e}();e.EventBlockingFinished=i}(l=o.CoreInputController||(o.CoreInputController={})),o.CoreInputController=l,cc._RF.pop()},{InputController:"InputController",SwipeController:"SwipeController"}],CoreMover:[function(e,t,o){"use strict";cc._RF.push(t,"a619eW6CxBBwarNlVGm0f0z","CoreMover"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CoreInputController"),n=e("CoreTileCreator"),a=e("CoreTile"),i=e("CoreTileMover"),s=cc._decorator,l=s.ccclass,c=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.core=null,t.creator=null,t.mover=null,t.blocking=!1,t.firstBlockPerformed=!1,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){this.creator=this.getComponent(n.CoreTileCreator),this.mover=this.getComponent(i.CoreTileMover),cc.systemEvent.on(r.CoreInputController.EventGotDir.eventName,this.onGameMove,this),cc.systemEvent.on(r.CoreInputController.EventBlockingStarted.eventName,this.blockStart,this),cc.systemEvent.on(r.CoreInputController.EventBlockingFinished.eventName,this.blockPerformed,this)},t.prototype.game_end=function(e){cc.systemEvent.emit(o.EventGameEnded.eventName,new o.EventGameEnded(e))},t.prototype.onGameMove=function(e){this.movePerform(e.direction,o.makeMoveOptions())},t.prototype.blockStart=function(e){this.blocking=!0},t.prototype.blockPerformed=function(e){this.blocking=!1,e.needUnlockAnim&&this.firstBlockPerformed&&this.creator.addPrettyTile(this.core.tileSpawnCount,1),this.firstBlockPerformed=!0},t.prototype.movePerform=function(e,t){if(e!=r.DirType.None&&!this.core.gameEnd){var n,a,i=this,s=this.getVector(e),l=this.buildTraversals(s),c=!1,p=!1,u=0;this.prepareTiles(),l.x.forEach(function(e){l.y.forEach(function(t){if(n={x:e,y:t},a=i.core.grid.cellContent(n)){var o=i.findFarthestPosition(n,s),r=i.core.grid.cellContent(o.next);r&&r.value==a.value&&!r.mergedFrom?(p=!0,u+=i.mover.mergeTiles(a,r)):i.positionsEqual(o.farthest,a.position)||(i.core.tileMover.moveTile(o.farthest,a),c=!0)}})}),(c||p||i.core.grid.isEmpty())&&(cc.systemEvent.emit(o.EventMovePerformed.eventName,new o.EventMovePerformed(u,t.movePerformed)),t.tickPerform&&(cc.systemEvent.emit(o.EventMovePerformEnded.eventName,new o.EventMovePerformEnded),this.tickTiles()),t.createPerform&&!this.blocking&&this.firstBlockPerformed&&this.creator.addPrettyTile(this.core.tileSpawnCount,1),this.movesAvailable()||i.game_end(!1),this.core.history.saveState(this.core.grid))}},t.makeMoveOptions=function(e,t,o){var r={tickPerform:!0,createPerform:!0,movePerformed:{playerCanDealDamage:!0,enemyCanDealDamage:!0}};return r.tickPerform=void 0!=e?e:r.tickPerform,r.createPerform=void 0!=o?o:r.createPerform,r.movePerformed=void 0!=t?t:r.movePerformed,r},t.prototype.getVector=function(e){return{1:{x:0,y:1},2:{x:-1,y:0},3:{x:0,y:-1},4:{x:1,y:0}}[e]},t.prototype.buildTraversals=function(e){for(var t={x:[],y:[]},o=0;o<this.core.grid.size;o++)t.x.push(o),t.y.push(o);return 1==e.x&&(t.x=t.x.reverse()),1==e.y&&(t.y=t.y.reverse()),t},t.prototype.findFarthestPosition=function(e,t){var o;do{e={x:(o=e).x+t.x,y:o.y+t.y}}while(this.core.grid.withinBounds(e)&&this.core.grid.cellAvailable(e));return{farthest:o,next:e}},t.prototype.movesAvailable=function(){return this.core.grid.cellsAvailable()||this.tileMatchesAvailable()},t.prototype.tileMatchesAvailable=function(){for(var e,t=0;t<this.core.grid.size;t++)for(var o=0;o<this.core.grid.size;o++)if(e=this.core.grid.cellContent({x:t,y:o}))for(var r=1;r<5;r++){var n=this.getVector(r),a={x:t+n.x,y:o+n.y},i=this.core.grid.cellContent(a);if(i&&i.value===e.value)return!0}return!1},t.prototype.positionsEqual=function(e,t){return e.x===t.x&&e.y===t.y},t.prototype.prepareTiles=function(){this.core.grid.eachCell(function(e,t,o){o&&(o.mergedFrom=!1,o.savePosition())}),cc.systemEvent.emit(n.CoreTileCreator.EVENT_FINISH_ANIM)},t.prototype.tickTiles=function(){var e=this;this.core.grid.eachCell(function(t,o,r){if(r)switch(r.type){case a.TileType.Chameleon:r.updateValue(e.core.grid.randomCellValue())}})},t=o=__decorate([l],t)}(cc.Component));o.CoreMover=c,function(e){var t=function(){function e(e,t){this.value=0,this.options={playerCanDealDamage:!0,enemyCanDealDamage:!0},this.value=e,this.options=void 0!=t?t:this.options}return e.prototype.merged=function(){return this.value>0},e.eventName="EventMovePerformed",e}();e.EventMovePerformed=t;var o=function(){function e(){}return e.eventName="EventMovePerformEnded",e}();e.EventMovePerformEnded=o;var r=function(){function e(e){this.won=!1,this.won=e}return e.eventName="CoreMover.game_end",e}();e.EventGameEnded=r}(c=o.CoreMover||(o.CoreMover={})),o.CoreMover=c,o.default=c,cc._RF.pop()},{CoreInputController:"CoreInputController",CoreTile:"CoreTile",CoreTileCreator:"CoreTileCreator",CoreTileMover:"CoreTileMover"}],CoreTileCreator:[function(e,t,o){"use strict";cc._RF.push(t,"0d605dmJlVHfIXsgu6Wb5Tx","CoreTileCreator"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("TileDisplay"),n=e("CoreTile"),a=e("CoreInputController"),i=cc._decorator,s=i.ccclass,l=i.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.startTiles=2,t.tileDisplay=null,t.core=null,t}return __extends(t,e),t.prototype.onLoad=function(){cc.systemEvent.on(a.CoreInputController.EventAddTile.eventName,this.onAddTile,this)},t.prototype.onAddTile=function(){this.addRandomTile()},t.prototype.addStartTiles=function(){for(var e=0;e<this.startTiles;e++)this.addRandomTile()},t.prototype.getNewTileValue=function(){return Math.random()<.9?2:4},t.prototype.makeTileValue=function(e){return Math.pow(2,e)},t.prototype.addChameleonTile=function(){var e=this.addRandomTile();null!=e&&(e.type=n.TileType.Chameleon)},t.prototype.trytoAddOrderTile=function(){if(this.core.grid.getTileCount()<1)return!1;for(var e=this.core.grid.minCellValue(),t=this.core.grid.maxCellValue(),o=Math.log2(t/e),r=0;r<o;r++)if(!this.core.grid.hasCellValue(e*Math.pow(2,r+1)))return!1;return null!=this.addRandomTile_(2*t)},t.prototype.addRandomTile=function(){return this.addRandomTile_(this.getNewTileValue())},t.prototype.addRandomTile_=function(e){var t=null;return this.core.grid.cellsAvailable()&&(t=this.createTile(this.core.grid.randomAvailableCell(),e),this.core.grid.insertTile(t)),t},t.prototype.addPrettyTile=function(e,t){for(var o=0;o<e;o++)if(this.core.grid.cellsAvailable()){var r=this.getNewTileValue(),n=this.createTile(this.core.grid.randomPrettyCell(t,r),r);this.core.grid.insertTile(n)}},t.prototype.createTile=function(e,t){return this.createTile_(e,t,this)},t.prototype.createTileDisplay=function(e){this.createTileDisplay_(e,this)},t.prototype.moveAndDestroyTile=function(e,t){this.core.grid.removeTile(t),t.updatePosition(e),t.destroy()},t.prototype.destroyTileDisplay=function(e){e.display.destroyDisplay()},t.prototype.getCreateTile=function(){var e=this;return function(t,o){return e.createTile_(t,o,e)}},t.prototype.createDefaultTiles=function(e){for(var t=[],o=0,r=e;o<r.length;o++){var n=r[o];t.push(this.createTile(n,this.getNewTileValue()))}return t},t.prototype.createTiles=function(e){for(var t=[],o=0,r=e;o<r.length;o++){var n=r[o];t.push(this.createTile(n.position,n.value))}return t},t.prototype.createTile_=function(e,t,o){var r=new n.CoreTile(e,t);return o.createTileDisplay_(r,o),r},t.prototype.createTileDisplay_=function(e,t){var o=cc.instantiate(t.tileDisplay).getComponent(r.TileDisplay);o.grid=t.core.gridDisplay,o.node.setParent(t.core.gridDisplay.node),e.addDisplay(o)},t.EVENT_FINISH_ANIM="CoreTileCreator.finish_anim",__decorate([l],t.prototype,"startTiles",void 0),__decorate([l(cc.Prefab)],t.prototype,"tileDisplay",void 0),t=__decorate([s],t)}(cc.Component);o.CoreTileCreator=c,cc._RF.pop()},{CoreInputController:"CoreInputController",CoreTile:"CoreTile",TileDisplay:"TileDisplay"}],CoreTileDestroyer:[function(e,t,o){"use strict";cc._RF.push(t,"9f728+6zXBByIU8wVDHi18c","CoreTileDestroyer"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CoreTile"),n=cc._decorator,a=n.ccclass,i=(n.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.core=null,t}return __extends(t,e),t.prototype.destroyTile=function(e){return null==e?0:(this.core.grid.removeTile(e),e.destroyEfx(r.DestroyType.Fade),e.value)},t.prototype.destroyTiles=function(e){for(var t=0,o=0,r=e;o<r.length;o++){var n=r[o];t+=this.destroyTile(n)}return t},t.prototype.destroyRow=function(e){for(var t=[],o=0;o<this.core.grid.size;o++)t.push(this.core.grid.cellContent({x:e,y:o}));return this.destroyTiles(t)},t.prototype.destroyCol=function(e){for(var t=[],o=0;o<this.core.grid.size;o++)t.push(this.core.grid.cellContent({x:o,y:e}));return this.destroyTiles(t)},t.prototype.destroyCenter=function(){for(var e=[],t=this.core.grid.size/2,o=t/2,r=o;r<o+t;r++)for(var n=o;n<o+t;n++)e.push(this.core.grid.cellContent({x:r,y:n}));return this.destroyTiles(e)},t.prototype.destroyAll=function(){for(var e=[],t=this.core.grid.size,o=0;o<t;o++)for(var r=0;r<t;r++)e.push(this.core.grid.cellContent({x:o,y:r}));return this.destroyTiles(e)},t.prototype.destroyRandom=function(){return this.destroyTile(this.core.grid.cellContent(this.core.grid.randomOccupiedCell()))},t=__decorate([a],t)}(cc.Component));o.CoreTileDestroyer=i,cc._RF.pop()},{CoreTile:"CoreTile"}],CoreTileMover:[function(e,t,o){"use strict";cc._RF.push(t,"2c728v7hyhMQKENm+g9NUir","CoreTileMover"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CoreMover"),n=e("CoreTile"),a=cc._decorator,i=a.ccclass,s=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.core=null,t.creator=null,t}return __extends(t,e),t.prototype.mergeTiles=function(e,t){return t.mergedFrom=!0,this.creator.moveAndDestroyTile(t.position,e),t.updateValue(2*t.value),t.type=n.TileType.None,t.value},t.prototype.moveTile=function(e,t){this.core.grid.cells[t.position.x][t.position.y]=null,this.core.grid.cells[e.x][e.y]=t,t.updatePosition(e)},t.prototype.swapTiles=function(e,t){this.core.grid.cells[e.position.x][e.position.y]=t,this.core.grid.cells[t.position.x][t.position.y]=e;var o=e.position;e.updatePosition(t.position),t.updatePosition(o)},t.prototype.moveTiles=function(e,t){if(e.length==t.length)for(var o in e)this.moveTile(e[o],t[o])},t.prototype.canMoveRow=function(e,t){return!0},t.prototype.remixAll=function(){var e=this,t=this.core.grid.occupiedCellsContent();this.core.grid.empty();t.forEach(function(t,o,r){var n=e.core.grid.randomAvailableCell();e.moveTile(n,t)})},t.prototype.smartRemixAll=function(){for(var e=[],t=0,o=this.core.grid.occupiedCellsContent();t<o.length;t++){var n=o[t];this.findPair(n,e)}for(var a=0,i=0,s=e;i<s.length;i++){var l=s[i];if(void 0!=l.first&&void 0!=l.second)a+=this.mergeTiles(l.first,l.second);else{var c=this.core.grid.randomAvailableCell();this.moveTile(c,l.first)}}a>0&&cc.systemEvent.emit(r.CoreMover.EventMovePerformed.eventName,new r.CoreMover.EventMovePerformed(a,r.CoreMover.makeMoveOptions().movePerformed))},t.prototype.findPair=function(e,t){for(var o=!1,r=0,n=t;r<n.length;r++){var a=n[r];if(a.first.value==e.value&&void 0==a.second){o=!0,a.second=e;break}}o||t.push({first:e,second:void 0})},t=__decorate([i],t)}(cc.Component));o.CoreTileMover=s,cc._RF.pop()},{CoreMover:"CoreMover",CoreTile:"CoreTile"}],CoreTileUpdater:[function(e,t,o){"use strict";cc._RF.push(t,"71017w3yJBI7Kras3AOQy12","CoreTileUpdater"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=(r.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.core=null,t.coreDestroyer=null,t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.updateTile=function(e,t){null!=t&&(e<2?this.coreDestroyer.destroyTile(t):t.updateValue(e))},t.prototype.getRelativeValue=function(e,t){return Math.sign(e)>=0?t*Math.pow(2,Math.abs(e)):t/Math.pow(2,Math.abs(e))},t.prototype.updateTileRelative=function(e,t){this.updateTile(this.getRelativeValue(e,t.value),t)},t.prototype.updateTiles=function(e,t){for(var o=0,r=t;o<r.length;o++){var n=r[o];this.updateTileRelative(e,n)}},t.prototype.updateAll=function(e){for(var t=[],o=this.core.grid.size,r=0;r<o;r++)for(var n=0;n<o;n++)t.push(this.core.grid.cellContent({x:r,y:n}));t=t.filter(function(e){return null!=e}),this.updateTiles(e,t)},t.prototype.updateRandom=function(e){this.updateTileRelative(e,this.core.grid.cellContent(this.core.grid.randomAvailableCell()))},t=__decorate([n],t)}(cc.Component));o.CoreTileUpdater=a,cc._RF.pop()},{}],CoreTile:[function(e,t,o){"use strict";cc._RF.push(t,"a6fa80e0edC3okZYZop8c0w","CoreTile"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("TileAnim"),i=e("GameComponentsLocator");(function(e){e[e.None=0]="None",e[e.Fade=1]="Fade"})(r=o.DestroyType||(o.DestroyType={})),function(e){e[e.None=0]="None",e[e.Chameleon=1]="Chameleon"}(n=o.TileType||(o.TileType={}));var s=function(){function e(e,t){this.value=0,this.mergedFrom=!1,this.display=null,this.opacity=255,this.type=n.None,this.value=t,this.position=e}return e.prototype.savePosition=function(){this.previousPosition=this.position},e.prototype.updatePosition=function(e){this.position=e;var t=this.display.getPosition(),o=this.display.getCellPosition(e);this.display.setTargetPosition(o),this.display.addAnim(i.GameComponentsLocator.get(a.TileAnim).create(a.AnimType.Move,[this.display,t,o]))},e.prototype.updateValue=function(e){this.value=e,this.display.addAnim(i.GameComponentsLocator.get(a.TileAnim).create(a.AnimType.Twink,[this.display,e]))},e.prototype.addDisplay=function(e){this.display=e,e.tileData=this,this.updateDisplay()},e.prototype.updateDisplay=function(){null!=this.display&&this.display.updateFromTile(this.position,this.value)},e.prototype.getData=function(){return{position:this.position,value:this.value}},e.prototype.destroy=function(){this.display.addAnim(i.GameComponentsLocator.get(a.TileAnim).create(a.AnimType.Destroy,[this.display]))},e.prototype.destroyEfx=function(e){switch(e){case r.Fade:this.display.addAnim(i.GameComponentsLocator.get(a.TileAnim).create(a.AnimType.DestroyFade,[this.display]));break;default:this.destroy()}},e}();o.CoreTile=s,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",TileAnim:"TileAnim"}],Damage:[function(e,t,o){"use strict";cc._RF.push(t,"fcd26BlK1RLQa38LEbhsc/S","Damage"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=(r.requireComponent,r.disallowMultiple,r.menu,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.baseDamage=0,t.damage=0,t}return __extends(t,e),t.prototype.setDamage=function(e){this.baseDamage=e,this.damage=this.baseDamage},t.prototype.updateDamage=function(e){this.damage=e},__decorate([a],t.prototype,"baseDamage",void 0),t=__decorate([n],t)}(cc.Component));o.Damage=i,cc._RF.pop()},{}],DataMapper:[function(e,t,o){"use strict";cc._RF.push(t,"3b8fbyJshpLGoJq21RujMkv","DataMapper"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("TransitionDataMapper"),a=e("Health"),i=e("CharacterSlot"),s=e("HeroDataMapper"),l=e("AudioManager");(function(e){e[e.Gold=0]="Gold",e[e.Wood=1]="Wood",e[e.Stone=2]="Stone"})(r=o.ResourceType||(o.ResourceType={}));var c=cc._decorator,p=c.ccclass,u=c.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transitionData=null,t.heroData=null,t.playerID="Demo",t.defaultSound=!0,t.defaultMusic=!0,t.global=null,t.audioManager=null,t}return __extends(t,e),t.prototype.setDefault=function(){this.heroData.setDefault(),this.data={selected_hero_id:this.transitionData.getHero().uniqueID,playerID:this.playerID,resources:[{type:r.Gold,amount:5e4},{type:r.Wood,amount:5e4},{type:r.Stone,amount:5e4}],optionsData:{sound:this.defaultSound,music:this.defaultMusic},stamina:{current:5,max:5,timestamp:0,recoverySpeed:10},heroes:this.heroData.getHeroes(),items:this.heroData.getItems()}},t.prototype.update=function(e){if(this.data.stamina.current<this.data.stamina.max){var t=Date.now();if(t>this.data.stamina.timestamp){var o=(t-this.data.stamina.timestamp)/(1e3*this.data.stamina.recoverySpeed);o=Math.round(o)+1,this.setStamina(this.data.stamina.current+o),this.data.stamina.current<this.data.stamina.max&&this.staminaResetTime()}}},t.prototype.lootAddFromTransition=function(){var e=this.transitionData.getLoot();if(null!=e){var t=e.items,o=e.heroes,r=e.resources;if(this.data.heroes=this.heroData.getHeroes(),this.data.items=this.heroData.getItems(),void 0!=t&&t.length>0&&(this.data.items=this.data.items.concat(t)),void 0!=o&&o.length>0&&(this.data.heroes=this.data.heroes.concat(o)),void 0!=r&&r.length>0)for(var n=0,a=r;n<a.length;n++){var i=a[n];this.tryAddResource(i)}this.heroData.setHeroes(this.data.heroes),this.heroData.setItems(this.data.items)}},t.prototype.tryAddResource=function(e){void 0!=this.data.resources.find(function(t){return t.type==e.type})?this.data.resources=this.data.resources.map(function(t){return t.type==e.type&&(t.amount+=e.amount),t}):this.data.resources.push(e)},t.prototype.staminaResetTime=function(){this.data.stamina.timestamp=Date.now()+1e3*this.data.stamina.recoverySpeed,this.global.needSave=!0},t.prototype.staminaUpdateUI=function(){var e=this.data.stamina;cc.systemEvent.emit(a.default.EventHealthChanged.eventName,new a.default.EventHealthChanged(e.max,e.current/e.max,i.SlotType.Stamina))},t.prototype.setStamina=function(e){this.data.stamina.current==this.data.stamina.max&&e<this.data.stamina.current&&this.staminaResetTime(),this.data.stamina.current=cc.misc.clampf(e,0,this.data.stamina.max),this.staminaUpdateUI()},t.prototype.getStamina=function(){return this.data.stamina},t.prototype.getData=function(){return this.data.heroes=this.heroData.getHeroes(),this.data.items=this.heroData.getItems(),this.data.selected_hero_id=this.transitionData.getHero().uniqueID,this.data},t.prototype.setData=function(e){this.data=e,this.heroData.setHeroes(this.data.heroes),this.heroData.setItems(this.data.items),this.transitionData.setHeroByID(this.data.selected_hero_id)},t.prototype.getCash=function(e){return this.data.resources.find(function(t){return t.type==e}).amount},t.prototype.setCash=function(e,t){this.data.resources.find(function(t){return t.type==e}).amount=t},t.prototype.getOptionsData=function(){return this.data.optionsData},t.prototype.setOptionsData=function(e){this.data.optionsData=e,this.updateAudioSettings()},t.prototype.updateAudioSettings=function(){this.audioManager.setSettingFlag(l.AudioSettingFlag.EnableEffects,this.data.optionsData.sound),this.audioManager.setSettingFlag(l.AudioSettingFlag.EnableThemes,this.data.optionsData.music)},__decorate([u(n.TransitionDataMapper)],t.prototype,"transitionData",void 0),__decorate([u(s.HeroDataMapper)],t.prototype,"heroData",void 0),__decorate([u],t.prototype,"playerID",void 0),__decorate([u],t.prototype,"defaultSound",void 0),__decorate([u],t.prototype,"defaultMusic",void 0),t=__decorate([p],t)}(cc.Component);o.DataMapper=h,cc._RF.pop()},{AudioManager:"AudioManager",CharacterSlot:"CharacterSlot",Health:"Health",HeroDataMapper:"HeroDataMapper",TransitionDataMapper:"TransitionDataMapper"}],DebugHelper:[function(e,t,o){"use strict";cc._RF.push(t,"3ebd9ZXfkFAIZM74nD+wgjj","DebugHelper"),Object.defineProperty(o,"__esModule",{value:!0}),o.logHierarchy=function(e=null){e||(e=cc.director.getScene()),function e(t,o){let r="  ".repeat(o);console.log(`"${r}${t.name} (${t.width}x${t.height}) at (${t.x},${t.y})"`);for(var n=0;n<t.childrenCount;n++)e(t.children[n],o+1)}(e,0)},cc._RF.pop()},{}],EfxGlobalController:[function(e,t,o){"use strict";cc._RF.push(t,"5c0c3Qfe8RJF6Jj8QFfTjj9","EfxGlobalController"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("HitEfxController"),n=e("BattleController"),a=e("HeroSkill"),i=cc._decorator,s=i.ccclass,l=i.property,c=function(){function e(){this.offsetsXSpawn=[0,50,-50],this.offsetsXIndex=0}return e.prototype.updateIndex=function(){this.offsetsXIndex=this.offsetsXIndex<this.offsetsXSpawn.length-1?this.offsetsXIndex+1:0},e}();o.HitEfxContext=c;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hitEfx=null,t.skillReloadEfx=null,t.hitEfxContext=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.hitEfxContext=new c,cc.systemEvent.on(n.BattleController.EventHitEfx.eventName,this.createEfxOnHit,this),cc.systemEvent.on(a.HeroSkill.EventReloadFinished.eventName,this.createEfxOnSkillReload,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(n.BattleController.EventHitEfx.eventName,this.createEfxOnHit,this),cc.systemEvent.off(a.HeroSkill.EventReloadFinished.eventName,this.createEfxOnSkillReload,this)},t.prototype.createEfxOnHit=function(e){var t=cc.instantiate(this.hitEfx);t.setParent(e.owner);var o=t.getComponent(r.HitEfxController),n=this.hitEfxContext.offsetsXSpawn[this.hitEfxContext.offsetsXIndex];this.hitEfxContext.updateIndex();var a=e.owner.height/2,i=e.damage;o.init(i,n,a)},t.prototype.createEfxOnSkillReload=function(e){cc.instantiate(this.skillReloadEfx).setParent(e.owner)},__decorate([l(cc.Prefab)],t.prototype,"hitEfx",void 0),__decorate([l(cc.Prefab)],t.prototype,"skillReloadEfx",void 0),t=__decorate([s],t)}(cc.Component);o.EfxGlobalController=p,cc._RF.pop()},{BattleController:"BattleController",HeroSkill:"HeroSkill",HitEfxController:"HitEfxController"}],EventMover:[function(e,t,o){"use strict";cc._RF.push(t,"2e81d3B98RGLYJ5ougUP51l","EventMover"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeToMove=null,t.moveAnimTime=.5,t.targetPos=null,t.initPos=null,t.startShow=!1,t}return __extends(t,e),t.prototype.onLoad=function(){if(null==this.nodeToMove)return this.node.destroy(),void cc.warn("EventMover | wrong node to move");this.initPos=this.node.position,this.node.runAction(cc.moveBy(this.moveAnimTime,this.targetPos))},t.prototype.show=function(){this.startShow||(this.node.runAction(cc.moveTo(this.moveAnimTime,this.initPos)),this.startShow=!0)},t.prototype.hide=function(e){this.startShow&&(this.startShow=!1,this.node.runAction(cc.sequence(cc.moveBy(this.moveAnimTime,this.targetPos),cc.callFunc(void 0!=e?e:function(){},this))))},__decorate([a(cc.Node)],t.prototype,"nodeToMove",void 0),__decorate([a],t.prototype,"moveAnimTime",void 0),__decorate([a(cc.Vec2)],t.prototype,"targetPos",void 0),t=__decorate([n],t)}(cc.Component);o.EventMover=i,cc._RF.pop()},{}],FilterController:[function(e,t,o){"use strict";cc._RF.push(t,"dc2b5IUynVDuYpGywOkDU/z","FilterController"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.opacity=190,t.duration=.2,t}return __extends(t,e),t.prototype.fadeIn=function(e){var t=void 0!=e?e:this.duration;return this.node.runAction(cc.fadeTo(t,this.opacity))},t.prototype.fadeOut=function(e){var t=void 0!=e?e:this.duration;return this.node.runAction(cc.fadeTo(t,0))},__decorate([a],t.prototype,"opacity",void 0),__decorate([a],t.prototype,"duration",void 0),t=__decorate([n],t)}(cc.Component);o.FilterController=i,cc._RF.pop()},{}],GameComponentsLocator:[function(e,t,o){"use strict";cc._RF.push(t,"1709aHN0RND149V+z5DYc/4","GameComponentsLocator");var r,n=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:a}=cc._decorator;let i=r=class extends cc.Component{onLoad(){r.instance=this,this.dictionary=new Map}onEnable(){this.dictionary=new Map}static add(e,t){return null!=t&&(this.instance.dictionary.has(e)?(cc.log("ComponentCache.Add() Already contains instance id of object. type:{type}"),!1):(this.instance.dictionary.set(e,t),!0))}static remove(e){this.instance.dictionary.delete(e)}static get(e){if(!this.instance.dictionary.has(e)){let t=cc.director.getScene().getComponentInChildren(e);return null!=t?(this.add(e,t),t):(cc.log(`GameComponentsLocator | cant find obj of type ${e}`),null)}return this.instance.dictionary.get(e)}};i.instance=null,i=r=n([a],i),o.GameComponentsLocator=i,cc._RF.pop()},{}],GameOverController:[function(e,t,o){"use strict";cc._RF.push(t,"bd37fYqTJBEuYEmFmI5uHT1","GameOverController"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CoreMover"),n=e("GameComponentsLocator"),a=e("GlobalHandler"),i=e("MathHelper"),s=cc._decorator,l=s.ccclass,c=s.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.header=null,t.goldLabel=null,t.stoneLabel=null,t.woodLabel=null,t.backSpr=null,t.winSpr=null,t.loseSpr=null,t.winBtnSpr=null,t.loseBtnSpr=null,t.okBtn=null,t.retryBtn=null,t.quitBtn=null,t.winText="\u0412\u044b \u0432\u044b\u0438\u0433\u0440\u0430\u043b\u0438!",t.loseText="\u0412\u044b \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438!",t.resourceAnimTime=1,t.globalHandler=null,t.transitionData=null,t.dataMapper=null,t.heroData=null,t.goldTarget=0,t.stoneTarget=0,t.woodTarget=0,t.resourceAnimFunc=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.node.active=!1,cc.systemEvent.on(r.CoreMover.EventGameEnded.eventName,this.onGetEnd,this),this.globalHandler=n.GameComponentsLocator.get(a.GlobalHandler),this.transitionData=this.globalHandler.data.transitionData,this.dataMapper=this.globalHandler.data,this.heroData=this.globalHandler.data.heroData},t.prototype.onDestroy=function(){cc.systemEvent.off(r.CoreMover.EventGameEnded.eventName,this.onGetEnd,this)},t.prototype.onGetEnd=function(e){e.won?(this.header.string=this.winText,this.backSpr.spriteFrame=this.winSpr,this.retryBtn.node.active=!1,this.quitBtn.node.active=!1):(this.header.string=this.loseText,this.backSpr.spriteFrame=this.loseSpr,this.retryBtn.node.active=!0,this.quitBtn.node.active=!0),this.node.active=!0,this.resourceAnimFunc=i.getLerp(0,1,this.resourceAnimTime),cc.log("GameOverController | onGetEnd")},t.prototype.onEnable=function(){cc.log("GameOverController | onEnable"),this.updateUI(0,0,0)},t.prototype.update=function(e){if(null!=this.resourceAnimFunc){var t=this.resourceAnimFunc(e),o=Math.round(this.goldTarget*t),r=Math.round(this.woodTarget*t),n=Math.round(this.stoneTarget*t);this.updateUI(o,r,n)}},t.prototype.updateUI=function(e,t,o){this.goldLabel.string=e.toString(),this.woodLabel.string=t.toString(),this.stoneLabel.string=o.toString()},__decorate([c(cc.Label)],t.prototype,"header",void 0),__decorate([c(cc.Label)],t.prototype,"goldLabel",void 0),__decorate([c(cc.Label)],t.prototype,"stoneLabel",void 0),__decorate([c(cc.Label)],t.prototype,"woodLabel",void 0),__decorate([c(cc.Sprite)],t.prototype,"backSpr",void 0),__decorate([c(cc.SpriteFrame)],t.prototype,"winSpr",void 0),__decorate([c(cc.SpriteFrame)],t.prototype,"loseSpr",void 0),__decorate([c(cc.SpriteFrame)],t.prototype,"winBtnSpr",void 0),__decorate([c(cc.SpriteFrame)],t.prototype,"loseBtnSpr",void 0),__decorate([c(cc.Button)],t.prototype,"okBtn",void 0),__decorate([c(cc.Button)],t.prototype,"retryBtn",void 0),__decorate([c(cc.Button)],t.prototype,"quitBtn",void 0),__decorate([c],t.prototype,"winText",void 0),__decorate([c],t.prototype,"loseText",void 0),__decorate([c],t.prototype,"resourceAnimTime",void 0),t=__decorate([l],t)}(cc.Component);o.GameOverController=p,cc._RF.pop()},{CoreMover:"CoreMover",GameComponentsLocator:"GameComponentsLocator",GlobalHandler:"GlobalHandler",MathHelper:"MathHelper"}],GlobalHandler:[function(e,t,o){"use strict";cc._RF.push(t,"64a04zQrhtH3I5+1XYl+5Yh","GlobalHandler"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("Storage"),n=e("DataMapper"),a=e("AudioConfig"),i=e("AudioManager"),s=cc._decorator,l=s.ccclass,c=s.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clearSavedData=!1,t.data=null,t.needSave=!1,t.audioConfig=null,t.audio=new i.AudioManager,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){cc.systemEvent.on(o.EventNeedSave.eventName,this.onNeedSave,this),cc.systemEvent.on(o.EventNeedLoad.eventName,this.onNeedLoad,this),this.data.global=this,this.clearSavedData?(this.data.setDefault(),r.Storage.clear()):cc.systemEvent.emit(o.EventNeedLoad.eventName),this.audio.configure(this.audioConfig.build()),this.data.audioManager=this.audio,this.data.updateAudioSettings(),cc.systemEvent.on(i.AudioManager.EventPlaySfx.eventName,this.onPlayAudioSfx,this),cc.systemEvent.on(i.AudioManager.EventPlayTheme.eventName,this.onPlayAudioTheme,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(o.EventNeedSave.eventName,this.onNeedSave,this),cc.systemEvent.off(o.EventNeedLoad.eventName,this.onNeedLoad,this),cc.systemEvent.off(i.AudioManager.EventPlaySfx.eventName,this.onPlayAudioSfx,this),cc.systemEvent.off(i.AudioManager.EventPlayTheme.eventName,this.onPlayAudioTheme,this)},t.prototype.update=function(e){this.needSave&&(this.needSave=!1,cc.systemEvent.emit(o.EventNeedSave.eventName)),this.audio.update(e)},t.prototype.onNeedSave=function(){r.Storage.gameSave()},t.prototype.onNeedLoad=function(){r.Storage.gameLoad()},t.prototype.onPlayAudioSfx=function(e){this.audio.playEffect(e.sfx)},t.prototype.onPlayAudioTheme=function(e){this.audio.playTheme(e.theme)},t.prototype.getID=function(){return o.SAVE_ID},t.prototype.save=function(){var e="";return cc.log("GlobalHandler | save | Player data saved"),this.data&&(e=JSON.stringify(this.data.getData())),e},t.prototype.load=function(e){var t=JSON.parse(e);null!=t?this.data.setData(t):this.data.setDefault()},t.SAVE_ID="GlobalHandler",__decorate([c],t.prototype,"clearSavedData",void 0),__decorate([c(n.DataMapper)],t.prototype,"data",void 0),__decorate([c(a.AudioConfigProps)],t.prototype,"audioConfig",void 0),t=o=__decorate([l],t)}(cc.Component);o.GlobalHandler=p,function(e){var t=function(){function e(){}return e.eventName="EventNeedSave",e}();e.EventNeedSave=t;var o=function(){function e(){}return e.eventName="EventNeedLoad",e}();e.EventNeedLoad=o;var r=function(){function e(){}return e.eventName="EventNeedUpdate",e}();e.EventNeedUpdate=r}(p=o.GlobalHandler||(o.GlobalHandler={})),o.GlobalHandler=p,o.default=p,cc._RF.pop()},{AudioConfig:"AudioConfig",AudioManager:"AudioManager",DataMapper:"DataMapper",Storage:"Storage"}],HealthBar:[function(e,t,o){"use strict";cc._RF.push(t,"27e2bCzGM5Nk47G35Iufyaz","HealthBar"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=(r.requireComponent,r.disallowMultiple,r.menu,e("Health")),s=e("CharacterSlot"),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ownerType=s.SlotType.Enemy,t.animated=!0,t.animationFactor=1,t.animationFactorOverlay=1,t.bar=null,t.damage_overlay_bar=null,t.targetProgress=0,t.opacityDamage=125,t.amount=null,t.showMaxAmount=!1,t.current_delta_time=1,t}return __extends(t,e),t.prototype.onLoad=function(){cc.systemEvent.on(i.default.EventHealthChanged.eventName,this.updateTargetProgress,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(i.default.EventHealthChanged.eventName,this.updateTargetProgress,this)},t.prototype.updateTargetProgress=function(e){if(e.ownerType==this.ownerType)if(this.targetProgress=e.amount,this.showMaxAmount){var t=Math.round(e.amount*e.max).toString(),o=e.max.toString();this.amount.string=t+"/"+o}else this.amount.string=Math.round(e.amount*e.max).toString()},t.prototype.update=function(e){if(this.current_delta_time+=e,this.animated){var t=this.bar.progress,o=this.targetProgress-t;1===this.targetProgress?Math.abs(o)>e&&(o=(o=Math.sign(o)*this.animationFactorOverlay*e)>0?2*o:o,this.damage_overlay_bar.progress=cc.misc.clampf(t+o,0,1)):this.damage_overlay_bar.progress=this.targetProgress,Math.abs(o)>e?(o=(o=Math.sign(o)*this.animationFactor*e)>0?2*o:o,this.current_delta_time>.1&&(this.current_delta_time=0,255===this.bar.node.opacity?this.bar.node.opacity=this.opacityDamage:this.bar.node.opacity=255),this.bar.progress=cc.misc.clampf(t+o,0,1)):this.bar.progress=this.targetProgress}else this.bar.progress=this.targetProgress},__decorate([a({type:cc.Enum(s.SlotType)})],t.prototype,"ownerType",void 0),__decorate([a],t.prototype,"animated",void 0),__decorate([a],t.prototype,"animationFactor",void 0),__decorate([a],t.prototype,"animationFactorOverlay",void 0),__decorate([a(cc.ProgressBar)],t.prototype,"bar",void 0),__decorate([a(cc.ProgressBar)],t.prototype,"damage_overlay_bar",void 0),__decorate([a],t.prototype,"opacityDamage",void 0),__decorate([a(cc.Label)],t.prototype,"amount",void 0),__decorate([a],t.prototype,"showMaxAmount",void 0),t=__decorate([n],t)}(cc.Component);o.default=l,cc._RF.pop()},{CharacterSlot:"CharacterSlot",Health:"Health"}],Health:[function(e,t,o){"use strict";cc._RF.push(t,"40fd1ye/IVOO5TP7enQTumk","Health"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=e("MathHelper"),s=e("CharacterSlot"),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.baseHealth=0,t.parentHealth=null,t.maxHealth=0,t.health=0,t.ownerType=s.SlotType.Enemy,t.deathEventEmitted=!1,t}var o;return __extends(t,e),o=t,t.prototype.takePercentDamage=function(e){if(this.parentHealth)return this.parentHealth.takeDamage(e);this.updateHealth(this.health-this.maxHealth*e)},t.prototype.takeDamage=function(e){if(this.parentHealth)return this.parentHealth.takeDamage(e);this.updateHealth(this.health-e)},t.prototype.isAlive=function(){return this.health>0},t.prototype.getProgress=function(){return this.health/this.maxHealth},t.prototype.updateHealth=function(e){if(this.parentHealth)return this.parentHealth.updateHealth(e);this.isAlive()||cc.log("Trying to update health of a dead node"),this.health=i.clamp(e,0,this.maxHealth),this.updateGUIData(),this.isAlive()||this.deathEventEmitted||(this.deathEventEmitted=!0,this.node.emit(o.EventHealthDepleted.eventName))},t.prototype.onLoad=function(){this.setHealth(this.baseHealth)},t.prototype.updateGUIData=function(){cc.systemEvent.emit(o.EventHealthChanged.eventName,new o.EventHealthChanged(this.maxHealth,this.getProgress(),this.ownerType))},t.prototype.setHealth=function(e){this.maxHealth=e,this.health=this.maxHealth,this.updateGUIData()},t.prototype.setNewHealth=function(e){this.maxHealth=e,this.updateHealth(this.health)},__decorate([a],t.prototype,"baseHealth",void 0),__decorate([a(o)],t.prototype,"parentHealth",void 0),t=o=__decorate([n],t)}(cc.Component);o.Health=l,function(e){var t=function(){function e(){}return e.eventName="EventHealthDepleted",e}();e.EventHealthDepleted=t;var o=function(){function e(e,t,o){this.max=e,this.amount=t,this.ownerType=o}return e.eventName="EventHealthChanged",e}();e.EventHealthChanged=o}(l=o.Health||(o.Health={})),o.Health=l,o.default=l,cc._RF.pop()},{CharacterSlot:"CharacterSlot",MathHelper:"MathHelper"}],HeroDataMapper:[function(e,t,o){"use strict";cc._RF.push(t,"693f51xIulAaLfPOlRVeFhN","HeroDataMapper");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("MathHelper");var a,i,s;(function(e){e[e.None=0]="None",e[e.Trash=1]="Trash",e[e.Common=2]="Common",e[e.Rare=3]="Rare",e[e.Legendary=4]="Legendary"})(a=o.RareType||(o.RareType={})),function(e){e[e.None=0]="None",e[e.Body=1]="Body",e[e.Weapon=2]="Weapon",e[e.Helmet=3]="Helmet",e[e.Amulet=4]="Amulet",e[e.Ring=5]="Ring",e[e.Length=6]="Length"}(i=o.ItemType||(o.ItemType={})),function(e){e[e.Strength=1]="Strength",e[e.Agility=2]="Agility",e[e.Intelligence=3]="Intelligence"}(s=o.BaseStatType||(o.BaseStatType={})),function(e){e[e.BaseStatType=1]="BaseStatType",e[e.RareType=10]="RareType",e[e.ItemType=1]="ItemType",e[e.Level=1]="Level"}(o.Assessment||(o.Assessment={}));const{ccclass:l,property:c}=cc._decorator;let p=class extends cc.Component{constructor(){super(...arguments),this.heroes=[],this.items=[]}setDefault(){let e=n.uniqueID(),t=n.uniqueID();this.heroes=[{uniqueID:e,name:"Warrior",rarity:a.Common,baseStat:s.Strength,starCount:1,level:1,slots:[{type:i.Body,itemID:e},{type:i.Weapon,itemID:""}],baseHealth:30,baseDamage:2},{uniqueID:t,name:"Warrior2",rarity:a.Common,baseStat:s.Strength,starCount:1,level:1,slots:[{type:i.Body,itemID:e},{type:i.Weapon,itemID:""}],baseHealth:2,baseDamage:1}],this.items=[{uniqueID:e,type:i.Body,iconIndex:0,rarity:a.Common,baseStat:s.Strength,starCount:0,level:1,experience:0,skillLevel:1,skill:"Regeneration",health:10,damage:2,cost:200,heroIDsAttachTo:[e,t]},{uniqueID:n.uniqueID(),type:i.Weapon,iconIndex:0,rarity:a.Common,baseStat:s.Strength,starCount:2,level:7,experience:0,skillLevel:1,skill:"Regeneration",health:11,damage:4,cost:5e3,heroIDsAttachTo:[]},{uniqueID:n.uniqueID(),type:i.Weapon,iconIndex:0,rarity:a.Legendary,baseStat:s.Agility,starCount:3,level:5,experience:0,skillLevel:1,skill:"Regeneration",health:111,damage:20,cost:100,heroIDsAttachTo:[]},{uniqueID:n.uniqueID(),type:i.Weapon,iconIndex:0,rarity:a.Common,baseStat:s.Intelligence,starCount:2,level:56,experience:0,skillLevel:1,skill:"Regeneration",health:134,damage:22,cost:50,heroIDsAttachTo:[]}]}isHeroID(e){return void 0!==this.heroes.find(t=>t.uniqueID===e)}getHeroItems(e){return this.items.filter(t=>{return void 0!==e.slots.find(e=>e.itemID===t.uniqueID)})}deleteItem(e){this.items=this.items.filter(t=>t.uniqueID!==e)}setItem(e){this.items=this.items.map(t=>(t.uniqueID===e.uniqueID&&(t=e),t))}getItem(e){return this.items.find(t=>t.uniqueID===e)}getHero(e){return this.heroes.find(t=>t.uniqueID===e)}getHeroes(){return this.heroes}setHeroes(e){return this.heroes=e}getItems(){return this.items}setItems(e){return this.items=e}};p=r([l],p),o.HeroDataMapper=p,cc._RF.pop()},{MathHelper:"MathHelper"}],HeroSkillPanel:[function(e,t,o){"use strict";cc._RF.push(t,"d7d7bUUhaBOerId4VG7Zf7a","HeroSkillPanel");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("SkillsController"),a=e("HeroSkill"),i=e("SkillLoader"),s=e("CharacterSlot"),l=e("EventMover"),{ccclass:c,property:p}=cc._decorator;let u=class extends cc.Component{constructor(){super(...arguments),this.layout=null,this.skillPrefab=null,this.ownerType=s.SlotType.Enemy,this.skills=[]}onLoad(){cc.systemEvent.on(n.SkillsController.EventSkillLoaded.eventName,this.onSkillLoaded,this),cc.systemEvent.on(n.SkillsController.EventSkillUnload.eventName,this.onSkillUnload,this),cc.systemEvent.on(n.SkillsController.EventSkillUpdateCooldown.eventName,this.onSkillUpdateCooldown,this)}onDestroy(){cc.systemEvent.off(n.SkillsController.EventSkillLoaded.eventName,this.onSkillLoaded,this),cc.systemEvent.off(n.SkillsController.EventSkillUnload.eventName,this.onSkillUnload,this),cc.systemEvent.off(n.SkillsController.EventSkillUpdateCooldown.eventName,this.onSkillUpdateCooldown,this)}onSkillLoaded(e){if(this.ownerType!=e.owner.owner.slotType)return;let t=cc.instantiate(this.skillPrefab);t.setParent(this.layout.node);let o=t.getComponent(a.HeroSkill);if(o.setIcon(e.iconIndex,e.skillType==i.SkillType.Active),o.skillIndex=e.skillIndex,o.skillOwner=e.owner,this.skills.push({index:e.skillIndex,data:o,owner:e.owner}),this.ownerType==s.SlotType.Enemy){let e=this.node.getComponent(l.EventMover);null!=e&&e.show()}}onSkillUpdateCooldown(e){for(let t of this.skills)e.skillIndex==t.index&&e.owner==t.owner&&t.data.updateCooldown(e.cooldownMax,e.cooldownPercent)}onSkillUnload(e){let t=this,o=function(){for(let o of t.skills)e.owner==o.owner&&o.data.node.destroy()};if(this.ownerType==s.SlotType.Enemy){let e=this.node.getComponent(l.EventMover);null!=e&&(e.hide(o),o=(()=>{}))}o()}};r([p(cc.Layout)],u.prototype,"layout",void 0),r([p(cc.Prefab)],u.prototype,"skillPrefab",void 0),r([p({type:cc.Enum(s.SlotType)})],u.prototype,"ownerType",void 0),u=r([c],u),o.HeroSkillPanel=u,cc._RF.pop()},{CharacterSlot:"CharacterSlot",EventMover:"EventMover",HeroSkill:"HeroSkill",SkillLoader:"SkillLoader",SkillsController:"SkillsController"}],HeroSkillView:[function(e,t,o){"use strict";cc._RF.push(t,"96f547A86FLA5FqQhhp9ZxD","HeroSkillView"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.icon=null,t.iconBG=[],t.selection=null,t.iconAtlas=null,t.loadedData=null,t.desc=null,t}return __extends(t,e),t.prototype.onLoad=function(){for(var e=0,t=this.iconBG;e<t.length;e++){t[e].node.active=!1}this.selection&&(this.selection.node.active=!1)},t.prototype.setIcon=function(e,t){null!=this.icon&&this.iconAtlas&&(this.icon.spriteFrame=this.iconAtlas.getSpriteFrames()[e],t?this.iconBG[1].node.active=!0:this.iconBG[0].node.active=!0)},t.prototype.onClick=function(){this.clickCallback(this)},t.prototype.select=function(e){this.selection.node.active=e},t.prototype.isSelected=function(){return this.selection.node.active},__decorate([a(cc.Sprite)],t.prototype,"icon",void 0),__decorate([a(cc.Sprite)],t.prototype,"iconBG",void 0),__decorate([a(cc.Sprite)],t.prototype,"selection",void 0),__decorate([a(cc.SpriteAtlas)],t.prototype,"iconAtlas",void 0),t=__decorate([n],t)}(cc.Component);o.HeroSkillView=i,cc._RF.pop()},{}],HeroSkill:[function(e,t,o){"use strict";cc._RF.push(t,"46546WJQjVPjo5r60TBNZju","HeroSkill");var r,n=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:a,property:i}=cc._decorator;let s=r=class extends cc.Component{constructor(){super(...arguments),this.icon=null,this.iconBG=[],this.cdBar=null,this.cdAmount=null,this.cdNode=null,this.iconAtlas=null,this.currentCooldown=0,this.skillIndex=0,this.skillOwner=null,this.needReloadEfx=!1}onLoad(){null!=this.cdNode&&(this.cdNode.active=!1);for(let e of this.iconBG)e.node.active=!1}setIcon(e,t){null!=this.icon&&this.iconAtlas&&(this.icon.spriteFrame=this.iconAtlas.getSpriteFrames()[e],t?this.iconBG[1].node.active=!0:this.iconBG[0].node.active=!0)}updateCooldown(e,t){0==this.currentCooldown&&t>0&&(this.cdNode.active=!0,this.needReloadEfx=!0),0==this.currentCooldown&&0==t&&(this.needReloadEfx&&(this.needReloadEfx=!1,cc.systemEvent.emit(r.EventReloadFinished.eventName,new r.EventReloadFinished(this.node))),this.cdNode.active=!1),this.cdBar.progress=t,this.cdAmount.string=Math.round(e*t).toString()}onClick(){null!=this.skillOwner&&this.skillOwner.performSkill(this.skillIndex)}};n([i(cc.Sprite)],s.prototype,"icon",void 0),n([i(cc.Sprite)],s.prototype,"iconBG",void 0),n([i(cc.ProgressBar)],s.prototype,"cdBar",void 0),n([i(cc.Label)],s.prototype,"cdAmount",void 0),n([i(cc.Node)],s.prototype,"cdNode",void 0),n([i(cc.SpriteAtlas)],s.prototype,"iconAtlas",void 0),s=r=n([a],s),o.HeroSkill=s,function(e){class t{constructor(e){this.owner=null,this.owner=e}}t.eventName="EventReloadFinished",e.EventReloadFinished=t}(s=o.HeroSkill||(o.HeroSkill={})),o.HeroSkill=s,o.default=s,cc._RF.pop()},{}],HitEfxController:[function(e,t,o){"use strict";cc._RF.push(t,"62571bTnfZMM7haw3GK7RGW","HitEfxController"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.damage=null,t.distance=100,t.duration=.5,t.hitAnimationEnded=!1,t.damageAnimationEnded=!1,t}return __extends(t,e),t.prototype.init=function(e,t,o){var r=this,n=this.node.parent;this.node.scaleX=n?Math.sign(n.scaleX):this.node.scaleX,this.node.setPosition(t,o),this.damage.string=e.toString(),this.damage.node.runAction(cc.sequence(cc.callFunc(this.hideHitAnimation,this),cc.moveTo(this.duration,cc.v2(0,this.damage.node.y+this.distance)),cc.fadeOut(this.duration),cc.callFunc(function(){r.damageAnimationEnded=!0},this),cc.callFunc(this.destroyIfAnimationEnded,this)))},t.prototype.destroyIfAnimationEnded=function(){this.damageAnimationEnded&&this.hitAnimationEnded&&this.node.destroy()},t.prototype.hideHitAnimation=function(){var e=this,t=this.node.getComponent(cc.Sprite),o=this.node.getComponent(cc.Animation).currentClip;this.scheduleOnce(function(){t.enabled=!1,e.hitAnimationEnded=!0,e.destroyIfAnimationEnded()},o.duration)},__decorate([a(cc.Label)],t.prototype,"damage",void 0),__decorate([a],t.prototype,"distance",void 0),__decorate([a],t.prototype,"duration",void 0),t=__decorate([n],t)}(cc.Component);o.HitEfxController=i,cc._RF.pop()},{}],InputController:[function(e,t,o){"use strict";cc._RF.push(t,"8f531EXKF5PDLsXrJvmXdjq","InputController"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=(r.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pressedKeys=new Set,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},t.prototype.onKeyDown=function(e){this.pressedKeys.has(e.keyCode)||(this.pressedKeys.add(e.keyCode),cc.systemEvent.emit(o.EVENT_KEY_DOWN,e))},t.prototype.onKeyUp=function(e){this.pressedKeys.delete(e.keyCode),cc.systemEvent.emit(o.EVENT_KEY_UP,e)},t.EVENT_KEY_DOWN="InputController.key_down",t.EVENT_KEY_HOLD="InputController.key_hold",t.EVENT_KEY_UP="InputController.key_up",t=o=__decorate([n],t)}(cc.Component));o.InputController=a,cc._RF.pop()},{}],LevelIconController:[function(e,t,o){"use strict";cc._RF.push(t,"3707cGuHFZFULfvvUkiw/xn","LevelIconController"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("GameComponentsLocator"),n=e("GlobalHandler"),a=e("SceneTransition");(function(e){e[e.Common=0]="Common",e[e.MiniBoss=2]="MiniBoss",e[e.Boss=3]="Boss"})(o.IconType||(o.IconType={}));var i=cc._decorator,s=i.ccclass,l=i.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.iconSprite=null,t.iconLocked=null,t.iconPassed=null,t.iconAtlas=null,t.icon=null,t.levelIndex=0,t.gameScene="CoreGame",t.globalHandler=null,t.transitionDataMapper=null,t.dataMapper=null,t.initialized=!1,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){this.iconSprite.spriteFrame=null,this.globalHandler=r.GameComponentsLocator.get(n.GlobalHandler),null!=this.globalHandler?(this.transitionDataMapper=this.globalHandler.data.transitionData,this.dataMapper=this.globalHandler.data):cc.warn("LevelIconController | cant find globalHandler")},t.prototype.onClick=function(){var e=this.dataMapper.getStamina();if(e.current>=1){this.dataMapper.setStamina(e.current-1),this.globalHandler.needSave=!0;var t=this.globalHandler.getComponent(a.SceneTransition);if(null!=t){this.transitionDataMapper.resetLevelAction();var r=cc.director.getScene();this.transitionDataMapper.setScene(r.name),this.transitionDataMapper.resetLoot(),t.gotoScene(this.gameScene)}}else cc.systemEvent.emit(o.EventStaminaIsOver.eventName,new o.EventStaminaIsOver)},__decorate([l(cc.Sprite)],t.prototype,"iconSprite",void 0),__decorate([l(cc.SpriteFrame)],t.prototype,"iconLocked",void 0),__decorate([l(cc.SpriteFrame)],t.prototype,"iconPassed",void 0),__decorate([l(cc.SpriteAtlas)],t.prototype,"iconAtlas",void 0),__decorate([l],t.prototype,"levelIndex",void 0),__decorate([l],t.prototype,"gameScene",void 0),t=o=__decorate([s],t)}(cc.Component);o.LevelIconController=c,function(e){var t=function(){function e(){}return e.eventName="EventStaminaIsOver",e}();e.EventStaminaIsOver=t}(c=o.LevelIconController||(o.LevelIconController={})),o.LevelIconController=c,o.default=c,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",GlobalHandler:"GlobalHandler",SceneTransition:"SceneTransition"}],LevelMapController:[function(e,t,o){"use strict";cc._RF.push(t,"09d5ciGzs1Ig4lnEZRBEt9P","LevelMapController");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("GameComponentsLocator"),a=e("GlobalHandler"),i=e("TransitionDataMapper"),s=e("LevelIconController"),{ccclass:l,property:c}=cc._decorator;let p=class extends cc.Component{constructor(){super(...arguments),this.addStaminaPopupPrefab=null,this.addStaminaPopup=null,this.inventoryPopupPrefab=null,this.inventoryPopup=null,this.globalHandler=null,this.transitionDataMapper=null,this.dataMapper=null}onLoad(){this.globalHandler=n.GameComponentsLocator.get(a.GlobalHandler),this.transitionDataMapper=this.globalHandler.data.transitionData,this.dataMapper=this.globalHandler.data,cc.systemEvent.on(s.LevelIconController.EventStaminaIsOver.eventName,this.onStaminaOver,this)}start(){this.checkAction(),this.dataMapper.staminaUpdateUI()}onStaminaOver(){if(null==this.addStaminaPopup){let e=cc.instantiate(this.addStaminaPopupPrefab);e.setParent(this.node),this.addStaminaPopup=e}else this.addStaminaPopup.active=!0}checkAction(){if(this.transitionDataMapper.getLevelAction()==i.LevelAction.Win){let e=this.dataMapper.getStamina();this.dataMapper.setStamina(e.current+1),this.globalHandler.needSave=!0,this.dataMapper.lootAddFromTransition()}}};r([c(cc.Prefab)],p.prototype,"addStaminaPopupPrefab",void 0),r([c(cc.Prefab)],p.prototype,"inventoryPopupPrefab",void 0),p=r([l],p),o.LevelMapController=p,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",GlobalHandler:"GlobalHandler",LevelIconController:"LevelIconController",TransitionDataMapper:"TransitionDataMapper"}],LevelUpWinController:[function(e,t,o){"use strict";cc._RF.push(t,"8e539CzWrpO77tmw64vy0PX","LevelUpWinController"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("GameComponentsLocator"),n=e("SkillLoader"),a=e("BattleController"),i=e("MathHelper"),s=e("HeroSkillView"),l=e("SkillMapper"),c=e("Health"),p=e("SkillsController"),u=cc._decorator,h=u.ccclass,d=u.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.titleLabel=null,t.descLabel=null,t.nameLabel=null,t.cooldownLabel=null,t.titleText="\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u043e\u0432\u044b\u0448\u0435\u043d",t.descText="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043d\u0430\u0432\u044b\u043a",t.layout=null,t.skillPrefab=null,t.skillChooseCount=3,t.skillLoader=null,t.views=[],t.slot=null,t}return __extends(t,e),t.prototype.onLoad=function(){cc.systemEvent.on(a.BattleController.EventWaveEnded.eventName,this.onLevelUp,this),this.skillLoader=r.GameComponentsLocator.get(n.SkillLoader),this.titleLabel&&(this.titleLabel.string=this.titleText),this.reInit()},t.prototype.onDestroy=function(){cc.systemEvent.off(a.BattleController.EventWaveEnded.eventName,this.onLevelUp,this)},t.prototype.onLevelUp=function(e){if(this.skillLoader){this.node.active=!0,this.slot=e.slot,this.reInit();for(var t=this.slot.character.getComponent(p.SkillsController).getSkillData(),o=Math.random(),r=0;r<this.skillChooseCount;r++){var a=i.getRandomInt(this.skillLoader.skills.length-1);if(0===r&&t.length>0&&o<.3){var c=this.skillLoader.skills.filter(function(e){return void 0!==t.find(function(t){return e.info.name===t.data.info.name})});a=i.getRandomInt(c.length-1)}var u=this.skillLoader.getHeroSkillData(this.skillLoader.skills[a].info.name),h=l.SkillMapper.getHeroSkill(u.info.name),d=cc.instantiate(this.skillPrefab);d.setParent(this.layout.node);var v=d.getComponent(s.HeroSkillView);v.setIcon(h,u.info.type==n.SkillType.Active),v.clickCallback=this.onViewClick.bind(this),v.loadedData=u,v.desc=this.skillLoader.getSkillDescription(u.info.name,n.SkillOwnerType.Hero),this.views.push(v)}}},t.prototype.onViewClick=function(e){this.views.forEach(function(e){e.select(!1)}),e.select(!0),this.nameLabel.string=e.desc.name,this.cooldownLabel.string=e.loadedData.info.type===n.SkillType.Passive?"\u041f\u0430\u0441\u0441\u0438\u0432\u043d\u044b\u0439":"\u0412\u0440\u0435\u043c\u044f \u043f\u0435\u0440\u0435\u0437\u0430\u0440\u044f\u0434\u043a\u0438: "+e.loadedData.info.cooldown.toString()+" \u0445\u043e\u0434\u043e\u0432",this.descLabel.string=this.skillLoader.getSkillDescForLvl(1,e.desc,!1)},t.prototype.onChooseClick=function(){var e=this.views.find(function(e){return e.isSelected()});e?(this.slot.character.getComponent(p.SkillsController).addOrUpgradeSkill({type:e.loadedData.info.name,level:1}),this.close()):cc.warn("[LevelUpWinController][onChooseClick] cant find selected skill view")},t.prototype.onHealClick=function(){this.slot.character.getComponent(c.Health).takePercentDamage(-.4),this.close()},t.prototype.close=function(){cc.systemEvent.emit(a.BattleController.EventReadyToNewWave.eventName,new a.BattleController.EventReadyToNewWave),this.node.active=!1},t.prototype.reInit=function(){this.views=[],this.layout.node.children.forEach(function(e){return e.destroy()}),this.descLabel&&(this.descLabel.string=this.descText),this.nameLabel&&(this.nameLabel.string=""),this.cooldownLabel&&(this.cooldownLabel.string="")},__decorate([d(cc.Label)],t.prototype,"titleLabel",void 0),__decorate([d(cc.Label)],t.prototype,"descLabel",void 0),__decorate([d(cc.Label)],t.prototype,"nameLabel",void 0),__decorate([d(cc.Label)],t.prototype,"cooldownLabel",void 0),__decorate([d],t.prototype,"titleText",void 0),__decorate([d],t.prototype,"descText",void 0),__decorate([d(cc.Layout)],t.prototype,"layout",void 0),__decorate([d(cc.Prefab)],t.prototype,"skillPrefab",void 0),__decorate([d],t.prototype,"skillChooseCount",void 0),t=__decorate([h],t)}(cc.Component);o.default=v,cc._RF.pop()},{BattleController:"BattleController",GameComponentsLocator:"GameComponentsLocator",Health:"Health",HeroSkillView:"HeroSkillView",MathHelper:"MathHelper",SkillLoader:"SkillLoader",SkillMapper:"SkillMapper",SkillsController:"SkillsController"}],Logger:[function(e,t,o){"use strict";var r;cc._RF.push(t,"4f7f9G9+6tGN7raU3MnlU1f","Logger"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.None=5]="None"}(r=o.LogLevels||(o.LogLevels={}));var n=function(){function e(e,t){this.logLevel=r.Error,this.logName="defaultName",this.logLevel=t,this.logName=e}return e.prototype.trace=function(e){this.logLevel<=r.Trace&&this.log("Trace | "+e)},e.prototype.debug=function(e){this.logLevel<=r.Debug&&this.log("Debug | "+e)},e.prototype.info=function(e){this.logLevel<=r.Info&&this.log("Info | "+e)},e.prototype.warning=function(e){this.logLevel<=r.Warning&&this.log("Warning | "+e)},e.prototype.error=function(e){this.logLevel<=r.Error&&this.log("Error | "+e)},e.prototype.log=function(e){cc.log(this.logName+" | "+e)},e}();o.Logger=n,cc._RF.pop()},{}],MathHelper:[function(e,t,o){"use strict";function r(e,t,o){return Math.min(Math.max(e,t),o)}cc._RF.push(t,"4ea17bawK9LDJ0SPbnyPcBv","MathHelper"),Object.defineProperty(o,"__esModule",{value:!0}),o.clamp=r,o.lerp=function(e,t,o){return(1-o)*e+o*t},o.closestArc=function(e,t){return(t-e+540)%360-180},o.clampMagnitude=function(e,t){return console.assert(t>=0,"Invalid max"),r(e,-t,t)},o.lerp2=function(e,t,o,r){return Math.abs(t-e)>r?cc.misc.lerp(e,t,o):t},o.getLerp=function(e,t,o){var n=o,a=n;return function(o){var i=(a=r(a-o,0,n))/n;return i*e+(1-i)*t}},o.uniqueID=function(){return"_"+Math.random().toString(36).substr(2,9)},o.getRandomInt=function(e){return Math.round(Math.random()*e)},o.getBaseLog=function(e,t){return Math.log(e)/Math.log(t)},cc._RF.pop()},{}],MenuBehavior:[function(e,t,o){"use strict";cc._RF.push(t,"9ccd2KVcitPybIThqq/D0og","MenuBehavior"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.closeButton=null,t.titleLabel=null,t.title="\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a",t.saveOnClose=!1,t.pauseOnOpen=!1,t.callbackOnClose=!1,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){if(null!=this.closeButton){var e=new cc.Component.EventHandler;e.target=this.node,e.component="MenuBehavior",e.handler="closeCallback",this.closeButton.clickEvents.push(e)}null!=this.titleLabel&&(this.titleLabel.string=this.title)},t.prototype.closeCallback=function(){this.callbackOnClose&&cc.systemEvent.emit(o.EventCloseWindow.eventName),this.node.active=!1},t.prototype.openCallback=function(){this.node.active=!0},__decorate([a(cc.Button)],t.prototype,"closeButton",void 0),__decorate([a(cc.Label)],t.prototype,"titleLabel",void 0),__decorate([a],t.prototype,"title",void 0),__decorate([a],t.prototype,"saveOnClose",void 0),__decorate([a],t.prototype,"pauseOnOpen",void 0),__decorate([a],t.prototype,"callbackOnClose",void 0),t=o=__decorate([n],t)}(cc.Component);o.MenuBehavior=i,function(e){var t=function(){function e(){}return e.eventName="EventCloseWindow",e}();e.EventCloseWindow=t}(i=o.MenuBehavior||(o.MenuBehavior={})),o.MenuBehavior=i,o.default=i,cc._RF.pop()},{}],MenuCreator:[function(e,t,o){"use strict";cc._RF.push(t,"bde8bibVfFKcILOSe8AeSzi","MenuCreator"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("MenuBehavior"),n=cc._decorator,a=n.ccclass,i=n.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.menuPrefab=null,t.menuParentNode=null,t.menuInst=null,t}return __extends(t,e),t.prototype.openMenuCallback=function(){if(null!=this.menuInst)this.menuInst.openCallback();else if(null!=this.menuPrefab){var e=cc.instantiate(this.menuPrefab);null!=this.menuParentNode?e.parent=this.menuParentNode:e.parent=this.node,this.menuInst=e.getComponent(r.MenuBehavior)}},__decorate([i(cc.Prefab)],t.prototype,"menuPrefab",void 0),__decorate([i(cc.Node)],t.prototype,"menuParentNode",void 0),t=__decorate([a],t)}(cc.Component);o.default=s,cc._RF.pop()},{MenuBehavior:"MenuBehavior"}],OptionsController:[function(e,t,o){"use strict";cc._RF.push(t,"dd4b1BB7i5HLo5eESV5kSru","OptionsController");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("GameComponentsLocator"),a=e("GlobalHandler"),{ccclass:i,property:s}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.soundToggle=null,this.musicToggle=null,this.globalHandler=null,this.dataMapper=null}onLoad(){this.globalHandler=n.GameComponentsLocator.get(a.GlobalHandler),this.dataMapper=this.globalHandler.data}onEnable(){let e=this.dataMapper.getOptionsData();e.sound?this.soundToggle.check():this.soundToggle.uncheck(),e.music?this.musicToggle.check():this.musicToggle.uncheck()}onSoundCheck(){let e=this.dataMapper.getOptionsData();this.soundToggle.isChecked?e.sound=!0:e.sound=!1,this.dataMapper.setOptionsData(e)}onMusicCheck(){let e=this.dataMapper.getOptionsData();this.musicToggle.isChecked?e.music=!0:e.music=!1,this.dataMapper.setOptionsData(e)}};r([s(cc.Toggle)],l.prototype,"soundToggle",void 0),r([s(cc.Toggle)],l.prototype,"musicToggle",void 0),l=r([i],l),o.OptionsController=l,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",GlobalHandler:"GlobalHandler"}],ParallaxBackground:[function(e,t,o){"use strict";cc._RF.push(t,"28214CWggNPUbJsgCa3jXoV","ParallaxBackground"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("ScrollSpriteFrame"),n=cc._decorator,a=n.ccclass,i=n.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layers=[],t.layersSpeed=[],t.testMove=!1,t.testMoveSpeed=1,t.targetSpeed=0,t.targetDuration=0,t.isMoving=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.layers.length!=this.layersSpeed.length&&(cc.error("wrong arrays setup"),this.node.destroy())},t.prototype.update=function(e){this.testMove?this.moveForeground(this.testMoveSpeed*e):this.isMoving?this.moveForeground(this.targetSpeed*e):this.targetDuration>0&&(this.targetDuration-=e,this.moveForeground(this.targetSpeed*e))},t.prototype.moveForeground=function(e){for(var t in this.layers){var o=this.layers[t];null!=o&&o.scrollSprite(this.layersSpeed[t]*e)}},t.prototype.setTarget=function(e,t){this.targetSpeed=e,this.targetDuration=t},t.prototype.startMove=function(e){this.targetSpeed=e,this.isMoving=!0},t.prototype.stopMove=function(){this.isMoving=!1},__decorate([i(r.ScrollSpriteFrame)],t.prototype,"layers",void 0),__decorate([i([cc.Float])],t.prototype,"layersSpeed",void 0),__decorate([i],t.prototype,"testMove",void 0),__decorate([i],t.prototype,"testMoveSpeed",void 0),t=__decorate([a],t)}(cc.Component);o.ParallaxBackground=s,cc._RF.pop()},{ScrollSpriteFrame:"ScrollSpriteFrame"}],PartActivator:[function(e,t,o){"use strict";cc._RF.push(t,"9e73az4b7xO05vNmnMaJmfo","PartActivator"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("PartInterfaces");(function(e){e[e.EventPerform=0]="EventPerform",e[e.Scope=1]="Scope",e[e.GlobalScope=2]="GlobalScope"})(r=o.ActivatorType||(o.ActivatorType={})),function(e){e[e.Amount=0]="Amount",e[e.State=1]="State"}(n=o.ActivatorConditionType||(o.ActivatorConditionType={}));var i=cc._decorator,s=i.ccclass,l=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.parse=function(e,t){return{activatorType:this.parseType(t.activatorType),activatorTarget:t.activatorType,target:this.parseRef(t.target),targetAmount:t.targetAmount,targetName:t.targetName,targetState:t.targetState,activate:this.parseRef(t.activate),context:{eventPerform:!1},state:!1}},t.prototype.exec=function(e,t){return a.makeDefaultSkillExecuteResult(e)},t.prototype.parseType=function(e){return r.EventPerform},t.prototype.parseRef=function(e){var t=e.indexOf("_");if(t>0){var o=e.substring(t+1,e.length);t=parseInt(o)}return cc.warn("PartActivator | getIndex = "+t.toString()),t},t.prototype.isString=function(e){return"string"==typeof e},t.prototype.getConditionType=function(e,t){var o=null;switch(e){case r.Scope:if(void 0!=t.targetAmount){o=n.Amount;break}if(void 0!=t.targetState){o=n.State;break}break;default:cc.warn("PartActivator | unknown activator type - "+e.toString())}return o},t.prototype.getCondition=function(e,t){var o=null;switch(e){case n.Amount:case n.Amount:o=t.targetAmount;break;default:cc.warn("PartActivator | unknown activator condition type - "+e.toString())}return o},t.prototype.checkCondition=function(e,t,o){var n=!1;switch(e){case r.Scope:case r.GlobalScope:n=t===o&&null!=t;break;case r.EventPerform:n=!0}return n},t=__decorate([s],t)}(cc.Component));o.PartActivator=l,cc._RF.pop()},{PartInterfaces:"PartInterfaces"}],PartCounter:[function(e,t,o){"use strict";cc._RF.push(t,"67457je/QtN8JtF8CQnh1Af","PartCounter"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("GameComponentsLocator"),i=e("PartInterfaces"),s=e("PartInterfaces"),l=e("PartInterfaces"),c=e("SkillEvent");(function(e){e[e.Up=0]="Up",e[e.Down=1]="Down"})(r=o.CountType||(o.CountType={})),function(e){e[e.Refresh=0]="Refresh",e[e.CountUp=1]="CountUp",e[e.CountDown=2]="CountDown"}(n=o.CounterEventType||(o.CounterEventType={}));var p=cc._decorator,u=p.ccclass,h=(p.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.parse=function(e,t){var o=a.GameComponentsLocator.get(c.SkillEvent);return{countType:this.parseType(t.countType),amount:l.tryParseStatParam(e,t.amount),defaultAmount:l.tryParseStatParam(e,t.amount),amountPerLvl:l.tryParseStatParam(e,t.amountPerLvl),perLvlfrequency:l.tryParseStatParam(e,t.perLvlfrequency),autoReload:t.autoReload,events:o.parseEvents(t.events,this.parseEventType),state:!1}},t.prototype.updatePart=function(e,t){return t.amount=s.tryUpdateStat(e,t.amount,t.amountPerLvl,t.perLvlfrequency),t},t.prototype.getEvents=function(e){for(var t=[],o=0,r=e.events;o<r.length;o++){var n=r[o];t.push(n.systemEventName)}return t},t.prototype.hasEvent=function(e,t){for(var o=!1,r=0,n=t.events;r<n.length;r++){if(n[r].systemEventName===e){o=!0;break}}return o},t.prototype.performEvent=function(e,t,o){for(var r=0,a=t.events;r<a.length;r++){var i=a[r];if(i.systemEventName===e.systemEventName){switch(i.callback){case n.CountUp:t=this.countUp(e.eventData,t);break;case n.CountDown:t=this.countDown(e.eventData,t);break;case n.Refresh:t=this.refresh(e.eventData,t)}break}}return t},t.prototype.exec=function(e,t){return i.makeDefaultSkillExecuteResult(this.refresh(null,e))},t.prototype.parseType=function(e){var t=null;switch(e){case"up":t=r.Up;break;case"down":t=r.Down}return t},t.prototype.parseEventType=function(e){var t=null;switch(e){case"refresh":t=n.Refresh;break;case"countUp":t=n.CountUp;break;case"countDown":t=n.CountDown}return t},t.prototype.countUp=function(e,t){return t.amount=cc.misc.clampf(t.amount+1,0,t.defaultAmount),t.state=this.checkCounterState(t),t.autoReload&&t.state?this.reload(t):t},t.prototype.countDown=function(e,t){return t.amount=cc.misc.clampf(t.amount-1,0,t.defaultAmount),t.state=this.checkCounterState(t),t.autoReload&&t.state?this.reload(t):t},t.prototype.refresh=function(e,t){return(t=this.reload(t)).state=!1,t},t.prototype.reload=function(e){switch(e.countType){case r.Up:e.amount=0;break;case r.Down:e.amount=e.defaultAmount}return e},t.prototype.checkCounterState=function(e){var t=!1;switch(e.countType){case r.Up:t=e.amount==e.defaultAmount;break;case r.Down:t=0==e.amount}return t},t=__decorate([u],t)}(cc.Component));o.PartCounter=h,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",PartInterfaces:"PartInterfaces",SkillEvent:"SkillEvent"}],PartDamage:[function(e,t,o){"use strict";cc._RF.push(t,"3cad5YQd49MdYKPzjXHkH3d","PartDamage"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("GameComponentsLocator"),a=e("PartInterfaces"),i=e("PartInterfaces"),s=e("PartInterfaces"),l=e("SkillLoader"),c=e("BattleController"),p=e("Health"),u=e("Damage");(function(e){e[e.None=0]="None",e[e.TileBase=1]="TileBase",e[e.DamageBase=2]="DamageBase"})(r=o.DamageBase||(o.DamageBase={}));var h=cc._decorator,d=h.ccclass,v=(h.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.parse=function(e,t){return{target:l.SkillLoader.parseTarget(t.target),damageBase:this.parseDamageBase(t.damageBase),amount:s.tryParseStatParam(e,t.amount),amountPerLvl:s.tryParseStatParam(e,t.amountPerLvl),percent:s.tryParseStatParam(e,t.percent),percentPerLvl:s.tryParseStatParam(e,t.percentPerLvl),bossPercent:s.tryParseStatParam(e,t.bossPercent),bossPercentPerLvl:s.tryParseStatParam(e,t.bossPercentPerLvl),perLvlfrequency:s.tryParseStatParam(e,t.perLvlfrequency),state:!1}},t.prototype.updatePart=function(e,t){return t.amount=i.tryUpdateStat(e,t.amount,t.amountPerLvl,t.perLvlfrequency),t.percent=i.tryUpdateStat(e,t.percent,t.percentPerLvl,t.perLvlfrequency),t.bossPercent=i.tryUpdateStat(e,t.bossPercent,t.bossPercentPerLvl,t.perLvlfrequency),t},t.prototype.exec=function(e,t){var o=n.GameComponentsLocator.get(c.BattleController);return e.target==l.SkillTarget.Other?o.dealDamageFrom(this.calcDamage(e,o,t),t):o.dealDamageSelf(this.calcDamage(e,o,t),t),a.makeDefaultSkillExecuteResult(e)},t.prototype.calcDamage=function(e,t,o){var n=0;switch(e.damageBase){case r.None:n=+e.amount+ +this.calcPercentDamage(e,t,o);break;case r.TileBase:n=2*e.amount;break;case r.DamageBase:n=+e.amount+ +this.calcPercentDamage(e,t,o)}return n},t.prototype.calcPercentDamage=function(e,t,o){var n=0;switch(e.damageBase){case r.None:var a=[];if(e.target==l.SkillTarget.Other)for(var i=0,s=t.getEnemies(t.findSlot(o).slotType);i<s.length;i++){var c;null!=(c=s[i].character.getComponent(p.Health))&&a.push(c.maxHealth)}else null!=(c=o.getComponent(p.Health))&&a.push(c.maxHealth);for(var h=0,d=0;d<a.length;d++)0==d&&(h=a[d]),a[d]>h&&(h=a[d]);n=h*e.percent/100;break;case r.DamageBase:var v=o.getComponent(u.Damage);null!=v&&(n=v.damage*e.percent/100)}return n},t.prototype.parseDamageBase=function(e){var t=null;switch(e){case"none":t=r.None;break;case"tileBase":t=r.TileBase;break;case"damageBase":t=r.DamageBase}return t},t=__decorate([d],t)}(cc.Component));o.PartDamage=v,cc._RF.pop()},{BattleController:"BattleController",Damage:"Damage",GameComponentsLocator:"GameComponentsLocator",Health:"Health",PartInterfaces:"PartInterfaces",SkillLoader:"SkillLoader"}],PartHealer:[function(e,t,o){"use strict";cc._RF.push(t,"9cd32XEq1FLZrZOtgQWCQ8e","PartHealer"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("GameComponentsLocator"),i=e("PartInterfaces"),s=e("PartInterfaces"),l=e("PartInterfaces"),c=e("Health"),p=e("SkillEvent");(function(e){e[e.Simple=0]="Simple"})(r=o.HealerType||(o.HealerType={})),function(e){e[e.Heal=0]="Heal",e[e.Lifelink=1]="Lifelink"}(n=o.HealerEventType||(o.HealerEventType={}));var u=cc._decorator,h=u.ccclass,d=(u.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.parse=function(e,t){var o=a.GameComponentsLocator.get(p.SkillEvent);return{healerType:this.parseType(t.healerType),amount:s.tryParseStatParam(e,t.amount),amountPerLvl:s.tryParseStatParam(e,t.amountPerLvl),percent:s.tryParseStatParam(e,t.percent),percentPerLvl:s.tryParseStatParam(e,t.percentPerLvl),perLvlfrequency:s.tryParseStatParam(e,t.perLvlfrequency),events:o.parseEvents(t.events,this.parseEventType),state:!1}},t.prototype.updatePart=function(e,t){return t.amount=i.tryUpdateStat(e,t.amount,t.amountPerLvl,t.perLvlfrequency),t.percent=i.tryUpdateStat(e,t.percent,t.percentPerLvl,t.perLvlfrequency),t},t.prototype.getEvents=function(e){for(var t=[],o=0,r=e.events;o<r.length;o++){var n=r[o];t.push(n.systemEventName)}return t},t.prototype.hasEvent=function(e,t){for(var o=!1,r=0,n=t.events;r<n.length;r++){if(n[r].systemEventName===e){o=!0;break}}return o},t.prototype.performEvent=function(e,t,o){for(var r=0,a=t.events;r<a.length;r++){var i=a[r];if(i.systemEventName===e.systemEventName){switch(i.callback){case n.Heal:t=this.heal(e.eventData,t,o);break;case n.Lifelink:e.eventData.owner==o&&(void 0!=e.eventData.eventArgs?this.heal_(e.eventData.eventArgs*t.percent/100,o):cc.warn("PartHealer | wrong args in lifelink event callback"))}break}}return t},t.prototype.exec=function(e,t){return this.heal(null,e,t),l.makeDefaultSkillExecuteResult(e)},t.prototype.parseType=function(e){var t=null;switch(e){case"simple":t=r.Simple}return t},t.prototype.parseEventType=function(e){var t=null;switch(e){case"heal":t=n.Heal;break;case"lifelink":t=n.Lifelink}return t},t.prototype.heal=function(e,t,o){var r=o.getComponent(c.Health);if(null!=r){var n=r.maxHealth;this.heal_(+t.amount+ +t.percent*n/100,o)}else cc.warn("cant find health in node - "+o.uuid.toString());return t},t.prototype.heal_=function(e,t){var o=t.getComponent(c.Health);if(null!=o){o.maxHealth;o.takeDamage(-1*e)}else cc.warn("cant find health in node - "+t.uuid.toString())},t=__decorate([h],t)}(cc.Component));o.PartHealer=d,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",Health:"Health",PartInterfaces:"PartInterfaces",SkillEvent:"SkillEvent"}],PartInterfaces:[function(e,t,o){"use strict";cc._RF.push(t,"771200EF9BPbqk3TY9Cs0P5","PartInterfaces"),Object.defineProperty(o,"__esModule",{value:!0}),o.IsISkillUpdatable=function(e){return null!=e&&void 0!==e.updatePart},o.tryUpdateStat=function(e,t,o,r){if(e>1)for(var n=e-1,a=0,i=0;i<n;i++)++a>=r&&(a=0,t=+t+ +o);return t},o.IsISkillParsable=function(e){return null!=e&&void 0!==e.parse},o.tryParseStatParam=function(e,t){return void 0!=t.value?t.value*e:t},function(e){e[e.None=0]="None",e[e.Input=1]="Input",e[e.RowOrColumn=2]="RowOrColumn",e[e.InputTwo=3]="InputTwo"}(o.SkillExecuteType||(o.SkillExecuteType={})),o.makeDefaultSkillExecuteResult=function(e){return{data:e}},o.makeSkillExecuteResult=function(e,t,o,r){return{data:e,canExec:t,callback:o,callbackType:r}},o.IsISkillExecutable=function(e){return null!=e&&void 0!==e.exec},o.IsISkillActivable=function(e){return null!=e&&void 0!==e.getCondition},o.IsISkillEventHolder=function(e){return null!=e&&void 0!==e.getEvents&&void 0!==e.hasEvent&&void 0!==e.performEvent},o.IsISkillStatHolder=function(e){return null!=e&&void 0!==e.updateStat},cc._RF.pop()},{}],PartRandomizer:[function(e,t,o){"use strict";cc._RF.push(t,"8ef7eCN6pxD96V6LtwkQhVi","PartRandomizer"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("GameComponentsLocator"),a=e("PartInterfaces"),i=e("SkillLoader"),s=e("SkillEvent");(function(e){e[e.CheckEvent=0]="CheckEvent"})(r=o.RandomizerEventType||(o.RandomizerEventType={}));var l=cc._decorator,c=l.ccclass,p=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.parse=function(e,t){var o=n.GameComponentsLocator.get(s.SkillEvent);return{target:i.SkillLoader.parseTarget(t.target),chance:a.tryParseStatParam(e,t.chance),events:o.parseEvents(t.events,this.parseEventType),state:!1}},t.prototype.updatePart=function(e,t){return t},t.prototype.getEvents=function(e){for(var t=[],o=0,r=e.events;o<r.length;o++){var n=r[o];t.push(n.systemEventName)}return t},t.prototype.hasEvent=function(e,t){for(var o=!1,r=0,n=t.events;r<n.length;r++){if(n[r].systemEventName===e){o=!0;break}}return o},t.prototype.performEvent=function(e,t,o){for(var n=0,a=t.events;n<a.length;n++){var i=a[n];if(i.systemEventName===e.systemEventName&&this.checkOwner(e,t,o)){switch(i.callback){case r.CheckEvent:t=this.checkEvent(e.eventData,t)}break}}return t},t.prototype.checkOwner=function(e,t,o){return(t.target==i.SkillTarget.Other?e.eventData.owner!=o:e.eventData.owner==o)||t.target==i.SkillTarget.All},t.prototype.parseEventType=function(e){var t=null;switch(e){case"checkEvent":t=r.CheckEvent}return t},t.prototype.checkEvent=function(e,t){return t.state=Math.random()<t.chance,cc.log("random result - "+t.state+" -- chance - "+t.chance),t},t=__decorate([c],t)}(cc.Component));o.PartRandomizer=p,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",PartInterfaces:"PartInterfaces",SkillEvent:"SkillEvent",SkillLoader:"SkillLoader"}],PartSetGlobal:[function(e,t,o){"use strict";cc._RF.push(t,"6d2cdCFqOlMU5PDLURiSUER","PartSetGlobal"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("PartInterfaces"),i=e("PartInterfaces"),s=e("PartInterfaces"),l=e("CoreGameplay"),c=e("GameComponentsLocator");(function(e){e[e.Mult=0]="Mult",e[e.Add=1]="Add"})(r=o.SetGlobalType||(o.SetGlobalType={})),function(e){e[e.SpawnCount=0]="SpawnCount"}(n=o.GlobalParamType||(o.GlobalParamType={}));var p=cc._decorator,u=p.ccclass,h=(p.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.parse=function(e,t){return{changeType:this.parseSetGlobalType(t.changeType),globalType:this.parseGlobalType(t.name),amount:s.tryParseStatParam(e,t.amount),amountPerLvl:s.tryParseStatParam(e,t.amountPerLvl),perLvlfrequency:s.tryParseStatParam(e,t.perLvlfrequency),state:!1}},t.prototype.updatePart=function(e,t){return t.amount=i.tryUpdateStat(e,t.amount,t.amountPerLvl,t.perLvlfrequency),t},t.prototype.updateStat=function(e,t){switch(e.globalType){case n.SpawnCount:var o=c.GameComponentsLocator.get(l.CoreGameplay);if(null!=o){switch(e.changeType){case r.Mult:o.tileSpawnCount*=e.amount;break;case r.Add:o.tileSpawnCount=+o.tileSpawnCount+ +e.amount}cc.log("PartSetGlobal | amount - "+e.amount+" : "+o.tileSpawnCount)}}return e},t.prototype.resetStat=function(e,t){switch(e.globalType){case n.SpawnCount:var o=c.GameComponentsLocator.get(l.CoreGameplay);null!=o&&o.resetTileSpawnCount()}return e},t.prototype.exec=function(e,t){return this.updateStat(e,t),a.makeDefaultSkillExecuteResult(e)},t.prototype.parseSetGlobalType=function(e){var t=null;switch(e){case"mult":t=r.Mult;break;case"add":t=r.Add}return t},t.prototype.parseGlobalType=function(e){var t=null;switch(e){case"spawnCount":t=n.SpawnCount}return t},t=__decorate([u],t)}(cc.Component));o.PartSetGlobal=h,cc._RF.pop()},{CoreGameplay:"CoreGameplay",GameComponentsLocator:"GameComponentsLocator",PartInterfaces:"PartInterfaces"}],PartStatChanger:[function(e,t,o){"use strict";cc._RF.push(t,"e34810e1HdHyoCLfqZCSk01","PartStatChanger");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("PartInterfaces"),a=e("PartInterfaces"),i=e("PartInterfaces"),s=e("CharacterData"),l=e("CharacterData");var c;(function(e){e[e.Mult=0]="Mult",e[e.Add=1]="Add",e[e.Defence=2]="Defence"})(c=o.StatChangerType||(o.StatChangerType={}));const{ccclass:p,property:u}=cc._decorator;let h=class extends cc.Component{parse(e,t){return{changeType:this.parseStatChangerType(t.changeType),statType:this.parseStatType(t.statType),amount:i.tryParseStatParam(e,t.amount),amountPerLvl:i.tryParseStatParam(e,t.amountPerLvl),perLvlfrequency:i.tryParseStatParam(e,t.perLvlfrequency),state:!1}}updatePart(e,t){return t.amount=a.tryUpdateStat(e,t.amount,t.amountPerLvl,t.perLvlfrequency),t}updateStat(e,t){let o=t.getComponent(l.CharacterData);if(null!=o){let t=o.getParams(),r=[];for(let o of t)r.push(this.updateStat_(o,e));o.setParams(r),o.updateStats()}else cc.warn(`cant find char data in node - ${t.uuid.toString()}`);return e}updateStat_(e,t){let o=e;if(o.type===t.statType)switch(t.changeType){case c.Mult:o.value*=t.amount;break;case c.Add:o.value=+o.value+ +t.amount;break;case c.Defence:0==o.value?o.value=t.amount:o.value*=+t.amount+1}return o}resetStat(e,t){let o=t.getComponent(l.CharacterData);return null!=o?o.resetStats():cc.warn(`cant find char data in node - ${t.uuid.toString()}`),e}exec(e,t){return this.updateStat(e,t),n.makeDefaultSkillExecuteResult(e)}parseStatChangerType(e){let t=null;switch(e){case"mult":t=c.Mult;break;case"add":t=c.Add;break;case"defence":t=c.Defence}return t}parseStatType(e){let t=null;switch(e){case"damage":t=s.CharacterParamType.Damage;break;case"health":t=s.CharacterParamType.Health;break;case"baseTile":t=s.CharacterParamType.BaseTile;break;case"hitDamage":t=s.CharacterParamType.HitDamage;break;case"skillDamage":t=s.CharacterParamType.SkillDamage;break;case"goldFind":t=s.CharacterParamType.GoldFind;break;case"mineFind":t=s.CharacterParamType.MineFind;break;case"damageDemons":t=s.CharacterParamType.DamageDemons;break;case"woodFind":t=s.CharacterParamType.WoodFind;break;case"hitDefence":t=s.CharacterParamType.HitDefence;break;case"skillDefence":t=s.CharacterParamType.SkillDefence;break;case"dodged":t=s.CharacterParamType.Dodged;break;case"blocked":t=s.CharacterParamType.Blocked;break;case"returnDamage":t=s.CharacterParamType.ReturnDamage}return t}};h=r([p],h),o.PartStatChanger=h,cc._RF.pop()},{CharacterData:"CharacterData",PartInterfaces:"PartInterfaces"}],PartTileCreator:[function(e,t,o){"use strict";cc._RF.push(t,"dd0cb4fFXpPybi9fRMvMJzd","PartTileCreator"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("GameComponentsLocator"),i=e("PartInterfaces"),s=e("PartInterfaces"),l=e("PartInterfaces"),c=e("SkillChooser"),p=e("CoreTileCreator");(function(e){e[e.Base=0]="Base",e[e.Chameleon=1]="Chameleon",e[e.Order=2]="Order"})(r=o.TileCreatorType||(o.TileCreatorType={})),function(e){e[e.Random=10]="Random",e[e.All=11]="All"}(n=o.TileCreatorChooseType||(o.TileCreatorChooseType={}));var u=cc._decorator,h=u.ccclass,d=(u.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skillChooser=null,t.tileCreator=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.skillChooser=a.GameComponentsLocator.get(c.SkillChooser),this.tileCreator=a.GameComponentsLocator.get(p.CoreTileCreator)},t.prototype.parse=function(e,t){return{choose:this.skillChooser.parseChooser(t.choose,this.parseChoose),createType:this.parseType(t.createType),amount:l.tryParseStatParam(e,t.amount),amountPerLvl:l.tryParseStatParam(e,t.amountPerLvl),perLvlfrequency:l.tryParseStatParam(e,t.perLvlfrequency),state:!1}},t.prototype.updatePart=function(e,t){return t.amount=s.tryUpdateStat(e,t.amount,t.amountPerLvl,t.perLvlfrequency),t},t.prototype.exec=function(e,t){var o=null;if(this.skillChooser.myChoice(e.choose))cc.log("PartTileCreator | Hit my choose - data.choose - "+e.choose);else switch(e.choose){case n.Random:switch(e.createType){case r.Base:this.tileCreator.addPrettyTile(e.amount,1);break;case r.Chameleon:this.tileCreator.addChameleonTile();break;case r.Order:var a=this.tileCreator.trytoAddOrderTile();o=i.makeSkillExecuteResult(e,a,void 0,void 0)}null==o&&(o=i.makeDefaultSkillExecuteResult(e))}return o},t.prototype.parseType=function(e){var t=null;switch(e){case"base":t=r.Base;break;case"chameleon":t=r.Chameleon;break;case"order":t=r.Order}return t},t.prototype.parseChoose=function(e){var t=null;switch(e){case"random":t=n.Random;break;case"all":t=n.All}return t},t=__decorate([h],t)}(cc.Component));o.PartTileCreator=d,cc._RF.pop()},{CoreTileCreator:"CoreTileCreator",GameComponentsLocator:"GameComponentsLocator",PartInterfaces:"PartInterfaces",SkillChooser:"SkillChooser"}],PartTileDestroyer:[function(e,t,o){"use strict";cc._RF.push(t,"909670KgHtDCLFilb4G/gwO","PartTileDestroyer"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("GameComponentsLocator"),i=e("PartInterfaces"),s=e("PartInterfaces"),l=e("PartInterfaces"),c=e("PartInterfaces"),p=e("SkillChooser"),u=e("CoreTileDestroyer"),h=e("BattleController");(function(e){e[e.WithoutDamage=0]="WithoutDamage",e[e.MultDamage=1]="MultDamage"})(r=o.TileDestroyerOption||(o.TileDestroyerOption={})),function(e){e[e.Random=10]="Random",e[e.RowOrColumn=11]="RowOrColumn",e[e.Center=12]="Center",e[e.All=13]="All"}(n=o.TileDestroyerChooseType||(o.TileDestroyerChooseType={}));var d=cc._decorator,v=d.ccclass,f=(d.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skillChooser=null,t.tileDestroyer=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.skillChooser=a.GameComponentsLocator.get(p.SkillChooser),this.tileDestroyer=a.GameComponentsLocator.get(u.CoreTileDestroyer)},t.prototype.parse=function(e,t){return{choose:this.skillChooser.parseChooser(t.choose,this.parseChoose),options:this.parseOptions(t.options),damageMult:c.tryParseStatParam(e,t.damageMult),amount:c.tryParseStatParam(e,t.amount),amountPerLvl:c.tryParseStatParam(e,t.amountPerLvl),perLvlfrequency:c.tryParseStatParam(e,t.perLvlfrequency),state:!1}},t.prototype.updatePart=function(e,t){return t.amount=l.tryUpdateStat(e,t.amount,t.amountPerLvl,t.perLvlfrequency),t},t.prototype.exec=function(e,t){var o=null;if(this.skillChooser.myChoice(e.choose))cc.log("PartTileDestroyer | Hit my choose - data.choose - "+e.choose);else switch(e.choose){case n.Random:this.chooseRandom(e.amount,e,t),o=s.makeDefaultSkillExecuteResult(e);break;case n.Center:this.chooseCenter(e,t),o=s.makeDefaultSkillExecuteResult(e);break;case n.RowOrColumn:var r=this;o=s.makeSkillExecuteResult(e,!0,{callback:function(o){for(var n=0,a=0,i=o;a<i.length;a++){var s=i[a];n+=r.tileDestroyer.destroyTile(s)}return r.dealDamage(n,e,t),!0}},i.SkillExecuteType.RowOrColumn)}return o},t.prototype.chooseRandom=function(e,t,o){for(var r=0,n=0;n<e;n++)r+=this.tileDestroyer.destroyRandom();this.dealDamage(r,t,o)},t.prototype.chooseCenter=function(e,t){var o=0;o+=this.tileDestroyer.destroyCenter(),this.dealDamage(o,e,t)},t.prototype.dealDamage=function(e,t,o){(this.checkOption(r.WithoutDamage,t.options)&&(cc.log("destroy without damage - "+e),e=0),e>0)&&(e*=t.damageMult,a.GameComponentsLocator.get(h.BattleController).dealDamageFrom(e,o),cc.log("deal damage from skill - "+e))},t.prototype.checkOption=function(e,t){for(var o=!1,r=0,n=t;r<n.length;r++){n[r]==e&&(o=!0)}return o},t.prototype.parseOptions=function(e){for(var t=[],o=0,r=e;o<r.length;o++){var n=r[o],a=this.parseOption(n);null!=a&&t.push(a)}return t},t.prototype.parseOption=function(e){var t=null;switch(e){case"withoutDamage":t=r.WithoutDamage;break;case"multDamage":t=r.MultDamage}return t},t.prototype.parseChoose=function(e){var t=null;switch(e){case"random":t=n.Random;break;case"rowOrColumn":t=n.RowOrColumn;break;case"center":t=n.Center;break;case"all":t=n.All}return t},t=__decorate([v],t)}(cc.Component));o.PartTileDestroyer=f,cc._RF.pop()},{BattleController:"BattleController",CoreTileDestroyer:"CoreTileDestroyer",GameComponentsLocator:"GameComponentsLocator",PartInterfaces:"PartInterfaces",SkillChooser:"SkillChooser"}],PartTileMover:[function(e,t,o){"use strict";cc._RF.push(t,"203edsPfzVGQr4tEzpZ7KAc","PartTileMover"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("GameComponentsLocator"),i=e("PartInterfaces"),s=e("PartInterfaces"),l=e("SkillChooser"),c=e("CoreTileMover");(function(e){e[e.Swap=0]="Swap",e[e.Remix=1]="Remix",e[e.SmartRemix=2]="SmartRemix"})(r=o.TileMoverType||(o.TileMoverType={})),function(e){e[e.All=10]="All"}(n=o.TileMoverChooseType||(o.TileMoverChooseType={}));var p=cc._decorator,u=p.ccclass,h=(p.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skillChooser=null,t.TileMover=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.skillChooser=a.GameComponentsLocator.get(l.SkillChooser),this.TileMover=a.GameComponentsLocator.get(c.CoreTileMover)},t.prototype.parse=function(e,t){return{choose:this.skillChooser.parseChooser(t.choose,this.parseChoose),moveType:this.parseType(t.moveType),state:!1}},t.prototype.updatePart=function(e,t){return t},t.prototype.exec=function(e,t){var o=null;if(this.skillChooser.myChoice(e.choose))switch(e.moveType){case r.Swap:var a=this,l={callback:function(e){var t=2==e.length;return t&&a.TileMover.swapTiles(e[0],e[1]),t}};o=s.makeSkillExecuteResult(e,!0,l,i.SkillExecuteType.InputTwo)}else switch(e.choose){case n.All:switch(e.moveType){case r.Remix:this.TileMover.remixAll();break;case r.SmartRemix:this.TileMover.smartRemixAll()}o=s.makeDefaultSkillExecuteResult(e)}return o},t.prototype.parseType=function(e){var t=null;switch(e){case"swap":t=r.Swap;break;case"remix":t=r.Remix;break;case"smartRemix":t=r.SmartRemix}return t},t.prototype.parseChoose=function(e){var t=null;switch(e){case"all":t=n.All}return t},t=__decorate([u],t)}(cc.Component));o.PartTileMover=h,cc._RF.pop()},{CoreTileMover:"CoreTileMover",GameComponentsLocator:"GameComponentsLocator",PartInterfaces:"PartInterfaces",SkillChooser:"SkillChooser"}],PartTileUpdater:[function(e,t,o){"use strict";cc._RF.push(t,"5df70MMiGhOw4O/ADW6eN3s","PartTileUpdater"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a=e("GameComponentsLocator"),i=e("PartInterfaces"),s=e("PartInterfaces"),l=e("PartInterfaces"),c=e("PartInterfaces"),p=e("SkillChooser"),u=e("CoreTileUpdater");(function(e){e[e.Value=0]="Value",e[e.Copy=1]="Copy",e[e.Mutation=2]="Mutation"})(r=o.TileUpdateType||(o.TileUpdateType={})),function(e){e[e.Random=10]="Random",e[e.All=11]="All"}(n=o.TileUpdaterChooseType||(o.TileUpdaterChooseType={}));var h=cc._decorator,d=h.ccclass,v=(h.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skillChooser=null,t.tileUpdater=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.skillChooser=a.GameComponentsLocator.get(p.SkillChooser),this.tileUpdater=a.GameComponentsLocator.get(u.CoreTileUpdater)},t.prototype.parse=function(e,t){return{choose:this.skillChooser.parseChooser(t.choose,this.parseChoose),updateType:this.parseType(t.updateType),amount:c.tryParseStatParam(e,t.amount),amountPerLvl:c.tryParseStatParam(e,t.amountPerLvl),perLvlfrequency:c.tryParseStatParam(e,t.perLvlfrequency),state:!1}},t.prototype.updatePart=function(e,t){return t.amount=l.tryUpdateStat(e,t.amount,t.amountPerLvl,t.perLvlfrequency),t},t.prototype.exec=function(e,t){var o=null;if(this.skillChooser.myChoice(e.choose)){cc.log("PartTileUpdater | Hit my choose - data.choose - "+e.choose);var a=this,l=null;switch(e.updateType){case r.Value:l={callback:function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];a.tileUpdater.updateTileRelative(e.amount,n)}return!0}},o=s.makeSkillExecuteResult(e,!0,l,i.SkillExecuteType.Input);break;case r.Copy:l={callback:function(e){return 2==e.length&&a.tileUpdater.updateTile(e[1].value,e[0]),!0}},o=s.makeSkillExecuteResult(e,!0,l,i.SkillExecuteType.InputTwo);break;case r.Mutation:l={callback:function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],i=Math.random(),s=0;s=i>.5?-1:o<.25?1:2,cc.log("PartTileUpdater | Mutation - rnd - "+i+", amount - "+s),a.tileUpdater.updateTileRelative(s,n)}return!0}},o=s.makeSkillExecuteResult(e,!0,l,i.SkillExecuteType.Input)}}else switch(e.choose){case n.Random:this.tileUpdater.updateRandom(e.amount),o=s.makeDefaultSkillExecuteResult(e);break;case n.All:this.tileUpdater.updateAll(e.amount),o=s.makeDefaultSkillExecuteResult(e)}return o},t.prototype.parseType=function(e){var t=null;switch(e){case"value":t=r.Value;break;case"copy":t=r.Copy;break;case"mutation":t=r.Mutation}return t},t.prototype.parseChoose=function(e){var t=null;switch(e){case"random":t=n.Random;break;case"all":t=n.All}return t},t=__decorate([d],t)}(cc.Component));o.PartTileUpdater=v,cc._RF.pop()},{CoreTileUpdater:"CoreTileUpdater",GameComponentsLocator:"GameComponentsLocator",PartInterfaces:"PartInterfaces",SkillChooser:"SkillChooser"}],PartTimer:[function(e,t,o){"use strict";cc._RF.push(t,"7fc0bFkviVBC664OUfqUoX2","PartTimer"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("GameComponentsLocator"),a=e("PartInterfaces"),i=e("PartInterfaces"),s=e("SkillEvent");(function(e){e[e.Tick=0]="Tick"})(r=o.TimerEventType||(o.TimerEventType={}));var l=cc._decorator,c=l.ccclass,p=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.parse=function(e,t){var o=n.GameComponentsLocator.get(s.SkillEvent);return{defaultDuration:i.tryParseStatParam(e,t.duration),duration:i.tryParseStatParam(e,t.duration),events:o.parseEvents(t.events,this.parseEventType),state:!1}},t.prototype.updatePart=function(e,t){return t},t.prototype.getEvents=function(e){for(var t=[],o=0,r=e.events;o<r.length;o++){var n=r[o];t.push(n.systemEventName)}return t},t.prototype.hasEvent=function(e,t){for(var o=!1,r=0,n=t.events;r<n.length;r++){if(n[r].systemEventName===e){o=!0;break}}return o},t.prototype.performEvent=function(e,t,o){if(!t.state)return t;for(var n=0,a=t.events;n<a.length;n++){var i=a[n];if(i.systemEventName===e.systemEventName){switch(i.callback){case r.Tick:t=this.tick(e.eventData,t)}break}}return t},t.prototype.exec=function(e,t){return e.duration=e.defaultDuration,e.state=!0,a.makeDefaultSkillExecuteResult(e)},t.prototype.parseEventType=function(e){var t=null;switch(e){case"tick":t=r.Tick}return t},t.prototype.tick=function(e,t){return-1!=t.duration&&(t.state=t.duration>0,t.duration=cc.misc.clampf(t.duration-1,0,1e3)),t},t=__decorate([c],t)}(cc.Component));o.PartTimer=p,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",PartInterfaces:"PartInterfaces",SkillEvent:"SkillEvent"}],Pausable:[function(e,t,o){"use strict";cc._RF.push(t,"b4fe5LGe+5N96XGKpgdfULK","Pausable"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=(r.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onPause=!1,t}return __extends(t,e),t=__decorate([n],t)}(cc.Component));o.default=a,cc._RF.pop()},{}],PauseGame:[function(e,t,o){"use strict";cc._RF.push(t,"7a001kejRVGFaFM0Ef1YZjN","PauseGame"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("PauseSystem"),n=cc._decorator,a=n.ccclass,i=(n.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.buttonCallback=function(e,t){var o=r.PauseSystem;o.isPaused()?o.gameResume():o.gamePause()},t=__decorate([a],t)}(cc.Component));o.default=i,cc._RF.pop()},{PauseSystem:"PauseSystem"}],PauseSystem:[function(e,t,o){"use strict";cc._RF.push(t,"52f064sEf1Jw79l/G384Ffo","PauseSystem"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass;r.property;function a(e){return void 0!==e.onPause}var i=function(){function e(){}var t;return t=e,e.isPaused=function(){return this.paused},e.gamePause=function(){this.paused=!0,t.loopIPausables(t.tryPauseNode)},e.gameResume=function(){this.paused=!1,t.loopIPausables(t.tryResumeNode)},e.loopIPausables=function(e){var t=cc.director.getScene();null!=t&&t.walk(e,null)},e.tryPauseNode=function(e){for(var t=!1,o=0,r=e.getComponents(cc.Component);o<r.length;o++){a(r[o])&&(t=!0)}t&&(e.active=!1)},e.tryResumeNode=function(e){for(var t=!1,o=0,r=e.getComponents(cc.Component);o<r.length;o++){a(r[o])&&(t=!0)}t&&(e.active=!0)},e.paused=!1,e=t=__decorate([n],e)}();o.PauseSystem=i,cc._RF.pop()},{}],PersistNode:[function(e,t,o){"use strict";cc._RF.push(t,"02c3cpPy+dIYZmKbXQD5Avl","PersistNode"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isPersist=!0,t}return __extends(t,e),t.prototype.start=function(){!cc.game.isPersistRootNode(this.node)&&this.isPersist&&cc.game.addPersistRootNode(this.node)},__decorate([a],t.prototype,"isPersist",void 0),t=__decorate([n],t)}(cc.Component);o.default=i,cc._RF.pop()},{}],RandomAnim:[function(e,t,o){"use strict";cc._RF.push(t,"0e5f0w9mOxLqqnIZHYgpEke","RandomAnim"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var e=this.getComponent(cc.Animation);if(e){var t=e.getClips();t.length?e.play(t[Math.round(Math.random()*(t.length-1))].name):cc.log("No clip found")}else cc.error("No cc.Animation component found")},t=__decorate([n],t)}(cc.Component));o.default=a,cc._RF.pop()},{}],Reloader:[function(e,t,o){"use strict";cc._RF.push(t,"cf54b4hETRBkLLiFfuahc12","Reloader"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=(r.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ctrlModifier=!1,t.shiftModifier=!1,t.altModifier=!1,t}return __extends(t,e),t.prototype.onLoad=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},t.prototype.onKeyDown=function(e){e.keyCode==cc.macro.KEY.ctrl&&(this.ctrlModifier=!0),e.keyCode==cc.macro.KEY.shift&&(this.shiftModifier=!0),e.keyCode==cc.macro.KEY.alt&&(this.altModifier=!0)},t.prototype.onKeyUp=function(e){e.keyCode==cc.macro.KEY.ctrl&&(this.ctrlModifier=!1),e.keyCode==cc.macro.KEY.shift&&(this.shiftModifier=!1),e.keyCode==cc.macro.KEY.alt&&(this.altModifier=!1),e.keyCode==cc.macro.KEY.r&&this.reloadScene()},t.prototype.reloadScene=function(){cc.director.loadScene(cc.director.getScene().name)},t.prototype.hasModifiers=function(e,t,o){return this.ctrlModifier==e&&this.shiftModifier==t&&this.altModifier==o},t=__decorate([n],t)}(cc.Component));o.default=a,cc._RF.pop()},{}],SceneSelector:[function(e,t,o){"use strict";cc._RF.push(t,"60a56IC/h5Iqp2j5SMd8bKK","SceneSelector"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("GameComponentsLocator"),n=e("GlobalHandler"),a=e("SceneTransition"),i=cc._decorator,s=i.ccclass,l=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.buttonCallback=function(e,t){var o=r.GameComponentsLocator.get(n.GlobalHandler);if(null!=o){var i=o.getComponent(a.SceneTransition);null!=i&&i.gotoScene(t)}},t=__decorate([s],t)}(cc.Component));o.default=l,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",GlobalHandler:"GlobalHandler",SceneTransition:"SceneTransition"}],SceneTransition:[function(e,t,o){"use strict";cc._RF.push(t,"67183K7fwdKwqD92pbm4sj0","SceneTransition"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("GameComponentsLocator"),n=e("GlobalHandler"),a=cc._decorator,i=a.ccclass,s=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transitionTime=.5,t}var o;return __extends(t,e),o=t,t.prototype.gotoScene=function(e){cc.find("Canvas").runAction(cc.sequence(cc.fadeOut(this.transitionTime),cc.callFunc(function(){cc.director.loadScene(e,this.fadeIn)},this)))},t.prototype.fadeIn=function(){var e=r.GameComponentsLocator.get(n.GlobalHandler);if(null!=e){var t=e.getComponent(o);if(null!=t){var a=cc.find("Canvas");a.opacity=0,a.runAction(cc.fadeIn(t.transitionTime))}}},__decorate([s],t.prototype,"transitionTime",void 0),t=o=__decorate([i],t)}(cc.Component);o.SceneTransition=l,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",GlobalHandler:"GlobalHandler"}],ScrollSpriteFrame:[function(e,t,o){"use strict";cc._RF.push(t,"a9fdah91E1JlKdVurdh7fox","ScrollSpriteFrame"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t.firstFrame=null,t.secondFrame=null,t.thirdFrame=null,t.sprites=[],t.testMove=!1,t.testMoveSpeed=1,t.changeEdge=0,t.isFirstMove=!0,t.spriteIndex=0,t.moveNodes=[],t}return __extends(t,e),t.prototype.onLoad=function(){if(null!=this.sprite&&null!=this.firstFrame&&null!=this.secondFrame&&null!=this.thirdFrame){if(this.sprites.length>0){var e=this.getNextSprite(),t=this.getNextSprite(),o=this.getNextSprite();this.firstFrame.getComponent(cc.Sprite).spriteFrame=e,this.secondFrame.getComponent(cc.Sprite).spriteFrame=t,this.thirdFrame.getComponent(cc.Sprite).spriteFrame=o,this.firstFrame.width=e.getOriginalSize().width,this.secondFrame.width=t.getOriginalSize().width,this.thirdFrame.width=o.getOriginalSize().width}else{var r=this.sprite.spriteFrame.getOriginalSize().width;this.firstFrame.getComponent(cc.Sprite).spriteFrame=this.sprite.spriteFrame,this.secondFrame.getComponent(cc.Sprite).spriteFrame=this.sprite.spriteFrame,this.thirdFrame.getComponent(cc.Sprite).spriteFrame=this.sprite.spriteFrame,this.firstFrame.width=r,this.secondFrame.width=r,this.thirdFrame.width=r}this.firstFrame.x=-this.firstFrame.width,this.secondFrame.x=0,this.thirdFrame.x=this.secondFrame.width,this.changeEdge=-this.firstFrame.width-this.secondFrame.width/2,this.moveNodes.push(this.firstFrame),this.moveNodes.push(this.secondFrame),this.moveNodes.push(this.thirdFrame),this.sprite.enabled=!1}else cc.error("ScrollSpriteFrame | wrong sprite or one of frames"),this.node.destroy()},t.prototype.update=function(e){this.testMove&&this.scrollSprite(this.testMoveSpeed*e)},t.prototype.scrollSprite=function(e){this.moveNodes.forEach(function(t){t.x-=e});var t=9999,o=-9999,r=null,n=null,a=null;if(this.moveNodes.forEach(function(e){t>e.x&&(t=e.x,r=e),o<e.x&&(o=e.x,n=e)}),this.moveNodes.forEach(function(e){e!=r&&e!=n&&(a=e)}),t<=this.changeEdge&&(r.x=n.x+n.width,this.changeEdge=-a.width-n.width/2,this.sprites.length>0)){var i=this.getNextSprite();r.getComponent(cc.Sprite).spriteFrame=i,r.width=i.getOriginalSize().width}},t.prototype.getNextSprite=function(){var e=this.sprites[this.spriteIndex];return this.spriteIndex++,this.spriteIndex%=this.sprites.length,e},__decorate([a(cc.Sprite)],t.prototype,"sprite",void 0),__decorate([a(cc.Node)],t.prototype,"firstFrame",void 0),__decorate([a(cc.Node)],t.prototype,"secondFrame",void 0),__decorate([a(cc.Node)],t.prototype,"thirdFrame",void 0),__decorate([a(cc.SpriteFrame)],t.prototype,"sprites",void 0),__decorate([a],t.prototype,"testMove",void 0),__decorate([a],t.prototype,"testMoveSpeed",void 0),t=__decorate([n],t)}(cc.Component);o.ScrollSpriteFrame=i,cc._RF.pop()},{}],ScrollViewConstraits:[function(e,t,o){"use strict";cc._RF.push(t,"1ce408inKlDALISZAU2yrDA","ScrollViewConstraits"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scrollView=null,t.bottom_constrait=!0,t}return __extends(t,e),t.prototype.update=function(e){var t=this.scrollView.getScrollOffset();this.bottom_constrait&&t.y>0&&(t.y=0,this.scrollView.scrollTo(t))},__decorate([a(cc.ScrollView)],t.prototype,"scrollView",void 0),__decorate([a],t.prototype,"bottom_constrait",void 0),t=__decorate([n],t)}(cc.Component);o.default=i,cc._RF.pop()},{}],SkillAIController:[function(e,t,o){"use strict";cc._RF.push(t,"52c8fTljJhHWbaG/Y8UqSBY","SkillAIController"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CoreMover"),n=e("SkillLoader"),a=e("TileDisplay"),i=cc._decorator,s=i.ccclass,l=(i.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.owner=null,t.controller=null,t}return __extends(t,e),t.prototype.init=function(){cc.systemEvent.on(r.CoreMover.EventMovePerformEnded.eventName,this.onSkillTick,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(r.CoreMover.EventMovePerformEnded.eventName,this.onSkillTick,this)},t.prototype.onSkillTick=function(){for(var e=this.controller.skills,t=0;t<e.length;t++){var o=e[t];if(o.cooldown.isReady()&&o.data.info.type==n.SkillType.Active){cc.systemEvent.emit(a.TileDisplay.EventSyncTileDisplay.eventName,new a.TileDisplay.EventSyncTileDisplay),this.controller.performSkill(t);break}}},t=__decorate([s],t)}(cc.Component));o.SkillAIController=l,cc._RF.pop()},{CoreMover:"CoreMover",SkillLoader:"SkillLoader",TileDisplay:"TileDisplay"}],SkillBarBehavior:[function(e,t,o){"use strict";cc._RF.push(t,"b3c1b1NgqNIK472iNgLxtG7","SkillBarBehavior");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("TwoStateBehavior"),{ccclass:a,property:i}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.cellPrefab=null,this.cellMax=5}onLoad(){for(let e=0;e<this.cellMax;e++){cc.instantiate(this.cellPrefab).parent=this.node}}setLvl(e){if(e>0&&e<this.cellMax){e--;let t=this.getComponentsInChildren(n.TwoStateBehavior);for(let o of t)e>=0?o.switchOn():o.switchOff(),e--}}setMaxLvl(e){if(e>0&&e<this.cellMax){e--;let t=this.getComponentsInChildren(n.TwoStateBehavior);for(let o of t)o.node.active=e>=0,e--}}};r([i(cc.Prefab)],s.prototype,"cellPrefab",void 0),r([i],s.prototype,"cellMax",void 0),s=r([a],s),o.SkillBarBehavior=s,cc._RF.pop()},{TwoStateBehavior:"TwoStateBehavior"}],SkillChooser:[function(e,t,o){"use strict";cc._RF.push(t,"7ddafIN6o9Ey7/ey0Ba8/yB","SkillChooser"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("PartInterfaces"),a=e("TileChooser");(function(e){e[e.Input=0]="Input",e[e.Acc=1]="Acc",e[e.Length=2]="Length"})(r=o.SkillChooserType||(o.SkillChooserType={}));var i=cc._decorator,s=i.ccclass,l=(i.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.choose=null,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){cc.systemEvent.on(o.EventChoose.eventName,this.onChoose,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(o.EventChoose.eventName,this.onChoose,this)},t.prototype.startChoose=function(e,t,o){switch(t){case n.SkillExecuteType.Input:this.choose={index:e,type:r.Input,execType:t,amount:1,callbacks:o,chosen:[]},cc.systemEvent.emit(a.TileChooser.EventChooseStarted.eventName,new a.TileChooser.EventChooseStarted(this.choose));break;case n.SkillExecuteType.RowOrColumn:case n.SkillExecuteType.InputTwo:this.choose={index:e,type:r.Input,execType:t,amount:2,callbacks:o,chosen:[]},cc.systemEvent.emit(a.TileChooser.EventChooseStarted.eventName,new a.TileChooser.EventChooseStarted(this.choose));break;default:cc.warn("Unknown callback type")}},t.prototype.cancelChoose=function(e){var t=!1;return null==this.choose?t:(e==this.choose.index&&(cc.systemEvent.emit(a.TileChooser.EventChooseCanceled.eventName,new a.TileChooser.EventChooseCanceled),this.choose=null,t=!0),t)},t.prototype.onChoose=function(e){for(var t=this.choose,o=0,r=t.chosen;o<r.length;o++){if(r[o]===e.tile){if(t.amount==t.chosen.length){var n=this.prepareCall(t.execType,t.chosen);cc.systemEvent.emit(a.TileChooser.EventChooseEnded.eventName,new a.TileChooser.EventChooseEnded),this.executeCalbacks(n,t.callbacks),this.choose=null}return}}t.chosen.push(e.tile),cc.systemEvent.emit(a.TileChooser.EventChoose.eventName,new a.TileChooser.EventChoose)},t.prototype.prepareCall=function(e,t){var o=[];switch(e){case n.SkillExecuteType.Input:case n.SkillExecuteType.RowOrColumn:case n.SkillExecuteType.InputTwo:o=t;break;default:cc.warn("Unknown callback type")}return o},t.prototype.executeCalbacks=function(e,t){for(var o=0,r=t;o<r.length;o++){if(!r[o].callback(e)){cc.log("SkillChooser | cant use skill");break}}},t.prototype.parseChooser=function(e,t){var o=null;return null==(o=this.parseChoose(e))&&(o=t(e)),o},t.prototype.myChoice=function(e){for(var t=!1,o=0;o<r.Length;o++)if(e==o){t=!0;break}return t},t.prototype.parseChoose=function(e){var t=null;switch(e){case"input":t=r.Input;break;case"acc":t=r.Acc}return t},t=o=__decorate([s],t)}(cc.Component));o.SkillChooser=l,function(e){var t=function(){function e(e){this.tile=null,this.tile=e}return e.eventName="SkillChooserEventChoose",e}();e.EventChoose=t}(l=o.SkillChooser||(o.SkillChooser={})),o.SkillChooser=l,o.default=l,cc._RF.pop()},{PartInterfaces:"PartInterfaces",TileChooser:"TileChooser"}],SkillCooldown:[function(e,t,o){"use strict";cc._RF.push(t,"676ed9IydZB95R9/aqavGwV","SkillCooldown"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=(r.property,r.requireComponent,r.disallowMultiple,r.menu,function(){function e(){this.baseDuration=0,this.currentDuration=0,this.perLvl=0}return e.prototype.init=function(e,t,o){void 0!=t?(this.baseDuration=e,this.perLvl=t):this.baseDuration=e,this.currentDuration=void 0!=o?o:0},e.prototype.tick=function(){-1!=this.baseDuration&&(this.currentDuration=cc.misc.clampf(this.currentDuration-1,0,this.baseDuration))},e.prototype.reset=function(){this.currentDuration=this.baseDuration},e.prototype.isReady=function(){return 0===this.currentDuration},e=__decorate([n],e)}());o.SkillCooldown=a,cc._RF.pop()},{}],SkillEventMapper:[function(e,t,o){"use strict";cc._RF.push(t,"28f31qSYJlFY4q0TZXjoGSY","SkillEventMapper"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("BattleController"),n=cc._decorator,a=n.ccclass,i=(n.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var o;return __extends(t,e),o=t,t.prototype.getSysEvent=function(e){var t=null;switch(e){case"onHit":t=r.BattleController.EventHitEfx.eventName}return t},t.prototype.emitTestSkillPerform=function(){cc.systemEvent.emit(o.EventTestSkill.eventName,new o.EventTestSkill)},t=o=__decorate([a],t)}(cc.Component));o.SkillEventMapper=i,function(e){var t=function(){function e(){}return e.eventName="EventTestSkill",e}();e.EventTestSkill=t}(i=o.SkillEventMapper||(o.SkillEventMapper={})),o.SkillEventMapper=i,o.default=i,cc._RF.pop()},{BattleController:"BattleController"}],SkillEvent:[function(e,t,o){"use strict";cc._RF.push(t,"2e1c1/E37NGPoyQxz0J8SLk","SkillEvent"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("GameComponentsLocator"),n=e("SkillEventMapper"),a=cc._decorator,i=a.ccclass,s=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.parseEvents=function(e,t){for(var o=[],r=0,n=e;r<n.length;r++){var a=n[r];o.push(this.parseEvent(a,t))}return o},t.prototype.parseEvent=function(e,t){return{callback:t(e.callback),systemEventName:e.eventType,amount:void 0===e.amount?0:e.amount}},t.prototype.eventMapper=function(e){var t=r.GameComponentsLocator.get(n.SkillEventMapper);return null!=t?t.getSysEvent(e):null},t=__decorate([i],t)}(cc.Component));o.SkillEvent=s,function(e){var t=function(){function e(e,t,o){this.name="",this.from=null,this.args=null,this.name=e,this.from=t,this.args=o}return e.eventName="BaseEvent",e}();e.BaseEvent=t}(s=o.SkillEvent||(o.SkillEvent={})),o.SkillEvent=s,o.default=s,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",SkillEventMapper:"SkillEventMapper"}],SkillExecuter:[function(e,t,o){"use strict";cc._RF.push(t,"a62bf+tNUtE26ZFJDFAUngM","SkillExecuter");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("GameComponentsLocator"),a=e("SkillLoader"),i=e("PartInterfaces"),s=e("PartInterfaces"),{ccclass:l,property:c}=cc._decorator;let p=class extends cc.Component{constructor(){super(...arguments),this.skillLoader=null}onLoad(){this.skillLoader=n.GameComponentsLocator.get(a.SkillLoader)}createContext(e,t,o){return{owner:t,currentSkill:e,skills:void 0===o?[]:o}}activateWithEvent(e,t,o,r){e.info;let n=e.parts,a=this.filterActivatorParts(n);for(let e of a.filtered)this.invokeEvent(e,t,o,r);for(let e of a.activators){let o=this.skillLoader.getSkillHandlerByID(e.activate.part.type);e.activate;if(null!=o&&e.target.part.part.state&&this.checkTarget(e.target,e)){let o=this.invokeExec(e.activate,t);e.activate=o.partRef}}return e}resetPartsState(e){let t=[];for(let o of e)null!=o.part&&o.type!=a.SkillPartType.Timer&&(o.part.state=!1),t.push(o);return t}getActiveParts(e,t){let o=e.parts,r=this.filterActivatorParts(o,!0),n=[];for(let e of r.filtered)n.push(e.part);return n}activate(e,t){let o=this.createContext(e,t);return this.execute(e,o)}execute(e,t){e.info;let o=e.parts,r=t.owner,n=[],a=this.filterActivatorParts(o);for(let e of a.filtered)n.push(this.invokeExec(e,r));for(let e of a.activators){let t=this.skillLoader.getSkillHandlerByID(e.activate.part.type);e.activate;if(null!=t&&e.target.part.part.state&&this.checkTarget(e.target,e)){let t=this.invokeExec(e.activate,r);e.activate=t.partRef,n.push(t)}}return this.mergeAnswers(n,e)}filterActivatorParts(e,t){let o=[],r=[];for(let t in e){let n=e[t];n.type===a.SkillPartType.Activator?r.push(this.buildActivator(t,n,e)):o.push({index:t,part:n})}let n=e=>!(this.isIndexInActivators(e.index,r)&&!e.part.part.state);return t&&(n=(e=>!this.isIndexInActivators(e.index,r))),o.length>0&&(o=o.filter(n)),{filtered:o,activators:r}}buildActivator(e,t,o){let r=t.part.target,n=t.part.activate;return{activatorType:t.part.activatorType,activator:{index:parseInt(e),part:t},target:r>=0?{index:r,part:o[r]}:null,activate:n>=0?{index:n,part:o[n]}:null}}isIndexInActivators(e,t){let o=!1;for(let r of t)if(r.activate.index==e){o=!0;break}return o}sortParts(e){let t=[],o=0;for(let r of e){let r=this.findRefWithIndex(o,e);null!=r?t.push(r.part):cc.warn(`SkillExecuter | can*t find part with index ${o}, in {refs}`),o++}return t}findRefWithIndex(e,t){let o=null;for(let r of t)if(r.index==e){o=r;break}return o}invokeEvent(e,t,o,r){let n=e.part,a=this.skillLoader.getSkillHandlerByID(n.type);if(null!=a&&s.IsISkillEventHolder(a)){let i={systemEventName:o,eventData:r};e.part.part=a.performEvent(i,n.part,t)}return e}invokeExec(e,t){let o=e.part,r=this.skillLoader.getSkillHandlerByID(o.type),n=null;return null!=r&&i.IsISkillExecutable(r)&&(n=r.exec(o.part,t)),{partRef:e,result:n}}invokeGetCondition(e,t){let o=this.skillLoader.getSkillHandlerByID(t.type),r=null;return null!=o&&s.IsISkillActivable(o)&&(r=o.getCondition(e,t.part)),r}mergeAnswers(e,t){let o=[],r=!0,n=null;for(let t of e){if(0==t.result.canExec){r=!1,o=[];break}let e=t.result.callback;if(void 0!=e){if(null==n&&(n=t.result.callbackType),n!=t.result.callbackType){cc.warn("SkillExecuter | diff callback types in one Skill"),r=!1,o=[];break}o.push(e)}}return{data:t,resetCooldown:r,chooseType:n,callbacks:o}}checkTarget(e,t){let o=!0,r=e.part.part.duration,n=t.activator.part.part.targetAmount;return void 0!=r&&void 0!=n&&r!=n&&(o=!1),o}};p=r([l],p),o.SkillExecuter=p,cc._RF.pop()},{GameComponentsLocator:"GameComponentsLocator",PartInterfaces:"PartInterfaces",SkillLoader:"SkillLoader"}],SkillLoader:[function(e,t,o){"use strict";cc._RF.push(t,"6d2efWB9yZC16wXI1HQRywp","SkillLoader"),Object.defineProperty(o,"__esModule",{value:!0});var r,n,a,i,s,l,c,p=e("PartInterfaces"),u=e("HeroDataMapper");(function(e){e[e.StatChanger=0]="StatChanger",e[e.Randomizer=1]="Randomizer",e[e.Activator=2]="Activator",e[e.Timer=3]="Timer",e[e.Counter=4]="Counter",e[e.Healer=5]="Healer",e[e.TileDestroyer=6]="TileDestroyer",e[e.Damage=7]="Damage",e[e.TileUpdater=8]="TileUpdater",e[e.SetGlobal=9]="SetGlobal",e[e.TileCreator=10]="TileCreator",e[e.TileMover=11]="TileMover"})(r=o.SkillPartType||(o.SkillPartType={})),function(e){e[e.Active=0]="Active",e[e.Passive=1]="Passive"}(n=o.SkillType||(o.SkillType={})),function(e){e[e.None=0]="None",e[e.Strength=1]="Strength",e[e.Agility=2]="Agility",e[e.Intelligence=3]="Intelligence"}(a=o.SkillBaseStat||(o.SkillBaseStat={})),function(e){e[e.Common=0]="Common",e[e.Rare=1]="Rare",e[e.Legendary=2]="Legendary"}(i=o.SkillRare||(o.SkillRare={})),function(e){e[e.Part=0]="Part",e[e.Stat=1]="Stat",e[e.StatPerLvl=2]="StatPerLvl"}(s=o.SkillDescriptionParamCode||(o.SkillDescriptionParamCode={})),function(e){e[e.Self=0]="Self",e[e.Other=1]="Other",e[e.All=2]="All"}(l=o.SkillTarget||(o.SkillTarget={})),function(e){e[e.Hero=0]="Hero",e[e.Enemy=1]="Enemy"}(c=o.SkillOwnerType||(o.SkillOwnerType={}));var h=cc._decorator,d=h.ccclass,v=h.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attackSkills=null,t.defenceSkills=null,t.specialSkills=null,t.heroSkills=null,t.enemyRawSkills=null,t.skills=[],t.enemySkills=[],t.partList=[],t.baseStatMultTable=[[1,1,1,1],[1,1.5,1,.5],[1,.5,1.5,1],[1,1,.5,1.5]],t}return __extends(t,e),t.prototype.onLoad=function(){for(var e=0,t=this.getComponents(cc.Component);e<t.length;e++){var o=t[e];p.IsISkillParsable(o)&&this.partList.push(o)}this.skills=this.attackSkills.json.skills,this.skills=this.skills.concat(this.defenceSkills.json.skills),this.skills=this.skills.concat(this.specialSkills.json.skills),this.enemySkills=this.enemyRawSkills.json.skills},t.prototype.updateSkillData=function(e,t){var o=t.info;o.cooldown=p.tryUpdateStat(e,o.cooldown,o.cooldownPerLvl,o.perLvlfrequency);for(var r=0,n=t.parts;r<n.length;r++){var a=n[r],i=this.getSkillHandlerByID(a.type);p.IsISkillUpdatable(i)?a.part=i.updatePart(e,a.part):cc.warn("SkillLoader | skill - "+a.type+" - not updatable")}return t},t.prototype.getHeroSkillData=function(e,t){return this.getSkillData(e,c.Hero,t)},t.prototype.getEnemySkillData=function(e,t){return this.getSkillData(e,c.Enemy,t)},t.prototype.getSkillDescription=function(e,t,o){for(var r=0,n=t==c.Hero?this.skills:this.enemySkills;r<n.length;r++){var a=n[r];if(a.info.name===e){var i=this.parseBaseStat(a.info.baseStat),s=this.calcStatMult(i,this.mapBaseStat(o));return this.checkDescription(s,a)}}return null},t.prototype.getSkillData=function(e,t,o){for(var r=null,n=[],a=0,i=t==c.Hero?this.skills:this.enemySkills;a<i.length;a++){var s=i[a];if(s.info.name===e){var l=this.parseBaseStat(s.info.baseStat),p=this.calcStatMult(l,this.mapBaseStat(o));r=this.getSkillInfo(p,s);for(var u=0,h=s.skillParts;u<h.length;u++){var d=h[u];n.push(this.getPartData(p,d))}}}return 0===n.length&&cc.log("SkillLoader | can`t find skill with name - "+e),{info:r,parts:n}},t.prototype.getSkillInfo=function(e,t){var o=t.info,r=null;return void 0!=o&&(r={name:o.name,type:this.parseType(o.type),rare:this.parseRare(o.rare),onlyBaseStat:this.parseOnlyBaseStat(o.onlyBaseStat),baseStat:this.parseBaseStat(o.baseStat),cooldown:parseInt(o.cooldown),cooldownPerLvl:parseInt(o.cooldownPerLvl),perLvlfrequency:parseInt(o.perLvlfrequency),description:this.checkDescription(e,t)}),r},t.prototype.getSkillDescForLvl=function(e,t,o){var r=t.desc;for(var n in t.params){var a=t.params[n],i=p.tryUpdateStat(e,a.amount,a.amountPerLvl,a.perLvlfrequency);r=o?r.replace("param_"+n," <color=#00ff00>"+(Math.round(100*i)/100).toString()+"</c>"):r.replace("param_"+n," "+(Math.round(100*i)/100).toString())}return r},t.prototype.checkDescription=function(e,t){var o=t.info.description,r=t.info.descriptionTitle,n=t.info.descriptionParams;if(void 0==o)return null;if(0==n.length)return{name:r,desc:o,params:[]};for(var a=!1,i=10,l=[],c=0;i--;){var u=this.subString("{","}",o);if(u.length!=o.length&&u.length>0){var h=n[this.parseRef(u)];a=!0;var d=h.split(":",3),v=this.getPartByType(d[s.Part],t);if(null!=v){var f=p.tryParseStatParam(e,v[d[s.Stat]]),m=v[d[s.StatPerLvl]],y=v.perLvlfrequency;o=o.replace("{"+u+"}","param_"+c),c++,l.push({name:d[s.Stat],amount:f,amountPerLvl:m,perLvlfrequency:y})}}if(!a)break;a=!1}return{name:r,desc:o,params:l}},t.prototype.getPartByType=function(e,t){for(var o=null,r=0,n=t.skillParts;r<n.length;r++){var a=n[r];if(a.type==e){o=a;break}}return o},t.prototype.subString=function(e,t,o){var r=0,n=o.length;return void 0!=e&&(r=o.indexOf(e)+1),void 0!=t&&(n=o.indexOf(t,r)),o.substr(r,n-r)},t.prototype.parseRef=function(e){var t=e.indexOf("_");if(t>0){var o=e.substring(t+1,e.length);t=parseInt(o)}return t},t.prototype.calcStatMult=function(e,t){return this.baseStatMultTable[t][e]},t.prototype.parseOnlyBaseStat=function(e){var t=null;switch(e){case"true":t=!0;break;case"false":t=!1}return t},t.prototype.parseBaseStat=function(e){var t=null;switch(e){case"strength":t=a.Strength;break;case"agility":t=a.Agility;break;case"intelligence":t=a.Intelligence;break;case"none":t=a.None}return t},t.prototype.parseRare=function(e){var t=null;switch(e){case"common":t=i.Common;break;case"rare":t=i.Rare;break;case"legendary":t=i.Legendary}return t},t.prototype.parseType=function(e){var t=null;switch(e){case"passive":t=n.Passive;break;case"active":t=n.Active}return t},t.parseTarget=function(e){var t=null;switch(e){case"self":t=l.Self;break;case"other":t=l.Other;break;case"all":t=l.All}return t},t.prototype.getPartData=function(e,t){var o=this.getPartIDByName(t.type),r=this.partList[o],n={type:o,part:null};return-1==o?n:(p.IsISkillParsable(r)?n.part=r.parse(e,t):cc.warn("SkillLoader | skill - "+name+" - not parsable"),n)},t.prototype.getPartIDByName=function(e){var t=-1;switch(e){case"statChanger":t=r.StatChanger;break;case"randomizer":t=r.Randomizer;break;case"activator":t=r.Activator;break;case"timer":t=r.Timer;break;case"counter":t=r.Counter;break;case"healer":t=r.Healer;break;case"tileDestroyer":t=r.TileDestroyer;break;case"damage":t=r.Damage;break;case"tileUpdater":t=r.TileUpdater;break;case"setGlobal":t=r.SetGlobal;break;case"tileCreator":t=r.TileCreator;break;case"tileMover":t=r.TileMover;break;default:cc.error("SkillLoader | skill - "+e+" - not found")}return t},t.prototype.isString=function(e){return"string"==typeof e},t.prototype.getSkillHandlerByID=function(e){return-1===(e=this.isString(e)?this.getPartIDByName(e):e)?null:this.partList[e]},t.prototype.mapBaseStat=function(e){var t=a.None;switch(e){case u.BaseStatType.Agility:t=a.Agility;break;case u.BaseStatType.Strength:t=a.Strength;break;case u.BaseStatType.Intelligence:t=a.Intelligence}return t},__decorate([v(cc.JsonAsset)],t.prototype,"attackSkills",void 0),__decorate([v(cc.JsonAsset)],t.prototype,"defenceSkills",void 0),__decorate([v(cc.JsonAsset)],t.prototype,"specialSkills",void 0),__decorate([v(cc.JsonAsset)],t.prototype,"heroSkills",void 0),__decorate([v(cc.JsonAsset)],t.prototype,"enemyRawSkills",void 0),t=__decorate([d],t)}(cc.Component);o.SkillLoader=f,cc._RF.pop()},{HeroDataMapper:"HeroDataMapper",PartInterfaces:"PartInterfaces"}],SkillMapper:[function(e,t,o){"use strict";var r,n;cc._RF.push(t,"426a1paDHJFoYHsgXcr5p4l","SkillMapper"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.Unknown=-1]="Unknown",e[e.ThoughtlessBlow=0]="ThoughtlessBlow",e[e.SizzlingRay=1]="SizzlingRay",e[e.TheTechniqueOfFourSeals=5]="TheTechniqueOfFourSeals",e[e.AHundredBlades=8]="AHundredBlades",e[e.GodsPunishment=9]="GodsPunishment",e[e.DemonSnakeBite=11]="DemonSnakeBite",e[e.Rage=12]="Rage",e[e.TouchOfDeath=13]="TouchOfDeath",e[e.Regeneration=16]="Regeneration",e[e.Healing=20]="Healing",e[e.Phoenix=25]="Phoenix",e[e.Vampirism=38]="Vampirism",e[e.Evasion=18]="Evasion",e[e.Block=19]="Block",e[e.SteelSkin=22]="SteelSkin",e[e.DiamondSkin=23]="DiamondSkin",e[e.GhostArmor=36]="GhostArmor",e[e.SecondWind=39]="SecondWind",e[e.Chameleon=41]="Chameleon",e[e.Teleport=43]="Teleport",e[e.Substitution=44]="Substitution",e[e.AncientRelic=47]="AncientRelic",e[e.Order=50]="Order",e[e.Mutation=55]="Mutation",e[e.Wave=49]="Wave"}(r=o.SkillType||(o.SkillType={})),function(e){e[e.Unknown=-1]="Unknown",e[e.Hit=0]="Hit",e[e.Regeneration=1]="Regeneration",e[e.FireBall=2]="FireBall",e[e.Bloodlust=3]="Bloodlust",e[e.Hook=4]="Hook",e[e.Cleaver=5]="Cleaver",e[e.Roar=6]="Roar",e[e.Wave=7]="Wave"}(n=o.EnemySkillType||(o.EnemySkillType={}));var a=cc._decorator,i=a.ccclass,s=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.getHeroSkill=function(e){var t=r.Unknown;return t==r.Unknown&&(t=this.getActiveSkill(e)),t==r.Unknown&&(t=this.getDefenceSkill(e)),t==r.Unknown&&(t=this.getSpecialSkill(e)),t},t.getEnemySkill=function(e){var t=n.Unknown;switch(e){case"Hit":t=n.Hit;break;case"Regeneration":t=n.Regeneration;break;case"Fire ball":t=n.FireBall;break;case"Bloodlust":t=n.Bloodlust;break;case"Hook":t=n.Hook;break;case"Cleaver":t=n.Cleaver;break;case"Roar":t=n.Roar;break;case"Wave":t=n.Wave}return t},t.getSpecialSkill=function(e){var t=r.Unknown;switch(e){case"Second wind":t=r.SecondWind;break;case"Chameleon":t=r.Chameleon;break;case"Teleport":t=r.Teleport;break;case"Substitution":t=r.Substitution;break;case"Ancient relic":t=r.AncientRelic;break;case"Order":t=r.Order;break;case"Mutation":t=r.Mutation;break;case"Wave":t=r.Wave}return t},t.getDefenceSkill=function(e){var t=r.Unknown;switch(e){case"Regeneration":t=r.Regeneration;break;case"Healing":t=r.Healing;break;case"Phoenix":t=r.Phoenix;break;case"Vampirism":t=r.Vampirism;break;case"Evasion":t=r.Evasion;break;case"Block":t=r.Block;break;case"Steel skin":t=r.SteelSkin;break;case"Diamond skin":t=r.DiamondSkin;break;case"Ghost armor":t=r.GhostArmor}return t},t.getActiveSkill=function(e){var t=r.Unknown;switch(e){case"Thoughtless blow":t=r.ThoughtlessBlow;break;case"Sizzling ray":t=r.SizzlingRay;break;case"The technique of four seals":t=r.TheTechniqueOfFourSeals;break;case"A hundred blades":t=r.AHundredBlades;break;case"God's punishment":t=r.GodsPunishment;break;case"Demon Snake Bite":t=r.DemonSnakeBite;break;case"Rage":t=r.Rage;break;case"Touch of death":t=r.TouchOfDeath}return t},t=__decorate([i],t)}(cc.Component));o.SkillMapper=s,cc._RF.pop()},{}],SkillReloadEfxController:[function(e,t,o){"use strict";cc._RF.push(t,"ace24GaWmVLGIlr/71RjSPx","SkillReloadEfxController"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("MathHelper"),n=cc._decorator,a=n.ccclass,i=n.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.light=null,t.twinkSize=.2,t.twinkTime=.2,t.duration=10,t.maxSize=1,t.targetSize=0,t.reachTwink=!1,t.lerpToFun=null,t.lerpFromFun=null,t.startFade=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.targetSize=this.maxSize+this.twinkSize,this.lerpToFun=r.getLerp(this.maxSize,this.targetSize,this.twinkTime),this.lerpFromFun=r.getLerp(this.targetSize,this.maxSize,this.twinkTime)},t.prototype.update=function(e){this.duration-=e,this.duration<=0?(this.startFade||(this.startFade=!0,this.node.runAction(cc.fadeOut(this.twinkTime))),0==this.node.opacity&&this.node.destroy()):this.reachTwink?(this.node.scale=this.lerpFromFun(e),this.node.scale===this.maxSize&&(this.reachTwink=!1,this.lerpFromFun=r.getLerp(this.targetSize,this.maxSize,this.twinkTime))):(this.node.scale=this.lerpToFun(e),this.node.scale===this.maxSize+this.twinkSize&&(this.reachTwink=!0,this.lerpToFun=r.getLerp(this.maxSize,this.targetSize,this.twinkTime)))},__decorate([i(cc.Sprite)],t.prototype,"light",void 0),__decorate([i],t.prototype,"twinkSize",void 0),__decorate([i],t.prototype,"twinkTime",void 0),__decorate([i],t.prototype,"duration",void 0),t=__decorate([a],t)}(cc.Component);o.SkillReloadEfxController=s,cc._RF.pop()},{MathHelper:"MathHelper"}],SkillsController:[function(e,t,o){"use strict";cc._RF.push(t,"98529CN0/lD7r8WfAh68YMp","SkillsController"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("GameComponentsLocator"),n=e("SkillLoader"),a=e("CoreInputController"),i=e("CoreMover"),s=e("SkillCooldown"),l=e("SkillExecuter"),c=e("SkillChooser"),p=e("PartInterfaces"),u=e("SkillEventMapper"),h=e("SkillMapper"),d=e("SkillEvent"),v=e("CharacterSlot"),f=e("HeroDataMapper"),m=e("CoreGameplay"),y=cc._decorator,g=y.ccclass,C=(y.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.owner=null,t.skillLoader=null,t.skillExecuter=null,t.skillChooser=null,t.\u0441oreGameplay=null,t.skills=[],t.eventNameList=[],t.blocked=!0,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){this.skillLoader=r.GameComponentsLocator.get(n.SkillLoader),this.skillExecuter=r.GameComponentsLocator.get(l.SkillExecuter),this.skillChooser=r.GameComponentsLocator.get(c.SkillChooser),this.\u0441oreGameplay=r.GameComponentsLocator.get(m.CoreGameplay),cc.systemEvent.on(i.CoreMover.EventMovePerformEnded.eventName,this.onSkillTick,this),cc.systemEvent.on(u.SkillEventMapper.EventTestSkill.eventName,this.onSkillTest,this),cc.systemEvent.on(d.SkillEvent.BaseEvent.eventName,this.onSkillBaseEvent,this),cc.systemEvent.on(a.CoreInputController.EventBlockingStarted.eventName,this.onBlockingStarted,this),cc.systemEvent.on(a.CoreInputController.EventBlockingFinished.eventName,this.onBlockingFinished,this)},t.prototype.onBlockingStarted=function(e){this.blocked=!0},t.prototype.onBlockingFinished=function(e){this.blocked=!1},t.prototype.initEnemy=function(e){var t;t=e.map(function(e){return{type:e.type,cooldown:e.cooldown,cooldownInit:e.cooldownInit,level:0}}),this.init(t,void 0)},t.prototype.initHero=function(e,t){var o;o=e.map(function(e){return{type:e.skill,level:e.level}}),this.init(o,t)},t.prototype.init=function(e,t){for(var o=0,r=e;o<r.length;o++){var n=r[o];this.loadSkill(n,t)}this.updateEventList()},t.prototype.addOrUpgradeSkill=function(e,t){e.level>1?this.upgradeSkill(e,t):this.addSkill(e,t)},t.prototype.upgradeSkill=function(e,t){this.loadSkill(e,t),this.updateEventList()},t.prototype.addSkill=function(e,t){this.loadSkill(e,t),this.updateEventList()},t.prototype.loadSkill=function(e,t){var r=!1,n=this.owner.slotType==v.SlotType.Player?this.skillLoader.getHeroSkillData(e.type,t?t.baseStat:void 0):this.skillLoader.getEnemySkillData(e.type,f.BaseStatType.Strength);if(null!=n.info){n=this.skillLoader.updateSkillData(e.level,n);var a=new s.SkillCooldown;void 0!=e.cooldown?a.init(e.cooldown,0,e.cooldownInit):a.init(n.info.cooldown,n.info.cooldownPerLvl);var i={cooldown:a,data:n,level:e.level};this.skills.push(i);var l=this.skills.indexOf(i),c=0;c=this.owner.slotType==v.SlotType.Player?h.SkillMapper.getHeroSkill(n.info.name):h.SkillMapper.getEnemySkill(n.info.name),cc.systemEvent.emit(o.EventSkillLoaded.eventName,new o.EventSkillLoaded(l,c,n.info.type,this)),this.updateSkillUI(l,this.skills[l]),r=!0}return r},t.prototype.updateEventList=function(){var e=this.foldlSkillParts(function(e,t,o){return p.IsISkillEventHolder(t)&&(o=o.concat(t.getEvents(e.part)),cc.log("get new events - "+t.getEvents(e.part)+" from part type - "+e.type)),o},this.skills,[]);e.sort(),e=e.filter(function(e,t,o){var r=!0;return t>0&&(r=e!=o[t-1]),r}),this.eventNameList=e},t.prototype.start=function(){this.calcGameParams(this.skills)},t.prototype.onDestroy=function(){cc.systemEvent.off(i.CoreMover.EventMovePerformEnded.eventName,this.onSkillTick,this),cc.systemEvent.off(u.SkillEventMapper.EventTestSkill.eventName,this.onSkillTest,this),cc.systemEvent.off(d.SkillEvent.BaseEvent.eventName,this.onSkillBaseEvent,this),cc.systemEvent.off(a.CoreInputController.EventBlockingStarted.eventName,this.onBlockingStarted,this),cc.systemEvent.off(a.CoreInputController.EventBlockingFinished.eventName,this.onBlockingFinished,this)},t.prototype.onSkillBaseEvent=function(e){if(0!=this.owner.isAlive&&!this.\u0441oreGameplay.gameEnd){var t={owner:e.from,eventArgs:e.args};this.performEvent(e.name,t)}},t.prototype.performEvent=function(e,t){var o=this;for(var r in this.eventNameList){if(this.eventNameList[r]===e){this.skills=this.mapSkills(function(t,r){return o.hasEvent(e,t)&&(t.data=o.skillExecuter.activateWithEvent(t.data,o.node,e,r)),t},this.skills,t);break}}},t.prototype.onSkillTest=function(){this.skills.length>0&&(cc.log("SkillsController | onSkillTest event perform"),this.performSkill(0))},t.prototype.performSkill=function(e){if(!this.skillChooser.cancelChoose(e)&&!this.blocked&&0!=this.owner.isAlive&&!this.\u0441oreGameplay.gameEnd){var t=this.skills[e];if(t.data.info.type==n.SkillType.Active)if(t.cooldown.isReady()){cc.log("SkillsController | performSkill name - "+t.data.info.name);var o=this.skillExecuter.activate(t.data,this.node);t.data=o.data,o.resetCooldown&&(null!=o.chooseType&&o.chooseType!=p.SkillExecuteType.None?(o.callbacks.push(this.makeCooldownResetCallback(e)),this.skillChooser.startChoose(e,o.chooseType,o.callbacks)):(t.cooldown.reset(),this.updateSkillUI(e,t)))}else cc.log(" --- skill in cd - "+t.cooldown.currentDuration)}},t.prototype.makeCooldownResetCallback=function(e){var t=this;return{callback:function(o){return t.skills[e].cooldown.reset(),t.updateSkillUI(e,t.skills[e]),!0}}},t.prototype.onSkillTick=function(){for(var e=this,t=0,o=0,r=this.skills;o<r.length;o++){var n=r[o];n.cooldown.tick(),this.updateSkillUI(t,n),t++}this.resetGameParams(this.skills),this.skills=this.mapSkills(function(t,o){return t.data.parts=e.skillExecuter.resetPartsState(t.data.parts),t},this.skills,[]),this.calcGameParams(this.skills);var a={owner:this.node,eventArgs:void 0};this.performEvent("onGameTick",a)},t.prototype.updateSkillUI=function(e,t){cc.systemEvent.emit(o.EventSkillUpdateCooldown.eventName,new o.EventSkillUpdateCooldown(e,t.cooldown.currentDuration,t.cooldown.baseDuration,this))},t.prototype.getSkillData=function(){return this.skills},t.prototype.calcGameParams=function(e){var t=this;this.skills=this.mapSkills(function(e,o){for(var r=0,n=t.skillExecuter.getActiveParts(e.data,t.node);r<n.length;r++){var a=n[r],i=t.skillLoader.getSkillHandlerByID(a.type);p.IsISkillStatHolder(i)&&(a.part=i.updateStat(a.part,t.node))}return e},this.skills,[])},t.prototype.resetGameParams=function(e){var t=this;this.skills=this.mapSkills(function(e,o){for(var r=0,n=e.data.parts;r<n.length;r++){var a=n[r],i=t.skillLoader.getSkillHandlerByID(a.type);p.IsISkillStatHolder(i)&&(a.part=i.resetStat(a.part,t.node))}return e},this.skills,[])},t.prototype.foldlSkillParts=function(e,t,o,r){for(var n=o,a=0,i=t;a<i.length;a++){var s=i[a];if(s.data.info.type===r||void 0===r)for(var l=0,c=s.data.parts;l<c.length;l++){var p=c[l];n=e(p,this.skillLoader.getSkillHandlerByID(p.type),n)}}return n},t.prototype.mapSkills=function(e,t,o,r){for(var n=[],a=0,i=t;a<i.length;a++){var s=i[a];s.data.info.type!==r&&void 0!==r||(s=e(s,o)),n.push(s)}return n},t.prototype.hasEvent=function(e,t){var o=!1;return o=this.foldlSkillParts(function(t,o,r){if(p.IsISkillEventHolder(o)&&!r)for(var n=0,a=o.getEvents(t.part);n<a.length;n++){if(a[n]===e){r=!0;break}}return r},[t],o)},t.prototype.showSkillParts=function(){this.foldlSkillParts(function(e,t,o){return o},this.skills,null)},t=o=__decorate([g],t)}(cc.Component));o.SkillsController=C,function(e){var t=function(){function e(e,t,o,r){this.skillIndex=0,this.iconIndex=0,this.skillType=null,this.owner=null,this.skillIndex=e,this.iconIndex=t,this.skillType=o,this.owner=r}return e.eventName="EventSkillLoaded",e}();e.EventSkillLoaded=t;var o=function(){function e(e,t,o,r){this.skillIndex=0,this.cooldownMax=0,this.cooldownPercent=0,this.owner=null,this.skillIndex=e,this.cooldownMax=o,this.cooldownPercent=t/o,this.owner=r}return e.eventName="EventSkillUpdateCooldown",e}();e.EventSkillUpdateCooldown=o;var r=function(){function e(e){this.owner=null,this.owner=e}return e.eventName="EventSkillUnload",e}();e.EventSkillUnload=r}(C=o.SkillsController||(o.SkillsController={})),o.SkillsController=C,o.default=C,cc._RF.pop()},{CharacterSlot:"CharacterSlot",CoreGameplay:"CoreGameplay",CoreInputController:"CoreInputController",CoreMover:"CoreMover",GameComponentsLocator:"GameComponentsLocator",HeroDataMapper:"HeroDataMapper",PartInterfaces:"PartInterfaces",SkillChooser:"SkillChooser",SkillCooldown:"SkillCooldown",SkillEvent:"SkillEvent",SkillEventMapper:"SkillEventMapper",SkillExecuter:"SkillExecuter",SkillLoader:"SkillLoader",SkillMapper:"SkillMapper"}],Storage:[function(e,t,o){"use strict";cc._RF.push(t,"a33f2xkWMFGlbI6OjRPaKmm","Storage"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass;r.property;function a(e){return void 0!==e.getID&&void 0!==e.save&&void 0!==e.load}var i=function(){function e(){}var t;return t=e,e.gameSave=function(){t.loopISerializables(t.trySaveNode)},e.gameLoad=function(){t.loopISerializables(t.tryLoadNode)},e.clear=function(){cc.log("Clearing local storage"),cc.log(cc.sys.localStorage),cc.sys.localStorage.clear()},e.loopISerializables=function(e){var t=cc.director.getScene();null!=t&&t.walk(e,null)},e.trySaveNode=function(e){for(var t=0,o=e.getComponents(cc.Component);t<o.length;t++){var r=o[t];a(r)&&cc.sys.localStorage.setItem(r.getID(),r.save())}},e.tryLoadNode=function(e){for(var t=0,o=e.getComponents(cc.Component);t<o.length;t++){var r=o[t];if(a(r)){var n=cc.sys.localStorage.getItem(r.getID());cc.sys.localStorage,r.load(n)}}},e=t=__decorate([n],e)}();o.Storage=i,cc._RF.pop()},{}],SwipeController:[function(e,t,o){"use strict";cc._RF.push(t,"09431RNBnJH+p6D7muFGFUm","SwipeController"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.Right=0]="Right",e[e.Up=1]="Up",e[e.Left=2]="Left",e[e.Down=3]="Down"}(o.SwipeType||(o.SwipeType={}));var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minSwipeDist=10,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},t.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},t.prototype.onTouchEnd=function(e){var t=e.getStartLocation(),r=e.getLocation();if(!t.equals(r)){var n=360*cc.Vec2.RIGHT.signAngle(r.sub(t))/(2*Math.PI);n=n<0?n+360:n;var a=Math.floor((n+45)%360/90),i=r.x-t.x,s=r.y-t.y;Math.sqrt(i*i+s*s)>this.minSwipeDist&&cc.systemEvent.emit(o.EVENT_SWIPE,new o.EventGotSwipeDir(a))}},t.EVENT_SWIPE="SwipeController.swipe",__decorate([a],t.prototype,"minSwipeDist",void 0),t=o=__decorate([n],t)}(cc.Component);o.SwipeController=i,function(e){var t=function(){function e(e){this.swipe=e}return e.eventName="EventGotSwipeDir",e}();e.EventGotSwipeDir=t}(i=o.SwipeController||(o.SwipeController={})),o.SwipeController=i,cc._RF.pop()},{}],TileAnimBlock:[function(e,t,o){"use strict";cc._RF.push(t,"fe6131FOURLcpSjOBnsNnb7","TileAnimBlock");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("MathHelper"),{ccclass:a,property:i}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.tileBlockOverlay=null,this.tileBlockLock=null,this.animTime=.2,this.maxOpacity=255,this.maxYPosLockSprite=0}create(e,t){let o=this,r={display:t[0],lerpFun:n.getLerp(0,this.maxOpacity,this.animTime),lerpFunMove:n.getLerp(60,this.maxYPosLockSprite,this.animTime),tileBlockOverlay:t[0].node.getChildByName("Block"),tileBlockLock:t[0].node.getChildByName("Lock"),syncBlock:!1};return{init:function(){o.init(r)},play:function(e){return o.play(e,r)},end:function(){o.end(r)},name:function(){return o.getName()},type:e}}init(e){e.display;e.tileBlockOverlay.opacity=0,e.tileBlockLock.opacity=0,e.tileBlockLock.setPosition(cc.v2(0,60))}play(e,t){let o=t.display;return t.syncBlock?(t.tileBlockOverlay.opacity=t.lerpFun(e),t.tileBlockLock.opacity=t.lerpFun(e),t.tileBlockLock.setPosition(cc.v2(0,t.lerpFunMove(e))),t.tileBlockLock.opacity===this.maxOpacity):(t.syncBlock=o.tileAnim.waitSync(this.getName()),!1)}end(e){e.display;e.tileBlockOverlay.opacity=this.maxOpacity,e.tileBlockLock.opacity=this.maxOpacity,e.tileBlockLock.setPosition(cc.v2(0,this.maxYPosLockSprite))}getName(){return this.name}};r([i],s.prototype,"animTime",void 0),r([i],s.prototype,"maxYPosLockSprite",void 0),s=r([a],s),o.default=s,cc._RF.pop()},{MathHelper:"MathHelper"}],TileAnimCreate:[function(e,t,o){"use strict";cc._RF.push(t,"d394bJCxABLTbkRJw442X+J","TileAnimCreate");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("MathHelper"),{ccclass:a,property:i}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.scaleSpeed=.2,this.animTime=1,this.maxSize=1}create(e,t){let o=this,r={display:t[0],lerpFun:n.getLerp(0,this.maxSize,this.animTime)};return{init:function(){o.init(r)},play:function(e){return o.play(e,r)},end:function(){o.end(r)},name:function(){return o.getName()},type:e}}init(e){e.display.node.scale=0}play(e,t){let o=t.display;return o.node.scale=t.lerpFun(e),o.node.scale===this.maxSize}end(e){e.display.node.scale=this.maxSize}getName(){return this.name}};r([i],s.prototype,"scaleSpeed",void 0),r([i],s.prototype,"animTime",void 0),s=r([a],s),o.default=s,cc._RF.pop()},{MathHelper:"MathHelper"}],TileAnimDeselect:[function(e,t,o){"use strict";cc._RF.push(t,"8e21duyhI9J1ZelpnwnZQrq","TileAnimDeselect");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("MathHelper"),{ccclass:a,property:i}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.fadeScale=1,this.animTime=1,this.defaultSize=1,this.maxOpacity=255}create(e,t){let o=this,r=this.defaultSize+this.fadeScale,a={display:t[0],lerpFun:n.getLerp(this.maxOpacity,0,this.animTime),lerpScaleFun:n.getLerp(this.defaultSize,r,this.animTime)};return{init:function(){o.init(a)},play:function(e){return o.play(e,a)},end:function(){o.end(a)},name:function(){return o.getName()},type:e}}init(e){e.display.selectedImage.node.opacity=this.maxOpacity,e.display.selectedImage.node.scale=this.defaultSize}play(e,t){let o=!1;return t.display.selectedImage.node.opacity=t.lerpFun(e),t.display.selectedImage.node.scale=t.lerpScaleFun(e),0==t.display.selectedImage.node.opacity&&(o=!0),o}end(e){e.display.selectedImage.node.opacity=0,e.display.selectedImage.node.scale=this.defaultSize+this.fadeScale}getName(){return this.name}};r([i],s.prototype,"fadeScale",void 0),r([i],s.prototype,"animTime",void 0),s=r([a],s),o.default=s,cc._RF.pop()},{MathHelper:"MathHelper"}],TileAnimDestroyFade:[function(e,t,o){"use strict";cc._RF.push(t,"25b9dtZQ6BIiY2OF0CFkX1u","TileAnimDestroyFade"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("MathHelper"),n=cc._decorator,a=n.ccclass,i=n.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fadeScale=1,t.animTime=1,t.maxSize=1,t}return __extends(t,e),t.prototype.create=function(e,t){var o=this,n=this.maxSize+this.fadeScale,a={display:t[0],lerpFun:r.getLerp(255,0,this.animTime),lerpScaleFun:r.getLerp(this.maxSize,n,this.animTime)};return{init:function(){o.init(a)},play:function(e){return o.play(e,a)},end:function(){o.end(a)},name:function(){return o.getName()},type:e}},t.prototype.init=function(e){},t.prototype.play=function(e,t){var o=!1;return t.display.node.opacity=t.lerpFun(e),t.display.node.scale=t.lerpScaleFun(e),0==t.display.node.opacity&&(o=!0),o},t.prototype.end=function(e){e.display.destroyDisplay()},t.prototype.getName=function(){return this.name},__decorate([i],t.prototype,"fadeScale",void 0),__decorate([i],t.prototype,"animTime",void 0),t=__decorate([a],t)}(cc.Component);o.default=s,cc._RF.pop()},{MathHelper:"MathHelper"}],TileAnimDestroy:[function(e,t,o){"use strict";cc._RF.push(t,"8ca47EizdtPh72VaRQmM+QN","TileAnimDestroy");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:n,property:a}=cc._decorator;let i=class extends cc.Component{create(e,t){let o=this,r={display:t[0]};return{init:function(){o.init(r)},play:function(e){return o.play(e,r)},end:function(){o.end(r)},name:function(){return o.getName()},type:e}}init(e){}play(e,t){return!0}end(e){e.display.destroyDisplay()}getName(){return this.name}};i=r([n],i),o.default=i,cc._RF.pop()},{}],TileAnimMove:[function(e,t,o){"use strict";cc._RF.push(t,"c8a69AZtdVMd4GLS3eOH57f","TileAnimMove");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("TileAnim"),a=e("MathHelper"),{ccclass:i,property:s}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.moveSpeed=.2,this.animTime=1}create(e,t){let o=this,r={display:t[0],initPosition:t[1],targetPosition:t[2],lerpXFun:a.getLerp(t[1].x,t[2].x,this.animTime),lerpYFun:a.getLerp(t[1].y,t[2].y,this.animTime)};return{init:function(){o.init(r)},play:function(e){return o.play(e,r)},end:function(){o.end(r)},name:function(){return o.getName()},type:e}}init(e){e.display.node.position=e.initPosition,n.TileAnim.canTwink=!1}play(e,t){let o=t.display;return o.node.position=new cc.Vec2(t.lerpXFun(e),t.lerpYFun(e)),n.TileAnim.canTwink=o.node.position.equals(t.targetPosition)}end(e){e.display.node.position=e.targetPosition}getName(){return this.name}};r([s],l.prototype,"moveSpeed",void 0),r([s],l.prototype,"animTime",void 0),l=r([i],l),o.default=l,cc._RF.pop()},{MathHelper:"MathHelper",TileAnim:"TileAnim"}],TileAnimSelect:[function(e,t,o){"use strict";cc._RF.push(t,"6c0768lojZKypvA8p0E+goL","TileAnimSelect"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("MathHelper"),n=cc._decorator,a=n.ccclass,i=n.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fadeScale=1,t.animTime=1,t.defaultSize=1,t.maxOpacity=255,t}return __extends(t,e),t.prototype.create=function(e,t){var o=this,n=this.defaultSize+this.fadeScale,a={display:t[0],lerpFun:r.getLerp(0,this.maxOpacity,this.animTime),lerpScaleFun:r.getLerp(n,this.defaultSize,this.animTime)};return{init:function(){o.init(a)},play:function(e){return o.play(e,a)},end:function(){o.end(a)},name:function(){return o.getName()},type:e}},t.prototype.init=function(e){e.display.selectedImage.node.opacity=0,e.display.selectedImage.node.scale=this.defaultSize+this.fadeScale},t.prototype.play=function(e,t){var o=!1;return t.display.selectedImage.node.opacity=t.lerpFun(e),t.display.selectedImage.node.scale=t.lerpScaleFun(e),t.display.selectedImage.node.opacity==this.maxOpacity&&(o=!0),o},t.prototype.end=function(e){e.display.selectedImage.node.opacity=this.maxOpacity,e.display.selectedImage.node.scale=this.defaultSize},t.prototype.getName=function(){return this.name},__decorate([i],t.prototype,"fadeScale",void 0),__decorate([i],t.prototype,"animTime",void 0),t=__decorate([a],t)}(cc.Component);o.default=s,cc._RF.pop()},{MathHelper:"MathHelper"}],TileAnimSync:[function(e,t,o){"use strict";cc._RF.push(t,"a55d3DafNFByJmuQxMKW7nT","TileAnimSync");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:n,property:a}=cc._decorator;let i=class extends cc.Component{create(e,t){let o=this,r={display:t[0]};return{init:function(){o.init(r)},play:function(e){return o.play(e,r)},end:function(){o.end(r)},name:function(){return o.getName()},type:e}}init(e){}play(e,t){return t.display.tileAnim.waitSync(this.getName())}end(e){}getName(){return this.name}};i=r([n],i),o.default=i,cc._RF.pop()},{}],TileAnimTwink:[function(e,t,o){"use strict";cc._RF.push(t,"88b84hqluJEFad2cmafzest","TileAnimTwink"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("TileAnim"),n=e("MathHelper"),a=cc._decorator,i=a.ccclass,s=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scaleSpeed=.2,t.twinkSize=.2,t.animTime=1,t.maxSize=1,t}return __extends(t,e),t.prototype.create=function(e,t){var o=this,r=this.maxSize+this.twinkSize,a={display:t[0],value:t[1],reachTwink:!1,lerpToFun:n.getLerp(this.maxSize,r,this.animTime),lerpFromFun:n.getLerp(r,this.maxSize,this.animTime)};return{init:function(){o.init(a)},play:function(e){return o.play(e,a)},end:function(){o.end(a)},name:function(){return o.getName()},type:e}},t.prototype.init=function(e){e.display.node.scale=this.maxSize},t.prototype.play=function(e,t){var o=t.display,n=t.reachTwink,a=!1;return r.TileAnim.canTwink&&(o.setValue(t.value),n?(o.node.scale=t.lerpFromFun(e),a=o.node.scale===this.maxSize):(o.node.scale=t.lerpToFun(e),o.node.scale===this.maxSize+this.twinkSize&&(t.reachTwink=!0))),a},t.prototype.end=function(e){var t=e.display;t.setValue(e.value),t.node.scale=this.maxSize},t.prototype.getName=function(){return this.name},__decorate([s],t.prototype,"scaleSpeed",void 0),__decorate([s],t.prototype,"twinkSize",void 0),__decorate([s],t.prototype,"animTime",void 0),t=__decorate([i],t)}(cc.Component);o.default=l,cc._RF.pop()},{MathHelper:"MathHelper",TileAnim:"TileAnim"}],TileAnimUnblock:[function(e,t,o){"use strict";cc._RF.push(t,"94dcbX0Gp5FI4/2Rgii6V4F","TileAnimUnblock");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const n=e("MathHelper"),{ccclass:a,property:i}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.tileBlockOverlay=null,this.tileBlockLock=null,this.animTime=.2,this.maxOpacity=0,this.maxYPosLockSprite=60}create(e,t){let o=this,r={display:t[0],lerpFun:n.getLerp(255,this.maxOpacity,this.animTime),lerpFunMove:n.getLerp(0,this.maxYPosLockSprite,this.animTime),tileBlockOverlay:t[0].node.getChildByName("Block"),tileBlockLock:t[0].node.getChildByName("Lock")};return{init:function(){o.init(r)},play:function(e){return o.play(e,r)},end:function(){o.end(r)},name:function(){return o.getName()},type:e}}init(e){e.display;e.tileBlockOverlay.opacity=255,e.tileBlockLock.setPosition(cc.v2(0,0))}play(e,t){t.display;return t.tileBlockOverlay.opacity=t.lerpFun(e),t.tileBlockLock.setPosition(cc.v2(0,t.lerpFunMove(e))),t.tileBlockOverlay.opacity===this.maxOpacity}end(e){e.display;e.tileBlockOverlay.opacity=this.maxOpacity,e.tileBlockLock.opacity=this.maxOpacity,e.tileBlockLock.setPosition(cc.v2(0,this.maxYPosLockSprite))}getName(){return this.name}};r([i],s.prototype,"animTime",void 0),r([i],s.prototype,"maxYPosLockSprite",void 0),s=r([a],s),o.default=s,cc._RF.pop()},{MathHelper:"MathHelper"}],TileAnim:[function(e,t,o){"use strict";cc._RF.push(t,"06d0bQLOPxLBYg0oarbzf1u","TileAnim");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};function n(e){return void 0!==e.create&&void 0!==e.init&&void 0!==e.play&&void 0!==e.end}Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.Create=0]="Create",e[e.Twink=1]="Twink",e[e.Move=2]="Move",e[e.Destroy=3]="Destroy",e[e.Block=4]="Block",e[e.Unblock=5]="Unblock",e[e.DestroyFade=6]="DestroyFade",e[e.Select=7]="Select",e[e.Deselect=8]="Deselect",e[e.Sync=9]="Sync"}(o.AnimType||(o.AnimType={}));const{ccclass:a,property:i}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.animList=[],this.syncStateList=[],this.isSync=!1}onLoad(){let e=this.getComponents(cc.Component);for(let t of e)n(t)&&this.animList.push(t)}createAndInit(e,t){let o=this.create(e,t);return o.init(),o.init=function(){},o}create(e,t){let o={type:e,init:function(){},play:function(e){return!0},end:function(){},name:function(){return""}};if(e<this.animList.length){let r=this.animList[e];n(r)?o=r.create(e,t):cc.log("TileAnim | IsITileAnim(animType) = false")}else cc.log(`TileAnim | type >= AnimType.length - ${e} >= ${this.animList.length}`);return o}addToSyncList(e){this.syncStateList.push(e)}waitSync(e){return this.addToSyncList(e),this.isSync}lateUpdate(){if(this.syncStateList.length>0){let e=this.syncStateList.filter((e,t,o)=>o[0]!=e);this.isSync=0===e.length,this.syncStateList=[]}else this.isSync=!0}};s.canTwink=!0,s=r([a],s),o.TileAnim=s,cc._RF.pop()},{}],TileChooser:[function(e,t,o){"use strict";cc._RF.push(t,"e3e41jpbphLwrVnlpWf3X2T","TileChooser"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("CoreInputController"),n=e("ChooseOverlayController"),a=cc._decorator,i=a.ccclass,s=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.overlay=null,t.choose=null,t}var o;return __extends(t,e),o=t,t.prototype.onLoad=function(){this.overlay.node.opacity=0,this.overlay.node.active=!1,cc.systemEvent.on(o.EventChooseStarted.eventName,this.onChooseStarted,this),cc.systemEvent.on(o.EventChoose.eventName,this.onChoose,this),cc.systemEvent.on(o.EventChooseEnded.eventName,this.onChooseEnded,this),cc.systemEvent.on(o.EventChooseCanceled.eventName,this.onChooseEnded,this)},t.prototype.onDestroy=function(){cc.systemEvent.off(o.EventChooseStarted.eventName,this.onChooseStarted,this),cc.systemEvent.off(o.EventChoose.eventName,this.onChoose,this),cc.systemEvent.off(o.EventChooseEnded.eventName,this.onChooseEnded,this),cc.systemEvent.off(o.EventChooseCanceled.eventName,this.onChooseEnded,this)},t.prototype.onChooseStarted=function(e){cc.systemEvent.emit(r.CoreInputController.EventBlockingStarted.eventName,new r.CoreInputController.EventBlockingStarted),this.overlay.node.active=!0,this.choose=e.choose,this.overlay.setText(this.makeChooseMessage(e.choose.amount))},t.prototype.onChooseEnded=function(e){cc.systemEvent.emit(r.CoreInputController.EventBlockingFinished.eventName,new r.CoreInputController.EventBlockingFinished),this.overlay.node.runAction(cc.fadeOut(this.overlay.duration)),this.choose=null},t.prototype.onChoose=function(e){var t=this.choose.amount-this.choose.chosen.length;t>0?this.overlay.setText(this.makeChooseMessage(t)):this.overlay.setText("\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0432\u044b\u0431\u043e\u0440")},t.prototype.makeChooseMessage=function(e){return 1==e?"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0435\u0449\u0435 "+e+" \u043f\u043b\u0438\u0442\u043a\u0443":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0435\u0449\u0435 "+e+" \u043f\u043b\u0438\u0442\u043a\u0438"},__decorate([s(n.ChooseOverlayController)],t.prototype,"overlay",void 0),t=o=__decorate([i],t)}(cc.Component);o.TileChooser=l,function(e){var t=function(){function e(e){this.choose=null,this.choose=e}return e.eventName="TileChooserEventChooseStarted",e}();e.EventChooseStarted=t;var o=function(){function e(){}return e.eventName="TileChooserEventChoose",e}();e.EventChoose=o;var r=function(){function e(){}return e.eventName="TileChooserEventChooseEnded",e}();e.EventChooseEnded=r;var n=function(){function e(){}return e.eventName="EventChooseCanceled",e}();e.EventChooseCanceled=n}(l=o.TileChooser||(o.TileChooser={})),o.TileChooser=l,o.default=l,cc._RF.pop()},{ChooseOverlayController:"ChooseOverlayController",CoreInputController:"CoreInputController"}],TileDisplay:[function(e,t,o){"use strict";cc._RF.push(t,"be9ea7+T7NPlptVPeADkXKb","TileDisplay");var r,n=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const a=e("TileAnim"),i=e("CoreTileCreator"),s=e("GameComponentsLocator"),l=e("CoreInputController"),c=e("SkillChooser"),p=e("TileChooser"),{ccclass:u,property:h}=cc._decorator;let d=r=class extends cc.Component{constructor(){super(...arguments),this.tileSprites=[],this.tileValue=null,this.selectedImage=null,this.tileSprite=null,this.tileData=null,this.animList=[],this.currentAnim=null,this.grid=null,this.tileAnim=null,this.isClickEnable=!1,this.targetPosition=null}onLoad(){this.targetPosition=this.node.position,this.tileAnim=s.GameComponentsLocator.get(a.TileAnim),cc.systemEvent.on(r.EventSyncTileDisplay.eventName,this.onSync,this),cc.systemEvent.on(i.CoreTileCreator.EVENT_FINISH_ANIM,this.onGameMove,this),cc.systemEvent.on(l.CoreInputController.EventBlockingStarted.eventName,this.fadeOutBlockSprite,this),cc.systemEvent.on(l.CoreInputController.EventBlockingFinished.eventName,this.fadeInBlockSprite,this),cc.systemEvent.on(p.TileChooser.EventChooseStarted.eventName,this.onChooseStarted,this),cc.systemEvent.on(p.TileChooser.EventChooseEnded.eventName,this.onChooseEnded,this),cc.systemEvent.on(p.TileChooser.EventChooseCanceled.eventName,this.onChooseEnded,this),this.addAnim(this.tileAnim.createAndInit(a.AnimType.Create,[this])),this.addAnim(this.tileAnim.createAndInit(a.AnimType.Sync,[this])),null!=this.selectedImage&&(this.selectedImage.node.opacity=0)}onDestroy(){cc.systemEvent.off(r.EventSyncTileDisplay.eventName,this.onSync,this),cc.systemEvent.off(i.CoreTileCreator.EVENT_FINISH_ANIM,this.onGameMove,this),cc.systemEvent.off(l.CoreInputController.EventBlockingStarted.eventName,this.fadeOutBlockSprite,this),cc.systemEvent.off(l.CoreInputController.EventBlockingFinished.eventName,this.fadeInBlockSprite,this),cc.systemEvent.off(p.TileChooser.EventChooseStarted.eventName,this.onChooseStarted,this),cc.systemEvent.off(p.TileChooser.EventChooseEnded.eventName,this.onChooseEnded,this),cc.systemEvent.off(p.TileChooser.EventChooseCanceled.eventName,this.onChooseEnded,this)}update(e){null==this.currentAnim?this.animList.length>0&&(this.currentAnim=this.animList.shift(),this.currentAnim.init(),this.tileAnim.addToSyncList(this.currentAnim.name())):(this.tileAnim.addToSyncList(this.currentAnim.name()),this.currentAnim.play(e)&&(this.currentAnim.end(),this.currentAnim=null))}onGameMove(){this.finishAnim()}onSync(){this.addAnim(this.tileAnim.createAndInit(a.AnimType.Sync,[this]))}onChooseStarted(){this.isClickEnable=!0}onChooseEnded(){this.isClickEnable=!1,this.deselect()}onClick(e){this.isClickEnable&&(this.select(),cc.systemEvent.emit(c.SkillChooser.EventChoose.eventName,new c.SkillChooser.EventChoose(this.tileData)))}select(){0==this.selectedImage.node.opacity&&this.addAnim(this.tileAnim.createAndInit(a.AnimType.Select,[this]))}deselect(){255==this.selectedImage.node.opacity&&this.addAnim(this.tileAnim.createAndInit(a.AnimType.Deselect,[this]))}addAnim(e){this.animList.push(e)}updateFromTile(e,t){this.setValue(t),this.setPosition(e)}setValue(e){null!=this.tileValue&&(this.tileValue.string=e.toString(),this.getSprite(),this.tileSprite.spriteFrame=this.tileSprites[Math.log2(e)-1])}fadeOutBlockSprite(e){e.needLockAnim&&this.addAnim(this.tileAnim.createAndInit(a.AnimType.Block,[this]))}fadeInBlockSprite(e){e.needUnlockAnim&&this.addAnim(this.tileAnim.createAndInit(a.AnimType.Unblock,[this]))}setPosition(e){null!=this.grid&&(this.node.position=this.grid.getPosition(e.x,e.y),this.targetPosition=this.node.position)}getPosition(){return this.targetPosition}getCellPosition(e){return this.grid.getPosition(e.x,e.y)}setTargetPosition(e){this.targetPosition=e}destroyDisplay(){this.node.destroy(),this.tileData&&this.tileData.destroy()}getSprite(){return null==this.tileSprite&&(this.tileSprite=this.getComponent(cc.Sprite)),this.tileSprite}finishAnim(){this.currentAnim&&(this.currentAnim.end(),this.currentAnim=null);for(let e in this.animList){this.animList[e].end()}this.animList=[]}};n([h([cc.SpriteFrame])],d.prototype,"tileSprites",void 0),n([h(cc.Label)],d.prototype,"tileValue",void 0),n([h(cc.Sprite)],d.prototype,"selectedImage",void 0),d=r=n([u],d),o.TileDisplay=d,function(e){class t{constructor(){}}t.eventName="EventSyncTileDisplay",e.EventSyncTileDisplay=t}(d=o.TileDisplay||(o.TileDisplay={})),o.TileDisplay=d,o.default=d,cc._RF.pop()},{CoreInputController:"CoreInputController",CoreTileCreator:"CoreTileCreator",GameComponentsLocator:"GameComponentsLocator",SkillChooser:"SkillChooser",TileAnim:"TileAnim",TileChooser:"TileChooser"}],TileGridDisplay:[function(e,t,o){"use strict";cc._RF.push(t,"83f050aglhKVIUbQNyeFYbt","TileGridDisplay");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:n,property:a}=cc._decorator;let i=class extends cc.Component{constructor(){super(...arguments),this.cellPrefab=null,this.size=2,this.gridLayout=null,this.background=null}onLoad(){if(null!=this.background)this.gridLayout.node.width=this.background.width,this.gridLayout.node.height=this.background.height;else{let e=cc.instantiate(this.cellPrefab).width;this.gridLayout.node.width=e*this.size+this.gridLayout.paddingLeft+this.gridLayout.paddingRight,this.gridLayout.node.height=e*this.size+this.gridLayout.paddingTop+this.gridLayout.paddingBottom}for(let e=0;e<this.size*this.size;e++){let e=cc.instantiate(this.cellPrefab);this.gridLayout.node.addChild(e),e.setParent(this.gridLayout.node)}this.gridLayout.updateLayout()}getPosition(e,t){let o=e*this.size+t,r=cc.Vec2.ZERO;return null!=this.gridLayout.node.children[o]?r=this.gridLayout.node.children[o].position:cc.error(`cant find child with index - ${o}`),r}};r([a(cc.Prefab)],i.prototype,"cellPrefab",void 0),r([a],i.prototype,"size",void 0),r([a(cc.Layout)],i.prototype,"gridLayout",void 0),r([a(cc.Node)],i.prototype,"background",void 0),i=r([n],i),o.TileGridDisplay=i,cc._RF.pop()},{}],Touchable:[function(e,t,o){"use strict";cc._RF.push(t,"65f519t7nFEZa6PmB+M/yUz","Touchable"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.touchStartHandlers=[],t.touchEndHandlers=[],t.buttonSprite=null,t.buttonTargetScale=.9,t.transitionDuration=.05,t}return __extends(t,e),t.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},t.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},t.prototype.onTouchStart=function(){if(this.invokeCallbacks(this.touchStartHandlers),this.buttonSprite){var e=cc.scaleTo(this.transitionDuration,this.buttonTargetScale);this.buttonSprite.runAction(e)}},t.prototype.onTouchEnd=function(){if(this.invokeCallbacks(this.touchEndHandlers),this.buttonSprite){var e=cc.scaleTo(this.transitionDuration,1);this.buttonSprite.runAction(e)}},t.prototype.invokeCallbacks=function(e){cc.Component.EventHandler.emitEvents(e)},__decorate([a([cc.Component.EventHandler])],t.prototype,"touchStartHandlers",void 0),__decorate([a([cc.Component.EventHandler])],t.prototype,"touchEndHandlers",void 0),__decorate([a(cc.Node)],t.prototype,"buttonSprite",void 0),__decorate([a],t.prototype,"buttonTargetScale",void 0),__decorate([a],t.prototype,"transitionDuration",void 0),t=__decorate([n],t)}(cc.Component);o.default=i,cc._RF.pop()},{}],TransitionDataMapper:[function(e,t,o){"use strict";cc._RF.push(t,"9062e8OgA9HtpgzeNR6T73z","TransitionDataMapper"),Object.defineProperty(o,"__esModule",{value:!0});var r,n=e("HeroDataMapper");(function(e){e[e.None=0]="None",e[e.Win=1]="Win",e[e.Lose=2]="Lose",e[e.Cancel=3]="Cancel"})(r=o.LevelAction||(o.LevelAction={})),function(e){e[e.Common=1]="Common",e[e.MiniBoss=4]="MiniBoss",e[e.Boss=0]="Boss"}(o.LevelType||(o.LevelType={}));var a=cc._decorator,i=a.ccclass,s=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.heroData=null,t.data={selectedHero:"",levelMapScene:"",levelAction:r.None,levelLoot:{items:[],heroes:[],resources:[]},selectedItem:""},t}return __extends(t,e),t.prototype.getSelectedItem=function(){return this.heroData.getItem(this.data.selectedItem)},t.prototype.selectItemByID=function(e){this.data.selectedItem=e},t.prototype.selectItem=function(e){this.data.selectedItem=e.uniqueID},t.prototype.resetLoot=function(){this.data.levelLoot=null},t.prototype.getLoot=function(){return this.data.levelLoot},t.prototype.setScene=function(e){this.data.levelMapScene=e},t.prototype.getScene=function(){return this.data.levelMapScene},t.prototype.resetLevelAction=function(){this.data.levelAction=r.None},t.prototype.setLevelAction=function(e){this.data.levelAction=e},t.prototype.getLevelAction=function(){return this.data.levelAction},t.prototype.setHeroByID=function(e){this.heroData.isHeroID(e)&&(this.data.selectedHero=e)},t.prototype.setHero=function(e){this.data.selectedHero=e.uniqueID},t.prototype.getHero=function(){var e=""==this.data.selectedHero?this.heroData.getHeroes()[0].uniqueID:this.data.selectedHero;return this.heroData.getHero(e)},__decorate([s(n.HeroDataMapper)],t.prototype,"heroData",void 0),t=__decorate([i],t)}(cc.Component);o.TransitionDataMapper=l,cc._RF.pop()},{HeroDataMapper:"HeroDataMapper"}],TwoStateBehavior:[function(e,t,o){"use strict";cc._RF.push(t,"8313aiwNptLr6ArbZuWkCQ6","TwoStateBehavior");var r=this&&this.__decorate||function(e,t,o,r){var n,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,o,i):n(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:n,property:a}=cc._decorator;let i=class extends cc.Component{constructor(){super(...arguments),this.stateOff=cc.Color.WHITE,this.stateOn=cc.Color.BLACK}onLoad(){this.node.color=this.stateOff}switchState(){this.node.color==this.stateOff?this.node.color=this.stateOn:this.node.color=this.stateOff}switchOn(){this.node.color=this.stateOn}switchOff(){this.node.color=this.stateOff}};r([a(cc.Color)],i.prototype,"stateOff",void 0),r([a(cc.Color)],i.prototype,"stateOn",void 0),i=r([n],i),o.TwoStateBehavior=i,cc._RF.pop()},{}],WinManagerController:[function(e,t,o){"use strict";cc._RF.push(t,"d2291+DUVxPLLXIeKk/LZhh","WinManagerController"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.winPrefabs=[],t}return __extends(t,e),t.prototype.onLoad=function(){for(var e=0,t=this.winPrefabs;e<t.length;e++){var o=t[e],r=cc.instantiate(o);r.setParent(this.node),r.active=!1}},__decorate([a(cc.Prefab)],t.prototype,"winPrefabs",void 0),t=__decorate([n],t)}(cc.Component);o.default=i,cc._RF.pop()},{}],ZOrderChanger:[function(e,t,o){"use strict";cc._RF.push(t,"8d43bu+AmhET7JqBcts1yy2","ZOrderChanger"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,n=r.ccclass,a=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.zOrder=0,t.showOrder=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.showOrder&&cc.log("zOrder old - "+this.node.zIndex+" new - "+this.zOrder+" node - "+this.node.parent.name),this.node.zIndex=this.zOrder},__decorate([a],t.prototype,"zOrder",void 0),__decorate([a],t.prototype,"showOrder",void 0),t=__decorate([n],t)}(cc.Component);o.default=i,cc._RF.pop()},{}]},{},["AudioConfig","AudioEffect","AudioEmitter","AudioManager","AudioTheme","AudioUtil","InputController","BattleController","BattleLoader","BattleProgression","BattleViewController","CharacterAvatar","CharacterAvatarCreator","CharacterData","CharacterLoader","CharacterSlot","CharacterAvatarType","CharacterAvatarTypeCreator","CharacterAvatarTypeHero","Damage","Health","SkillAIController","SkillsController","CoreGameplay","CoreGrid","CoreHistory","CoreInputController","CoreMover","CoreTile","CoreTileCreator","CoreTileDestroyer","CoreTileMover","CoreTileUpdater","EfxGlobalController","HitEfxController","SkillReloadEfxController","PartActivator","PartCounter","PartDamage","PartHealer","PartInterfaces","PartRandomizer","PartSetGlobal","PartStatChanger","PartTileCreator","PartTileDestroyer","PartTileMover","PartTileUpdater","PartTimer","SkillChooser","SkillCooldown","SkillEvent","SkillEventMapper","SkillExecuter","SkillLoader","SkillMapper","TileAnimBlock","TileAnimCreate","TileAnimDeselect","TileAnimDestroy","TileAnimDestroyFade","TileAnimMove","TileAnimSelect","TileAnimSync","TileAnimTwink","TileAnimUnblock","TileAnim","TileDisplay","TileGridDisplay","DataMapper","GameComponentsLocator","GlobalHandler","HeroDataMapper","TransitionDataMapper","BackToLevelMap","LevelIconController","LevelMapController","MenuBehavior","SkillBarBehavior","TwoStateBehavior","WinManagerController","CashDisplay","ChooseOverlayController","GameOverController","HealthBar","HeroSkill","HeroSkillPanel","HeroSkillView","LevelUpWinController","MenuCreator","OptionsController","PauseGame","SceneSelector","TileChooser","ArrayUtil","Reloader","DebugHelper","FilterController","ParallaxBackground","ScrollSpriteFrame","Logger","MathHelper","Pausable","PauseSystem","PersistNode","SceneTransition","Storage","EventMover","ScrollViewConstraits","SwipeController","Touchable","ZOrderChanger","ClearOnAnimEnd","RandomAnim"]);